var url=window.location.search.substr(1),searchParams=new URLSearchParams(url),Params={};Params.roomId=searchParams.has("roomId")?searchParams.get("roomId"):"0";Params.fileId=searchParams.has("fileId")?searchParams.get("fileId"):"0";Params.userId=searchParams.has("userId")?searchParams.get("userId"):"0";Params.liveEventId=searchParams.has("liveEventId")?searchParams.get("liveEventId"):"0";Params.commentsMsgId=searchParams.has("commentsMsgId")?searchParams.get("commentsMsgId"):"0";$("input[name=roomId]").val(Params.roomId);$("input[name=userId]").val(Params.userId);$("input[name=fileId]").val(Params.fileId);function GetQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)");var c=decodeURI(window.location.search.substr(1)).match(b);if(c!=null){return unescape(c[2])}return null}function isWeiXin(){var a=window.navigator.userAgent.toLowerCase();if(a.match(/MicroMessenger/i)=="micromessenger"){return true}else{return false}}function layerOpen(c,a){var b=a||2;layer.open({content:c,skin:"msg",time:b})}function layerConfim(a,b){layer.open({content:a,btn:"确定",yes:function(c){b()}})}function getReviewList(f){var e=f.data;var g="";var c=[];var b=["公开观看","密码观看","付费观看","白名单观看","登录观看"];if(e.length==0){g+="<div class='nomoreIcon' style='text-align:center'><img width='120' height='120' src='img/nomore.png' alt='' /><p style='color:#999'>无相关视频...</p></div>"}else{for(var d=0;d<e.length;d++){var a=e[d];g+='<div class="reviewList" id="fileId_'+a.fileId+'" onclick="selectMediaFile('+a.fileId+')" >';g+='   <div class="reviewLeft">';g+='       <img src="'+a.fileImg+'" alt="" />';g+='       <div class="reviewMask">';g+="           <span>"+a.fileDuration+"</span>";g+="       </div>";g+="   </div>";g+='   <div class="reviewRight">';g+='       <div class="reviewRightTop">'+a.fileName+"</div>";g+='       <div class="reviewRightBottom">'+a.createTime+"</div>";g+='       <div class="reviewIcon">';g+='           <div class="reviewIcondiv"><i class="reviewplayIcon iconfont icon-video reviewplay"><span>'+a.viewNum+"次</span></i></div>";switch(a.authType){case 1:c="icon-yan";break;case 3:c="icon-qian";break;default:c="icon-mima";break}g+='           <div class="reviewIcondiv"><i class="reviewplayIcon iconfont '+c+' gongkai"><span>'+b[a.authType-1]+"</span></i></div>";g+="       </div>";g+="   </div>";g+="</div>"}}$("#review").html(g)}function errorfunction(){window.location.href="http://"+h5Base+"/phone/error.html"}var concernTotalTemp;function updateConcernStatus(c,g,f){if(window.event){f.cancelBubble=true}else{f.stopPropagation()}var b=$("input[name=userId]").val();var a=$("input[name=fileId]").val()||0;if(b==0){var d=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+d+"&fileId="+a;return}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/enterprise/concern.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",enterpriseId:c,userId:b,type:g},success:function(h){console.log(h);var e=h.code;if(e==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+d}else{if(e==402){saveMessagerPhoneNumber()}else{if(e==403){}else{if(e==1){if(g==0){$("#concernStatus").removeClass("yiguanzhu").addClass("guanzhu icon-jia").attr("onclick","updateConcernStatus("+c+",1,event)");concernTotalTemp=concernTotalTemp-1;var i=concernTotalTemp;if(i>9999){i=(i/10000).toFixed(1)/1+"w"}$(".smallText").html(i);layerOpen(h.message)}else{getConcern(c,function(k){$("#concernStatus").addClass("yiguanzhu ").removeClass("guanzhu icon-jia").attr("onclick","updateConcernStatus("+c+",0,event)");concernTotalTemp=concernTotalTemp+1;var m=concernTotalTemp;if(m>9999){m=(m/10000).toFixed(1)/1+"w"}$(".smallText").html(m);var j="";if(k.isImg==0){j="hide"}var l='<div class="concernMsg" id="concernMsg">    <div class="heade">'+k.slogan+'</div>        <div class="body">            <img src="'+k.advertisementImg+'" alt="" class="'+j+'">            <div class="custom-desc">'+k.prompt+'</div>        </div>    </div>    <div class="close" id="popclose"></div>';var n=layer.open({type:1,content:l,className:"popuo-concernMsg"});$("#popclose").on("click",function(){layer.close(n)})})}}else{layerOpen("关注或取消关注失败")}}}}}})}function getConcern(a,b){$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/enterprise/enterpriseSetup.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{enterpriseId:a},success:function(c){var d={slogan:"感谢您的关注",prompt:"下载天翼直播app,了解更多直播内容",isImg:1,advertisementImg:"http://zb.tv189.com/images/img-popup.png"};if(c.code==1){d={slogan:c.data.slogan,prompt:c.data.prompt,isImg:c.data.isImg==1?c.data.isImg:0,advertisementImg:c.data.advertisementImg!=undefined?c.data.advertisementImg:"http://zb.tv189.com/images/img-popup.png"}}b(d)}})}function zbjcompany(a){return false}function getEnterprise(b){var a=getStore("Clogo");if(!a||b!=a.v.enterpriseId||!getExpireStore("Clogo")){$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/homepage/homepageenterprise.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{enterpriseId:b},success:function(c){a={enterpriseId:b,img:c.data.enterpriseImg||"img/ELOGO.png"};$(".companyimg").css("background-image","url("+a.img+")");setExpireStore("Clogo",a)}})}else{a=getExpireStore("Clogo");$(".companyimg").css("background-image","url("+a.img+")")}}function openConfirm(){console.log("你确认了查看直播方更多直播内容");window.location.href="http://zb.tv189.com/QR.html"}function temporaryCancel(){console.log("你放弃查看直播方更多直播内容")}function openConfirmApp(){console.log("你确认了查看直播方更多直播内容");var a=navigator.userAgent;console.log(a);var c=a.indexOf("Android")>-1||a.indexOf("Linux")>-1;if(c){window.location.href="http://apizb.tv189.com/version/wap/download/android"}else{var b=!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(b){window.location.href="http://apizb.tv189.com/version/wap/download/ios"}else{window.location.href="http://apizb.tv189.com/version/wap/download/ios"}}}function saveMessagerPhoneNumber(){console.log("弹框进行手机号绑定");$(".passMask").fadeIn(500)}function getAuthenticode(b){var a=$("input[name=phoneNumber]").val()||$("input[name=phoneNum]").val();type="reg";if($(b).parents().hasClass("passInput")){type="bindMobile"}if(a==undefined||!isPoneAvailable(a.trim())){layerOpen("请输入正确的手机号");return false}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/appuser/sendmsg.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{phoneNum:a,type:type},success:function(d){var c=d.code;if(c==1){selectTimer(b)}else{layerOpen(d.message)}}})}var countdown=60;function selectTimer(a){if(countdown==0){$(a).removeAttr("disabled");$(a).text("获取验证码").attr("onclick","getAuthenticode(this)");countdown=60}else{$(a).attr("disabled",true);$(a).text("重新发送("+countdown+"s)").removeAttr("onclick");countdown--;setTimeout(function(){selectTimer(a)},1000)}}function isPoneAvailable(a){var b=/^[1][3,4,5,7,8,9][0-9]{9}$/;if(!b.test(a)){return false}else{return true}}function isEmail(a){var b=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!b.test(a)){return false}else{return true}}function savePhone(){wchatHackInput();var b=$("input[name=phoneNumber]").val();var c=$("input[name=userId]").val();if(!isPoneAvailable(b.trim())){layerOpen("请输入正确的手机号");return false}var a=$("input[name=vpassword]").val();if(a==null||a==undefined||a==""){layerOpen("验证码不能为空!");return false}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/personal/bindMobile.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:c,phoneNum:b,vpassword:a},success:function(d){if(d.code==1){$(".passMask").fadeOut()}else{layerOpen(d.message)}}})}function openRoomActivationCode(){var b=$("input[name=codeEwm]").val();if(b==null||b==undefined||b==""){layerOpen("激活码不能为空");return false}else{var a=$("input[name=fileId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/userFCode.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",fileId:a,code:b},success:function(d){var c=d.code;if(c==1){$(".ewmMask").addClass("hide");$("#ewmDiv").addClass("hide");window.location.href=window.location.href}else{layerOpen(d.message);return false}}})}}function openPay(){$(".ewmMask").addClass("hide");$("#payDiv").removeClass("hide")}function openJhm(){$(".ewmMask").addClass("hide");$("#jhmDiv").removeClass("hide")}function wechatSweepUnifyTheOrder(c,a,f,g){var e=$("input[name=roomId]").val();var d=$("input[name=userId]").val();var b=window.navigator.appName;$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/wx/sweep/order.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",productDesc:encodeURI(a),totalAmount:f,userId:d,orderType:c,terminalOrderType:b,roomId:e,contentId:g},success:function(k){var j=k.code;if(j==1){var i=k.codeUrl;$("#ewmImage").qrcode({render:"canvas",width:276,height:250,text:i,typeNumber:-1,correctLevel:2,background:"#ffffff",foreground:"#000000"});$(".ewmMask").addClass("hide");$("#ewmDiv").removeClass("hide");var h=k.orderId;selectOrder(h)}else{layerOpen(k.message)}}})}function selectOrder(a){$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/wx/select/getOrderId.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",orderId:a},success:function(d){var c=d.code;console.log(d);if(c==1){var e=d.payStatus;if(e==0){$("#ewmImage").html("");$(".ewmMask").addClass("hide");$("#ewmDiv").addClass("hide");var b=d.orderType;if(b==1){}else{if(b==2){}else{if(b==3){console.log(b);window.location.href=window.location.href}else{if(b==4){console.log(b)}}}}}else{setTimeout(function(){selectOrder(a)},1000)}}else{console.log(d.message)}}})}function checkPhone(){var a=navigator.userAgent;var b=a.indexOf("Android")>-1||a.indexOf("Adr")>-1;return b}var winHeight;var VideoBox;var menuBox;var talkCon;var replyHeader;var drawTit;var voteButton;var voteConBtn;function getHeight(){winHeight=$(window).height();$(".videoBox").height($(window).width()*9/16);VideoBox=$(".videoBox")[0].offsetHeight;menuBox=$(".menuBox").height();talkCon=$(".newtalkCon").height();replyHeader=$(".replyHeader").height();drawTit=$(".drawTitle").height()+1;voteButton=$(".voteendButton").height();voteConBtn=$(".voteconButton").height();$(".contentBox").css("height",winHeight-VideoBox-menuBox);$(".livemask").css("height",winHeight-VideoBox);$(".giftMask").css("height",winHeight-VideoBox-menuBox);$(".rewardMask").css("height",winHeight-VideoBox);$(".giftmask").css("height",winHeight);$(".passMask").css("height",winHeight);$(".contentBox>ul>li").css("height",winHeight-VideoBox-menuBox);$(".replyBox").css("height",winHeight-VideoBox-menuBox);$(".replyCon").css("height",winHeight-VideoBox-menuBox-replyHeader);$(".talkLi").css("height",winHeight-VideoBox-menuBox-talkCon);$(".notheme").css("height",winHeight-VideoBox-menuBox);$(".videoMask").css("height",winHeight);$(".drawMask").css("height",winHeight-VideoBox);$(".drawContent").css("height",winHeight-VideoBox-drawTit);$(".hongbaoMask").css("height",winHeight-VideoBox);$(".hongbaoContent").css("height",winHeight-VideoBox-drawTit);$(".voteMask").css("height",winHeight-VideoBox);$(".voteContent").css("height",winHeight-VideoBox-drawTit);$(".rewardContent").css("height",winHeight-VideoBox-drawTit);$(".voteResult").css("height",winHeight-VideoBox-drawTit-voteButton);$(".voteMain").css("height",winHeight-VideoBox-drawTit-voteConBtn);$(".downloadMask").css("height",winHeight-VideoBox);$(".downloadContent").css("height",winHeight-VideoBox-drawTit);$(".downloadeResult").css("height",winHeight-VideoBox-drawTit-voteButton);$(".downloadMain").css("height",winHeight-VideoBox-drawTit-voteConBtn);$(".ewmMask").css("height",winHeight);$(".Mask").css("height",winHeight-VideoBox-menuBox)}function isObject(a){return a!==null&&typeof a==="object"}function setExpireStore(b,c,a){a=60*60*1000;setStore(b,{v:c,t:new Date().getTime()+a})}function getExpireStore(a){var b=getStore(a);if(b.t>new Date().getTime()){return b.v}else{return false}}function setStore(a,c,b){b="localStorage";if(isObject(c)){window[b].setItem(a,JSON.stringify(c))}else{window[b].setItem(a,c)}}function getStore(a,b){b="localStorage";var d=window[b].getItem(a);try{return JSON.parse(d)}catch(c){return d}}function videoPlay(){if($(".videoPlay").find("i").hasClass("hide")){return false}if(myPlayer.paused){$(".videoPlay").addClass("hide");landscapeVideoClick();myPlayer.play()}else{$(".videoPlay").removeClass("hide");myPlayer.pause()}}function landscapeVideoClick(){if($(document.body).hasClass("landscape")){if(myPlayer!=undefined){myPlayer.ready(function(){if(!this.isFullscreen()){if(this.paused()){if(!$(".videoPlay").hasClass("hide")){return}setTimeout(function(){$(".vjs-fullscreen-control").click();$(".vjs-play-control").click()},350)}else{$(".mui-switch").removeClass("hide");setTimeout(function(){$(".vjs-fullscreen-control").click()},350)}}else{if(this.paused()){setTimeout(function(){$(".vjs-fullscreen-control").click();$(".vjs-play-control").click()},350)}}})}}}function onResize(){if(isPortrait()){setTimeout(function(){landscape()},0)}else{setTimeout(function(){portrait()},0)}}function isPortrait(){var a=window.orientation;if(a||a==0){if(a==90||a==-90){return true}else{return false}}else{if($(window).width()>$(window).height()){return true}else{return false}}}$(window).bind("orientationchange",function(a){onResize()});onResize;$("input").on("onblur",function(){wchatHackInput()});function landscape(){$("body").attr("class","landscape");orientation="landscape";setTimeout(function(){getHeight()},350);landscapeVideoClick()}function portrait(){$("body").attr("class","portrait");orientation="portrait";setTimeout(function(){getHeight()},350)}function wchatHackInput(){if(isWeiXin()){var a=document.body.scrollTop;setTimeout(function(){document.body.scrollTop=a},0)}}function flyDanmu(b){if(danmuSwitch){var a={msg:b};$("canvas").barrager([a])}};