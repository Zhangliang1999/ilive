var liveStart=0;var mescroll;var countdownTitle=null;var minRewardsAmount=0;var maxRewardsAmount=0;var roomName="";var liveStartTime;var hlsAddr;var myPlayer;var swiperStatus;var layerId;var danmuSwitch;$(function(){var b=GetQueryString("roomId");if(!/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){window.location.href="http://"+h5Base+"/pc/play.html?roomId="+b}if(b==undefined||b=="null"){b=0}$("input[name=roomId]").val(b);var a=GetQueryString("userId");if(a==undefined||a=="null"){a=0}$("input[name=userId]").val(a);if(b==0){errorfunction()}else{onResize();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectPageDecorate.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:b},success:function(x){var c=x.code;if(c==1){var u="";var e="";var v=JSON.parse(x.pageDecorates);var w=false;for(var p=0;p<v.length;p++){var j=p;var g=v[p];var y=g.menuType;var l=g.menuName;switch(y){case 1:u+="<li ";if(p==0){u+=' class="liactive"';$(".wen").attr("msgValue",y);$("textarea[name=msgContent]").attr("maxlength","40");$("#sendMessageDIV").addClass("hide")}u+=' liveMsgType="'+y+'"><span>'+l+'</span><i class="redDot" style="display:none;"></i></li>';e+='<li class="theme" style=\'z-index:'+j+"'>";e+='	<div id="mescroll" class="mescroll">';e+='		<div class="hintBox hide" id="newTopic">有一条新的内容，下拉刷新观看</div>';e+='		<div class="nomoreIcon hide" id="topicNull">';e+='		   <div class="nothemeBox"></div>';e+='		   <p class="nothemeText">暂无话题发布...</p >';e+="		</div>";e+='		<div id="topTalkBoxList1"></div>';e+='		<div class="themeCon" id="themeDiv" ></div>';e+="	</div>";e+="</li>";w=true;break;case 2:u+=" <li ";if(p==0){u+='class="liactive"';$(".wen").attr("msgValue",y);$("textarea[name=msgContent]").attr("maxlength","100");$("#sendMessageDIV").removeClass("hide")}u+=' liveMsgType="'+y+'"><span>'+l+"</span></li>";e+='<li class="talkLi" id="talkLi" style=\'z-index:'+j+"'>";e+='	<div id="topTalkBoxList2"></div>';e+='	<div id="talkBoxList2"></div>';e+="	<div class='dixian' style='display: none'><span>我是有底线的</span></div>";e+="</li>";break;case 3:break;case 4:u+=" <li ";if(p==0){u+='class="liactive"';$(".wen").attr("msgValue",y);$("#sendMessageDIV").addClass("hide")}u+=' liveMsgType="'+y+'"><span>'+l+"</span></li>";e+='<li class="zbjj" id="enterpriseList" style=\'z-index:'+j+";'></li>";break;case 5:u+=" <li ";if(p==0){u+='class="liactive"';$(".wen").attr("msgValue",y);$("#sendMessageDIV").addClass("hide")}u+=' liveMsgType="'+y+'"><span>'+l+"</span></li>";e+='<li class="review" id="review" style=\'z-index:'+j+";'></li>";break;case 6:u+=" <li ";if(p==0){u+='class="liactive"';$(".wen").attr("msgValue",y);$("#sendMessageDIV").addClass("hide")}u+=' liveMsgType="'+y+'"><span>'+l+"</span></li>";e+='<li class="wendang" liveMsgType="'+y+"\" style='z-index:"+j+";'>";e+="</li>";break}}$("#menuBoxDIV").append(u);$("#contentBoxDIV").prepend(e);selectChoujiang();var r=v.length;var t=function(i){return document.querySelector("."+i)};var s=r*100;var k=s-200;$(".contentBox ul").css("width",s+"%");var f=t("firstBox");var d=$(".menuBox li");var o=document.querySelector(".contentBox");var q,h;var n=document.querySelector(".contentBox ul");n.style.left="0%";if(w){mescroll=new MeScroll("mescroll",{down:{hardwareClass:"mescroll-hardware",callback:selectMessageLIVE},up:{use:false}})}for(var p=0;p<d.length;p++){d[p].addEventListener("touchend",function(i,z){return function(){m(z);n.style.left="-"+z*100+"%"}}(event,p))}o.addEventListener("touchstart",function(i){var z=i.touches[0];q=z.clientX;i.stopPropagation()});o.addEventListener("touchend",function(i){if(swiperStatus){return}var B=i.changedTouches[0];h=B.clientX-q;var A=parseInt(n.style.left);if(h>0&&h>100){if(A<=-100){n.style.left=A+100+"%";var z=(~parseInt(n.style.left)+1)/100;m(z)}}else{if(h<0&&h<-100){if(A>=-k){n.style.left=A-100+"%";var z=(~parseInt(n.style.left)+1)/100;m(z)}}}});o.addEventListener("touchmove",function(i){i.stopPropagation()});function m(z){swiperStatus=false;for(var A=0;A<d.length;A++){d[A].classList.remove("liactive")}d[z].classList.add("liactive");hideMask();var B=$(".liactive").attr("liveMsgType");$("#liveStart").addClass("hide");$("#sendMessageDIV").addClass("hide");if(B==2){$("#sendMessageDIV").removeClass("hide")}if(B==4){if(liveStart==0){$("#liveStart").removeClass("hide")}}if(B==6){checkslide()}$(".wen").attr("msgValue",B).css({background:'url("img/graywen.png") no-repeat',backgroundSize:"100%"})}$(".imgBox").lightGallery({loop:false,auto:false,closable:true});$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/checkRoomLogin.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:b},success:function(B){var A=B.code;var F;if(A==404){window.location.href="http://"+h5Base+"/phone/end.html"}else{if(A==402){F=JSON.parse(B.data).userInfo;if(F!=undefined||F!=null){var D=F.userId;if(D!=undefined||D!=null){$("input[name=userId]").val(D)}window.location.href="http://"+h5Base+"/phone/phoneNumber.html?roomId="+b+"&userId="+D}else{layer.open({content:"绑定手机号，获取用户失败",btn:"确定",yes:function(H){errorfunction()}})}}else{if(A==1){var C=JSON.parse(B.data);var E=C.repeateGuide;window.sessionStorage.setItem("roomName",C.roomTitle||"天翼直播平台");if(E==0){var i=C.openGuideSwitch;if(i==1){window.location.replace("http://"+h5Base+"/phone/guide.html?roomId="+b);return}}var G=C.roomNeedLogin;if(G==1){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b;return}else{if(G==2){F=C.userInfo;if(F!=undefined||F!=null){var D=F.userId;if(D!=undefined||D!=null){$("input[name=userId]").val(D)}var z={userphone:F.mobile};window.sessionStorage.setItem("plinfo",JSON.stringify(z))}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/getRoomInfo.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:b},success:function(aD){var ag=aD.code;if(ag==1){var X=aD.data.liveEvent;var Y=X.liveEventId;$("input[name=liveEventId]").val(Y);if(X==null||X==undefined){layer.open({content:"直播间信息错误",btn:"确定",yes:function(aH){errorfunction()}});return false}var ao=X.liveStatus;roomName=X.liveTitle||"";document.title=roomName;liveStartTime=X.liveStartTime;if(liveStartTime==null||liveStartTime==undefined){liveStartTime=""}$("#playBg").css("background-image","url("+X.converAddr+")");$(".marqueeBox").css("bottom","0");var O=liveStartTime.split(" ");var ac=O[0].split("-");var P=parseInt(ac[0],10);var aB=parseInt(ac[1],10)-1;var aA=parseInt(ac[2],10);var Q=O[1].split(":");var ad=parseInt(Q[0],10);var av=parseInt(Q[1],10);var R=parseInt(Q[2],10);var az=new Date(P,aB,aA,ad,av,R);myPlayer=videojs("video",{textTrackDisplay:false,errorDisplay:false});$(".vjs-big-play-button").addClass("hide");switch(ao){case 0:liveStart=0;var aa=X.openCountdownSwitch;if(aa==1){countdownTitle=X.countdownTitle;$("#customContent").text(countdownTitle);$(".videoPlay").removeClass("hide");$("#timeStart").removeClass("hide");var aC=az.getTime();$("#countdown").countdown({timestamp:aC,callback:function(aK,aH,aI,aJ){}})}else{$("#endLive").removeClass("hide").find(".textMask").text("本场直播尚未开始")}break;case 1:$("#playBg").addClass("hide");liveStart=1;break;case 2:liveStart=3;$("#endLive").removeClass("hide").find(".textMask").text("当前暂无直播画面");$("#playBg").addClass("hide");break;case 3:liveStart=4;$("#endLive").removeClass("hide").find(".textMask").text("本场直播已结束");break;default:}var M=X.pageDecorate;if(M==null||M==undefined){layer.open({content:"直播间错误",btn:"确定",yes:function(aH){errorfunction()}});return false}var I=0,aj=0,Z=0;for(var ay=0;ay<M.length;ay++){var K=M[ay];if(K.menuType==4){I=1}else{if(K.menuType==5){aj=1}else{if(K.menuType==1){Z=1}}}}if(I!=0){var S=$("input[name=userId]").val();var V=aD.data.enterprise;var aw=X.isSign;if(V!=null||V!=undefined){var ab=V.enterpriseId;var U=V.enterpriseImg;var at=V.enterpriseName;var T=V.enterpriseDesc;var am=V.applyTime;var W=0;if(ab==1969){W=15000}var N=W+V.concernTotal;concernTotalTemp=N;if(N>9999){N=(N/10000).toFixed(1)/1+"w"}var aE='<div class="zbjjHeader" id="enterpriseId_'+ab+'">';aE+='<div class="zbjjLeft">';aE+='		<div class="liveTitle"  title="'+roomName+'">'+roomName+"</div>";aE+="		<div class=\"small-liveTitle \"><i class='iconfont icon-shijian'></i>"+liveStartTime.slice(0,liveStartTime.length-3)+"</div>";aE+="	</div>";aE+='	<div class="zbjjHeaderCon">';aE+='		<div class="peopleNum">';aE+='			<i class="peopleIcon iconfont icon-mi"><span class="onlineNumberSpan">0</span></i>';aE+="		</div>";aE+='		<div class="shareCon">';aE+='<i id="dianZan" class="collIcon iconfont icon-dianzan" onclick="saveDianZan('+b+')" title="点赞"><span class="onlineDianZan">55.5w</span></i>';aE+='<i id="qiandao" class="signIcon iconfont icon-qiandao hide" onclick="OpenQianDao()" title="签到"><span class="onlineQianDao">0</span></i>';aE+="		</div>";aE+="	</div>";aE+="</div>";var ax=V.certStatus;var aF={cerrs:false,onclick:"",type:1,className:"guanzhu icon-jia",icon:""};if(ax==4){aF.cerrs=true;aF.onclick='onclick="zbjcompany('+ab+')"';var L=V.concernStatus;if(L!=0){aF.type=0;aF.className="yiguanzhu";aF.icon="icon-youjiantou"}}aE+='<div class="zbjcompany"  '+aF.onclick+'  id="zbjcompany">';aE+='<i class="iconfont '+aF.icon+'"></i>';aE+='<div class="companyimg"></div>';aE+='<div class="company">';aE+='<div class="small-liveTitle">';aE+="<span>"+at+"</span>";if(aF.cerrs){aE+='<span class=" iconfont btn '+aF.className+' " id="concernStatus" onclick="updateConcernStatus('+ab+","+aF.type+',event)"></span>';aE+='<span class="zhuye btn iconfont icon-jia1"></span>'}aE+="</div>";aE+='<div class="small-fans" id="concernTotal">粉丝数: <span class="smallText">'+N+"</span> 人</div>";aE+="</div>";aE+="</div>";aE+='<div class="zbjjMain">';aE+='	<div class="zbjjList">';aE+='		<div class="ListConTit">内容介绍</div>';aE+='		<div id="liveDesc_enterpriseId" class="ListCon"></div>';aE+="	</div>";aE+="</div>";aE+='<div class="yuyueBox hide" id="liveStart">';aE+=' <button class="yuyue appointment" onclick="saveAppointment()">直播开始提醒</button>';aE+="</div>"}else{var aE='<div class="zbjjHeader" id="enterpriseId_'+ab+'">';aE+='	<div class="zbjjHeaderCon">';aE+='		<div class="peopleNum">';aE+='			<i class="peopleIcon iconfont icon-mi"><span class="onlineNumberSpan">0</span></i>';aE+="		</div>";aE+='		<div class="shareCon">';aE+='<i id="dianZan" class="collIcon iconfont icon-dianzan" onclick="saveDianZan('+b+')" title="点赞"><span class="onlineDianZan">55.5w</span></i>';aE+='<i id="qiandao" class="signIcon iconfont icon-qiandao hide" onclick="OpenQianDao()" title="签到"><span class="onlineQianDao">0</span></i>';aE+="		</div>";aE+="	</div>";aE+="</div>";aE+='<div class="zbjjMain">';aE+='	<div class="zbjjList">';aE+='		<div class="ListConTit">内容介绍</div>';aE+='		<div id="liveDesc_enterpriseId" class="ListCon"></div>';aE+="	</div>";aE+="</div>"}$("#enterpriseList").html(aE);var ai=X.liveDesc;$("#liveDesc_enterpriseId").html(ai);selectRoomNumber();getEnterprise(ab);window.setInterval("selectRoomNumber()",60000);$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/register/queryIsRegister.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",liveEventId:Y,userId:S},success:function(aJ){var aI=aJ.code;if(aI==1){var aH=aJ.data.isQiandaoReg;var aK=aJ.data.isDianzanReg;if(aH==1){$("#qiandao").addClass("checked").removeAttr("onclick")}if(aK==1){$("#dianZan").addClass("checked").removeAttr("onclick")}}else{layerOpen("获取签到、点赞失败");return false}}})}var an=X.openSignupSwitch;if(an==1){var af=X.diyformAddr;window.location.href="http://"+h5Base+"/phone/form.html?roomId="+b;return}var ar=X.viewAuthorized;if(ar==2){window.location.href="http://"+h5Base+"/phone/password.html?roomId="+b;return}else{if(ar==6){window.location.href="http://"+h5Base+"/phone/FCode.html?roomId="+b;return}else{if(ar==3){var al=X.viewMoney;if(al==undefined||al==""||al==null){al=0.01}var ah=parseFloat(al)*100;var ak=$("input[name=userId]").val();var H=X.liveTitle||"";var au=X.welcomeMsg;$(".ewmTit").text(au);$("#ewmMoneyDiv").text("￥"+al);$("#checkbox-1-1").attr("wechatSweepUnifyTheOrder","wechatSweepUnifyTheOrder(3,'"+H+"',"+ah+",0)");$("#submitBtnMoney").attr("onclick","wechatSweepUnifyTheOrder(3,'"+H+"',"+ah+",0)");$("#ewmPayAgreement").attr("href","http://"+h5Base+"/phone/agree.html?roomId="+b+"&userId="+ak);var J=X.openFCodeSwitch;if(J==1){$("#ewmCode").removeClass("hide")}else{$("#ewmCode").addClass("hide")}$("#payDiv").removeClass("hide")}else{if(ar==1){tableContent(aj,b)}else{console.log("观看权限管理值为：viewAuthorized："+ar);tableContent(aj,b)}}}}var ae=X.documentId;if(ae!=0){var aG=X.documentDownload;var aq=X.documentPageNO;var ap=X.documentManual;var ab=V.enterpriseId;selectDocument(ae,aG,aq,ap);selectDocumentList(ab,ap)}}else{window.location.href="http://"+h5Base+"/phone/nopermission.html?roomId="+b}}})}}}else{layerOpen(B.message);return false}}}}})}}})}});function danmu(a){var b=$(a);if(b.hasClass("active")){danmuSwitch=false;$("canvas").barrager("clear");$("canvas").addClass("hide");b.removeClass("active");b.find(".mui-switch-handle").css({"transition-duration":"0.2s",transform:"translate(0px, 0px)"})}else{danmuSwitch=true;$("canvas").removeClass("hide");b.addClass("active");b.find(".mui-switch-handle").css({"transition-duration":"0.2s",transform:"translate(14px, 0px)"})}}function saveUserPlayRewards(){var b=$("input[name=playRewardsAmount]").val();if(b==null||b==""||b==undefined){layerOpen("打赏金额不能为空")}else{if(parseFloat(b)<parseFloat(minRewardsAmount)||parseFloat(b)>parseFloat(maxRewardsAmount)){layerOpen("打赏金额超出打赏范围")}else{var c=parseFloat(b)*100;var a=$("title").text();wechatSweepUnifyTheOrder(2,a,c,0)}}}function saveUserPlayRewardsPay(){var a=$("input[name=playRewardsAmount]").val();if(a==null||a==""||a==undefined){layerOpen("打赏金额不能为空")}else{if(parseFloat(a)<parseFloat(minRewardsAmount)||parseFloat(a)>parseFloat(maxRewardsAmount)){layerOpen("打赏金额超出打赏范围")}else{var c=$("input[name=roomId]").val();var b=$("input[name=userId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/rewards/addPlayRewards.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:c,playRewardsAmount:a,userId:b},success:function(d){if(d.code==1){console.log("打赏成功");$(".rewardMask").slideUp(500)}else{layerOpen(d.message)}}})}}}$(".btnIcons").on("click",function(){$(this).toggleClass("active");$(this).prev().toggleClass("active ").find(".livemask").toggleClass("hide")});function selectChoujiang(){console.log("回去抽奖、投票是否开启");var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isStartPrizr.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(f){var e=f.code;if(e==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a}else{if(e==402){saveMessagerPhoneNumber()}else{if(e==403){}else{if(e==1){var c=f.data.isPlayRewards;var h=f.data.isStartPrizr;var g=f.data.isStartRedPacket;var b=f.data.isStartSign;var d=f.data.isStartVote;if(b){setTimeout(function(){$("#qiandao").removeClass("hide")},350)}else{setTimeout(function(){$("#qiandao").addClass("hide")},350)}if(h||d||c||g){setTimeout(function(){$(".btnIcons").removeClass("hide")},350)}else{setTimeout(function(){$(".btnIcons").addClass("hide")},350)}if(h==1){$(".drawIcon").removeClass("hide")}if(d==1){$(".toupiaoIcon").removeClass("hide")}if(g==1){$(".hongbaoIcon").removeClass("hide");hongbao()}if(c==1){$(".rewardIcon").removeClass("hide");playRewards()}}else{layerOpen(f.message)}}}}}})}function playRewards(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/rewards/selectPlayRewards.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a,terminalType:"h5"},success:function(d){if(d.code==1){var b=d.data;if(b.rewardsSwitch==0){$(".rewardIcon").addClass("hide");minRewardsAmount=0;maxRewardsAmount=0}else{$(".rewardIcon").removeClass("hide");if(b.rewardsTitleType==0){$(".rewardPic").text(b.promotionalLanguage)}else{if(b.rewardsTitleType==1){var c='<img src="'+b.promotionalImage+'" alt=""/>';$(".rewardPic").html(c)}}minRewardsAmount=parseFloat(b.minRewardsAmount);maxRewardsAmount=parseFloat(b.maxRewardsAmount);$("input[name=playRewardsAmount]").attr("placeholder",minRewardsAmount+"~"+maxRewardsAmount+"元")}}else{layerOpen(d.message)}}})}var hbflag=false;function hongbao(){$(".hongbaoIcon").on("click",function(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isRedPacket.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(d){var c=d.code;if(c==1){openhongbao(d.packet.command);hbflag=true}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"data.message"})}}});$(".hongbaoClose").on("click",function(){$(".hongbaoMask").slideUp(500);$(".livemask").click()});var b=new ClipboardJS(".copyBtn");b.on("success",function(c){console.info("Action:",c.action);console.info("Text:",c.text);console.info("Trigger:",c.trigger);layerOpen("复制成功");c.clearSelection()});b.on("error",function(c){layerOpen("复制失败，请长按复制")})})}function openhongbao(i){$(".hongbaoMask").slideDown(500);if(hbflag){return}var j=i.split("");var a=$("#popuphongbao")[0];var h=a.getContext("2d");var b=$("#imghongbao")[0];var g=new Image();var f=[];var e=[];$.each(j,function(l,k){if(l<=9){f.push(k)}else{e.push(k)}});var d=f.join("  ");var c=e.join("  ");g.src="img/hongbaokl.png";g.onload=function(){h.drawImage(g,0,0);h.textBaseline="middle";h.textAlign="center";var l=a.width/2;var k=a.height/2;h.fillStyle="#000";if(c.length>0){h.font="24px Microsoft YaHei";h.fillText(d,l,k+45);h.fillText(c,l,k+80)}else{h.font="28px Microsoft YaHei";h.fillText(d,l,k+65)}b.src=a.toDataURL("image/jpg");$("#copyhongbao").val(i)}}function selectGiftList(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/gift/giftList.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a,terminalType:"h5"},success:function(f){if(f.code==1){var d=f.isSystemGift;if(d==1){var b=f.data;var g="";for(var c=0;c<b.length;c++){var e=b[c];g+='<li id="gift_'+e.giftId+'" giftId="'+e.giftId+'" giftPrice="'+e.giftPrice+'" giftName="'+e.giftName+'">';g+='	<div class="giftPic"><img src="'+e.giftImage+'" alt=""/></div>';g+='	<div class="giftName">'+e.giftName+"</div>";g+='	<div class="giftMoney">'+e.giftPrice+"元</div>";g+="</li>"}$("#giftList").html(g);$(".giftIcon").removeClass("hide")}else{$(".giftIcon").addClass("hide")}}else{layerOpen(f.message)}}})}function saveMessagerPhoneNumber(){console.log("弹框进行手机号绑定");$(".passMask").fadeIn(500)}$(".closepass .icon-close").click(function(){$(".passMask").fadeOut()});function selectAdvertising(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectAdvertising.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(e){if(e.code==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a}else{if(e.code==402){saveMessagerPhoneNumber()}else{if(e.code==403){}else{if(e.code==1){var d=e.data;var b=d.startType;if(b==1){console.log("开启");var c=d.content;$("#iLiveRollingAdvertising").removeClass("hide").text(c);$("#iLiveRollingAdvertising").marquee({duration:5000})}else{console.log("关闭");$("#iLiveRollingAdvertising").addClass("hide")}}else{console.log("获取滚动消息失败："+e.message)}}}}}})}function selectRoomLogo(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectRoom.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(f){if(f.code==1){var d=JSON.parse(f.iLiveLiveRoom);var b=d.liveEvent;var e=b.openLogoSwitch;var c=b.liveTitle||""}else{layer.open({content:"获取直播间信息失败",btn:"确定",yes:function(g){errorfunction()}})}}})}function selectAppointment(){var a=$("input[name=userId]").val();if(a!=0){var b=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/homepage/isAppointment.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,roomId:b},success:function(c){if(c.code==1){if(c.data.isAppointment==1){$(".appointment").addClass("select").text("取消提醒")}else{$(".appointment").removeClass("select").text("直播开始提醒")}}else{layerOpen("预约信息查询失败!")}}})}}function saveAppointment(){var a=$("input[name=userId]").val();var b=$("input[name=roomId]").val();if(a==0){var b=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/homepage/saveAppointment.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,roomId:b},success:function(d){if(d.code==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{if(d.code==402){saveMessagerPhoneNumber()}else{if(d.code==403){}else{if(d.code==1){if(d.data.userid!=undefined){var c=d.status;if(c==1){selectAppointment();layer.open({content:d.message,btn:["是","否"],yes:function(){openConfirm()},no:function(e){layer.close(e)}})}else{if(c==2){selectAppointment();layerOpen(d.message)}}}else{$(".appointment").text("直播开始提醒");layerOpen(d.message)}}else{layerOpen("预约失败")}}}}}})}}function openConfirm(){console.log("你确认了查看直播方更多直播内容");window.location.href="http://apizb.tv189.com/version/wap/download/ios"}function temporaryCancel(){console.log("你放弃查看直播方更多直播内容")}var signId,flag=true;function OpenQianDao(){var a=winHeight-VideoBox-menuBox;GetSignId(function(){$(document.body).addClass("modal-open");layerId=layer.open({type:1,content:qiandaoHTML(),anim:"up",style:"position:absolute; left:0; bottom:0; width:100%; height:"+a+"px; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;"})})}function GetSignId(b){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isSign.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(c){if(c.code==1){signId=c.signId;b()}else{layerOpen(c.message);return false}}})}function qiandaoHTML(){html='<div class="main-popup "><div class="Input"><input type="tel" placeholder="手机号"   maxlength="11" name="phoneNum" id="phoneNum" onblur="validate(this)"/></div><div class="Input"><input type="tel" placeholder="动态密码"  maxlength="6"  name="vPassword_Q" onblur="wchatHackInput()"/><span class="yzmBtn1" onclick="getAuthenticode(this)" id="spenTimer">获取动态密码</span></div><div class="Input"><input type="text" placeholder="昵称 建议使用您的真实姓名签到，2-10个字"  minlength="2" maxlength="10" onblur="wchatHackInput()" name="username_Q"/></div><div class="text-center loginBox"><button type="button" class="confirmbutton QiandaoBtn disableBtn" disabled onclick="saveQiandao()">点击立即签到</button></div></div>';return html}function validate(b){wchatHackInput();var a=b.value;if(a!=null&&a!=""){if(!isPoneAvailable(a.trim())){layerOpen("请输入正确的手机号");return false}$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/prize/siginPhone.jspx?userPhone="+a+"&signId="+signId,dataType:"jsonp",jsonp:"callback",async:false,cache:false,success:function(d){var c=d.status;if(c==1){layerOpen("您已签到");$(".QiandaoBtn").attr("disabled","true").addClass("disableBtn");return false}else{$(".QiandaoBtn").removeAttr("disabled").removeClass("disableBtn")}}})}}function saveQiandao(){wchatHackInput();var c=$("input[name=phoneNum]").val();var a=$("input[name=vPassword_Q]").val();var d=$("input[name=username_Q]").val();if(c==undefined||c.replace("s+","")==""){layerOpen("请输入手机号!");return false}if(a==undefined||a.replace("s+","")==""){layerOpen("验证码不能为空!");return false}if(d==undefined||d.replace("s+","")==""){layerOpen("昵称不能为空!");return false}var b="http://"+tomcatBase+"/ilive/prize/userSign.jspx";$.ajax({type:"POST",url:b,dataType:"jsonp",jsonp:"callback",cache:false,data:{userphone:c,username:encodeURIComponent(d),vPassword:a,roomId:roomId,signId:signId},success:function(e){if(e.status=="0"){layerOpen(e.msg);return false}if(e.status==1000){layerOpen(e.msg);layer.close(layerId);return false}if(e.status==1001){layerOpen(e.msg);return false}if(e.status==1002){layerOpen(e.msg);return false}}})}function saveDianZan(b){var a=$("input[name=userId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/register/registerRoom.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,roomId:b},success:function(c){if(c.code==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{if(c.code==402){saveMessagerPhoneNumber()}else{if(c.code==403){}else{if(c.code==1){$("#dianZan").removeAttr("onclick").addClass("checked")}else{layerOpen(c.message)}}}}}})}function hideMask(){$(".replymask").addClass("hide");$(".replyBox").addClass("hide");$(".newmask").addClass("hide")}$(".talkConRight").click(function(){var a=$("input[name=userId]").val();if(a==0){var b=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b;return}else{$(".wen").attr("msgValue","2");$(".newmask").removeClass("hide");$('input[name="msgContent"]').focus()}});$(".talkConLeft").click(function(){var a=$("input[name=userId]").val();if(a==0){var b=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b;return false}else{$(".wen").attr("msgValue","3");$(".wen").css({background:"url(img/question.png) no-repeat","background-size":"100% 100%"});$(".newmask").removeClass("hide");$('input[type="text"],textarea').focus().attr("maxlength","100")}});$(".livemask").click(function(){if($(this).parent().hasClass("liveIcon")){$(this).addClass("hide");$(this).parent().removeClass("active").next().removeClass("active");return}$(this).parent().addClass("hide");$(".wen").attr("msgValue","2");$('input[type="text"],textarea').attr("maxlength","40")});$(".talkCon .wen").click(function(){if($(this).attr("msgValue")==3){$(this).css({background:"url(img/graywen.png) no-repeat","background-size":"100% 100%"});$(this).attr("msgValue","2");$('input[type="text"],textarea').attr("maxlength","40")}else{$(this).css({background:"url(img/question.png) no-repeat","background-size":"100% 100%"});$(this).attr("msgValue","3");$('input[type="text"],textarea').attr("maxlength","100")}});$(".textarea").bind("input propertychange",function(){if($(".textarea").val().length!=0){$(".sendMessage").removeAttr("disabled");$(".sendMessage").css("background","#0084ff")}else{$(".sendMessage").css("background","#b2daff")}});$(".replyInput").bind("input propertychange",function(){if($(".replyInput").val().length!=0){$(".replyMessage").removeAttr("disabled");$(".replyMessage").css("background","#0084ff")}else{$(".replyMessage").css("background","#b2daff");$(".replyMessage").attr("disabled",true)}});var commentsAllow=0;function selectMessageLIVE(){var a=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/message/selectMessageLIVE.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(d){var b=d.code;if(b==1){if(mescroll){mescroll.endSuccess()}var e=d.data;commentsAllow=d.commentsAllow;var l="";var g="";if(e.length>0){for(var f=0;f<e.length;f++){var h=e[f];if(h.top==0){l+='<div class="themeBox" id="msgId_'+h.msgId+'">';l+='	<div class="themeHeader">';l+='		<div class="themeName">';l+='			<span class="inlineName">'+h.senderName+"：</span>";l+='			<span class="hottheme"><i class="fireIcon"></i> '+h.senderImage+"</span>";l+="		</div>";l+='		<div class="themeTime">'+h.createTime+"</div>";l+="	</div>";l+='	<div class="themeBody">';l+='		<div class="themeText">'+h.webContent+"</div>";l+='		<div class="themeText thumb" thumblist="list1">';if(h.msgType==2||h.msgType==4){var k=h.images;for(var c=0;c<k.length;c++){l+='<img class="toBig" src="'+k[c]+'"/>'}}else{if(h.msgType==5||h.msgType==3){l+='<video id="video_'+h.msgId+'"  poster="http://pic.zb.tv189.com/img/defaultVedio.png" class="toVideo" src="'+h.video+'" controls></video>'}}l+="		</div>";l+=' 		<div class="themeBottom">';l+=' 			<div class="reply"  onclick="commentsList('+h.msgId+')">';l+='				<i class="replyIcon iconfont icon-huifu"></i><span class="inlineName">回复</span>';l+="			</div>";l+=' 			<div class="comment" id="messagePraise_'+h.msgId+'">';l+=' 				<i class="heartIcon iconfont icon-xin" onclick="saveILiveMessagePraise('+h.msgId+')"/></i><span class="inlineName" id="praiseNumber_'+h.msgId+'" >'+h.praiseNumber+"</span>";l+=" 			</div>";l+=" 		</div>";l+=" 	</div>";l+=' 	<div class="themeFooter" id="commentsList_'+h.msgId+'"><div class="arrow-up"></div><div class="tishi">暂无评论</div></div>';l+="</div>"}else{g+='<div class="themeBox" id="msgId_'+h.msgId+'">';g+='	<div class="themeHeader">';g+='		<div class="themeName">';g+='			<span class="inlineName">'+h.senderName+"：</span>";g+='			<span class="hottheme"><i class="fireIcon"></i> '+h.senderImage+"</span>";g+='			<span class="zdBox">置顶</span>';g+="		</div>";g+='		<div class="themeTime">'+h.createTime+"</div>";g+="	</div>";g+='	<div class="themeBody">';g+='		<div class="themeText">'+h.webContent+"</div>";g+='		<div class="themeText thumb" thumblist="list1">';if(h.msgType==2||h.msgType==4){var k=h.images;for(var c=0;c<k.length;c++){g+='<img class="toBig" src="'+k[c]+'"/>'}}else{if(h.msgType==5||h.msgType==3){g+='<video id="video_'+h.msgId+'"  class="toVideo" poster="http://pic.zb.tv189.com/img/defaultVedio.png"  src="'+h.video+'" controls></video>'}}g+="		</div>";g+=' 		<div class="themeBottom">';g+=' 			<div class="reply"  onclick="commentsList('+h.msgId+')">';g+='				<i class="replyIcon iconfont icon-huifu"></i><span class="inlineName">回复</span>';g+="			</div>";g+=' 			<div class="comment" id="messagePraise_'+h.msgId+'">';g+=' 				<i class="heartIcon iconfont icon-xin" onclick="saveILiveMessagePraise('+h.msgId+')"/></i><span class="inlineName" id="praiseNumber_'+h.msgId+'" >'+h.praiseNumber+"</span>";g+=" 			</div>";g+=" 		</div>";g+=" 	</div>";g+=' 	<div class="themeFooter" id="commentsList_'+h.msgId+'"><div class="arrow-up"></div><div class="tishi">暂无评论</div></div>';g+="</div>"}}}$("#topTalkBoxList1").html(g);$("#themeDiv").html(l);$(".redDot").addClass("hide");$("#newTopic").addClass("hide");if(e.length==0){$("#topicNull").removeClass("hide")}else{$("#topicNull").addClass("hide");selectcommentsList(a)}}else{console.log("失败")}},error:function(b){if(mescroll){mescroll.endErr()}}})}$(".closeReply").click(function(){$(".replyBox").addClass("hide");$(".replyCon").html("");$(".replyDiv").removeAttr("onclick")});function selectCommentAll(b){var a=$("input[name=userId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/comments/selectCommentsAllByMsgId.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",msgId:b,userId:a},success:function(f){var c=f.code;if(c==1){var h="";var e=JSON.parse(f.commentsList);for(var d=0;d<e.length;d++){var g=e[d];h+='<div class="pinlun">';h+='		<span class="plname">'+g.commentsName+":</span>"+g.comments;h+="	</div>"}$(".replyBox").removeClass("hide");$(".replyCon").html(h);$(".replyDiv").attr("onclick","commentsList("+b+")")}else{console.log(f.message)}}})}function saveILiveMessagePraise(c){var a=$("input[name=userId]").val();if(a==0){var b=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b;return}$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/praise/savePraise.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,msgId:c},success:function(g){var d=g.code;if(d==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{if(d==402){saveMessagerPhoneNumber()}else{if(d==403){}}}if(d==1){var f=g.praiseNumber;if(f==0){var e=$("#praiseNumber_").text();var h='<i class="heartIcon iconfont icon-xin checked"></i>';h+='<span  class="inlineName" id="praiseNumber_'+c+'">'+e+"</span>";$("#messagePraise_"+c).html(h)}else{var h='<i class="heartIcon iconfont icon-xin checked"></i>';h+='<span  class="inlineName" id="praiseNumber_'+c+'">'+f+"</span>";$("#messagePraise_"+c).html(h)}return}else{layerOpen("点赞操作失败")}}})}function selectMediaFile(a){var c=$("input[name=roomId]").val();var b=$("input[name=userId]").val();if(b==""||b==undefined){b=0}window.location.href="http://"+h5Base+"/phone/review.html?fileId="+a+"&userId="+b+"&roomId="+c}function selectTimer(r){var p=r.split(" ");var l=p[0].split("-");var o=parseInt(l[0],10);var a=parseInt(l[1],10)-1;var u=parseInt(l[2],10);var m=p[1].split(":");var i=parseInt(m[0],10);var f=parseInt(m[1],10);var b=parseInt(m[2],10);var t=new Date(o,a,u,i,f,b);var e=new Date();var d=t.getTime()-e.getTime();if(d>0){var c=Math.floor(d/(24*3600*1000));var k=d%(24*3600*1000);var q=Math.floor(k/(3600*1000));var j=k%(3600*1000);var n=Math.floor(j/(60*1000));var h=j%(60*1000);var g=Math.round(h/1000);var s=c+" 天 "+q+" 小时 "+n+" 分钟 "+g+" 秒";$("#openCountdownSwitch").text(s);setTimeout(function(){selectTimer(r)},1000)}else{$("#openCountdownSwitch").text("0 天 0 小时 0 分钟 0  秒")}}var ws;function selectHTML(a){window.setInterval(function(){var c={p:"1"};if(ws){try{ws.send(JSON.stringify(c))}catch(b){console.log("websocket 连接已关闭")}}},10000);$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/roomenter.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a,sessionType:1,webType:1},success:function(g){if(g.code==404){window.location.href="http://"+h5Base+"/phone/end.html"}else{if(g.code==402){var f=$("input[name=userId]").val();if(f!=0){window.location.href="http://"+h5Base+"/phone/phoneNumber.html?roomId="+a+"&userId="+f}else{layer.open({content:"绑定手机号，获取用户失败",btn:"确定",yes:function(j){errorfunction()}});return false}}else{if(g.code==1){hlsAddr=g.hlsAddr;switch(liveStart){case 0:$("#liveStart").removeClass("hide");$("#enterpriseList").css("padding-bottom","1.25rem");break;case 1:$(".marqueeBox").css("bottom","16%");myPlayer.ready(function(){$(".vjs-big-play-button").removeClass("hide");this.src({src:hlsAddr,type:"application/x-mpegURL"});this.poster(g.data.liveEvent.playBgAddr);$(".vjs-live-control").text("实时直播")});break;case 2:liveStart=1;$(".videoBox").append('<div id="vLoad"></div>');setTimeout(function(){$("#vLoad").hide();$(".marqueeBox").css("bottom","16%");myPlayer.ready(function(){$(".vjs-big-play-button").removeClass("hide");this.src({src:hlsAddr,type:"application/x-mpegURL"});this.poster(g.data.liveEvent.playBgAddr);$(".vjs-live-control").text("实时直播")})},13000);break;case 3:setTimeout(function(){myPlayer.ready(function(){this.poster(g.data.liveEvent.playBgAddr)})},0);break;case 4:$("#liveStart").addClass("hide");$("#enterpriseList").css("padding-bottom",".5rem");break}selectRoomLogo();selectAdvertising();selectGiftList();var e=g.token;var d=10;var c=g.estoppelType;if(c==0){$(".jinyanBox").removeClass("hide");$("#jinyanBoxImg").attr("src","img/jinyan.png")}else{var i=g.forbidTalk;console.log("禁言标示："+i);if(i==1){d=11;$(".jinyanBox").removeClass("hide");$("#jinyanBoxImg").attr("src","img/jinyan.png")}else{d=10;$(".jinyanBox").addClass("hide");$("#jinyanBoxImg").attr("src","img/talking.png")}}if(typeof(WebSocket)=="undefined"){layer.open({content:"你的浏览器不支持信息交流",btn:"确定",yes:function(j){errorfunction()}});return}var b="ws://"+tomcatBase+"/ilive/webSocketServer.jspx?username="+e;ws=new WebSocket(b);ws.onopen=function(j){console.log("连接成功")};ws.onclose=function(j){console.log("关闭连接 ")};ws.onerror=function(j){console.log("建立连接异常");window.location.href=window.location.href};ws.onmessage=function(z){var w=JSON.parse(z.data);var F=w.liveMsgType;switch(w.roomType){case 0:var C=w.iLiveEventVo;c=C.estoppleType;if(c==0){$(".jinyanBox").removeClass("hide");$("#jinyanBoxImg").attr("src","img/jinyan.png")}else{if(c==1){if(d==11){$(".jinyanBox").removeClass("hide");$("#jinyanBoxImg").attr("src","img/jinyan.png")}else{$(".jinyanBox").addClass("hide");$("#jinyanBoxImg").attr("src","img/talking.png")}}}var x=C.liveStatus;var q=C.playBgAddr;switch(x){case 1:setTimeout(function(){$("#endLive").addClass("hide");$("#playBg").addClass("hide");$(".videoPlay").addClass("hide");$(".marqueeBox").css("bottom","16%");myPlayer.ready(function(){$(".vjs-big-play-button").removeClass("hide");this.pause();this.src({src:hlsAddr,type:"application/x-mpegURL"});$(".vjs-live-control").text("实时直播")})},5000);break;case 2:setTimeout(function(){$(".marqueeBox").css("bottom","0");$("#endLive").removeClass("hide").find(".textMask").text("当前暂无直播画面");myPlayer.ready(function(){$(".vjs-big-play-button").addClass("hide");this.pause();this.src({src:"none",type:"application/x-mpegURL"})})},5000);break;case 3:setTimeout(function(){$("#playBg").removeClass("hide");$("#endLive").removeClass("hide").find(".textMask").text("本场直播已结束");$(".marqueeBox").css("bottom","0");myPlayer.ready(function(){$(".vjs-big-play-button").addClass("hide");this.pause();this.src({src:"none",type:"application/x-mpegURL"})})},23000);break}break;case 1:var r=w.deleteAll;var t;if(r==1){$("#talkBoxList2").children().remove();$("#topTalkBoxList2").children().remove()}else{if(w.deleted==1){$("#msgId_"+w.msgId).remove()}else{var n=$("input[name=userId]").val();if(w.senderId==n){if(c==1){d=w.opType;if(d==11){$(".jinyanBox").removeClass("hide");$("#jinyanBoxImg").attr("src","img/jinyan.png");$(".giftIcon").addClass("hide")}else{$(".jinyanBox").addClass("hide");$("#jinyanBoxImg").attr("src","img/talking.png");$(".giftIcon").removeClass("hide")}}else{d=w.opType}}if(F==2){flyDanmu(w.webContent);if(w.checked==1){$("#msgId_"+w.msgId).remove();if(w.top==0){t='<div class="talkline commentBox" id="msgId_'+w.msgId+'">';t+='	<div class="userImg"><img src='+w.senderImage+"></div>";t+='	<div class="commentText"><div class="inlineName"><span class="senderName">'+w.senderName+"</span><span class='createTime'>"+w.createTime+'</span> </div><div class="comment">'+w.webContent+"</div> </div>";t+="</div>";$("#topTalkBoxList2 #msgId_"+w.msgId).prepend(t);$("#talkBoxList2").prepend(t)}else{t='<div class="topBox" id="msgId_'+w.msgId+'">';t+='	<div class="userImg"><img src='+w.senderImage+"></div>";t+='	<div class="commentText"><div class="inlineName"><span class="senderName">'+w.senderName+"</span><i class=\"questionIcon stickIcon\"></i><span class='createTime'>"+w.createTime+'</span></div><div class="comment">'+w.webContent+"</div> </div>";t+="</div>";$("#talkBoxList2 #msgId_"+w.msgId).prepend(t);$("#topTalkBoxList2").prepend(t)}}else{if(w.senderId==n){$("#msgId_"+w.msgId).remove();if(w.top==0){t='<div class="talkline commentBox" id="msgId_'+w.msgId+'">';t+='	<div class="userImg"><img src='+w.senderImage+"></div>";t+='	<div class="commentText"><div class="inlineName"><span class="senderName">'+w.senderName+"</span><span class='createTime'>"+w.createTime+'</span></div><div class="comment">'+w.webContent+"</div> </div>";t+="</div>";$("#topTalkBoxList2 #msgId_"+w.msgId).prepend(t);$("#talkBoxList2").prepend(t)}else{t='<div class="topBox" id="msgId_'+w.msgId+'">';t+='	<div class="userImg"><img src='+w.senderImage+"></div>";t+='	<div class="commentText"><div class="inlineName"><span class="senderName">'+w.senderName+"</span><i class=\"questionIcon stickIcon\"></i><span class='createTime'>"+w.createTime+'</span></div><div class="comment">'+w.webContent+"</div> </div>";t+="</div>";$("#talkBoxList2 #msgId_"+w.msgId).prepend(t);$("#topTalkBoxList2").prepend(t)}}}}else{if(F==3){if(w.replyType==0){var B=w.senderId;var n=$("input[name=userId]").val();if(B==0||B==null||B==undefined){}else{if(B==n){t='<div class="talkline questionBox" id="msgId_'+w.msgId+'" >';t+='	<div class="userImg"><img src='+w.senderImage+"></div>";t+='	<div class="commentText"><div class="inlineName">'+w.senderName+' <i class="questionIcon"><img src="img/question.png"></i><span class=\'createTime\'>'+w.createTime+'</span></div><div class="comment">'+w.webContent+"</div> </div>";t+="</div>";$("#msgId_"+w.msgId).remove();t+="</div>";$("#talkBoxList2").prepend(t)}}}else{t='<div class="talkline questionBox" id="msgId_'+w.msgId+'" >';t+='	<div class="userImg"><img src='+w.senderImage+"></div>";t+='	<div class="commentText"><div class="inlineName">'+w.senderName+' <i class="questionIcon"><img src="img/question.png"></i><span class=\'createTime\'>'+w.createTime+'</span></div><div class="comment">'+w.webContent+"</div> </div>";t+='	<div class="questionanswer">';t+='		<div class="arrow-up"></div>';t+='		<div class="questionName"><i class="questionIcon"><img src="img/answer.png" alt=""/></i><span class="inlineName">'+w.replyName+"</span></div>";t+='		<div class="commentText">'+w.replyContent+"</div>";t+="	</div></div>";t+="</div>";t+="</div>";$("#msgId_"+w.msgId).remove();t+="</div>";$("#talkBoxList2").prepend(t)}}}}}var v=$("#topTalkBoxList2").height();var y=$("#talkBoxList2").height();if((v+y)>$("#talkLi").height()){$("#talkLi").addClass("dixian")}break;case 2:console.log("发现新话题");$(".redDot").removeClass("hide");$("#newTopic").removeClass("hide");break;case 3:window.location.href="http://"+h5Base+"/phone/end.html";break;case 4:console.log("广告滚动");selectAdvertising();break;case 5:console.log("抽奖");selectChoujiang();break;case 6:console.log("投票");selectChoujiang();break;case 7:console.log("赠送礼物");var E=w.iLiveUserGift;if(E.giftOperation==0){var p=E.userName;var D=E.giftImage;var j=E.giftNumber;arr.push({code:0,userName:p,giftImage:D,giftNumber:j});giveGift()}else{selectGiftList()}break;case 8:break;case 9:console.log("打赏");var k=w.iLiveUserPlayRewards;if(k.playRewardsOperation==0){playRewards()}else{var o=k.playRewardsAmount;var p=k.userName;arr.push({code:1,userName:p,rewardsPrice:o});giveGift()}break;case 10:var s=w.welcomeLanguage;arr.push({code:2,welcomeLanguage:s});giveGift();break;case 11:var m=w.documentId;var u=w.documentPageNO;var A=w.documentManual;var l=w.documentDownload;selectDocument(m,l,u,A);break;case 15:console.log("签到活动");selectChoujiang();break;case 16:console.log("红包");selectChoujiang();break;default:console.log("操作类型"+w.roomType)}}}else{if(g.code==2){var h=window.sessionStorage.getItem("permissionsjump");if(h==null||h=="true"){window.sessionStorage.setItem("permissionsjump",true);window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a;return false}window.location.href="http://"+h5Base+"/phone/permissions.html?roomId="+a}else{if(g.code==3){window.location.href="http://"+h5Base+"/phone/standby.html?roomId="+a}else{window.location.href="http://"+h5Base+"/phone/error.html?roomId="+a}}}}}}})}function errorfunctionAuthentication(){var a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/permissions.html?roomId="+a}function errorfunctionFull(){var a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/standby.html?roomId="+a}function sendMessageSubmitted(){wchatHackInput();var b=$("input[name=roomId]").val();var a=$("input[name=userId]").val();if(a==0){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b;return}var c=$(".wen").attr("msgValue");console.log("消息类型："+c);var e=$.trim($("input[name=liveEventId]").val());var d=$.trim($("input[name=msgContent]").val());if(d.replace("/^s+|s+$/g+","")==""||d==undefined){layerOpen("请输入消息内容");return false}if(c==2||c==3){$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/sendMessage.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,roomId:b,liveMsgType:c,content:encodeURI(d),liveEventId:e,msgType:1},success:function(h){var f=h.code;if(f==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{if(f==402){saveMessagerPhoneNumber()}else{if(f==403){}else{if(f==1){console.log("发送消息成功");var g=h.iLiveMessage;$(".wen").attr("msgValue","2");$(".newmask").addClass("hide");$("input[name=msgContent]").val("");var i=document.getElementById("talkLi");i.scrollTop=0}else{layerOpen("消息发送失败")}}}}}})}else{layerOpen("发送消息类型错误")}}function saveTopicContent(){if(commentsAllow==0){$(".livemask").parent().addClass("hide");$(".replyBox").addClass("hide");$(".replyCon").html("");$("textarea[name=topicContent]").val("");$(".replyDiv").removeAttr("onclick");layerOpen("评论功能已关闭")}else{var a=$("input[name=userId]").val();var d=$("input[name=commentsMsgId]").val();if(a==0){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+roomId;return false}if(d==0){layerOpen("请选择评论话题");return false}var c=$.trim($("textarea[name=topicContent]").val());var b=c.replace(new RegExp(/\n/g),"<br>");var e=b.replace(new RegExp(/\s/g),"&nbsp;");if(e.replace("/^s+|s+$/g+","")==""||e==undefined){layerOpen("评论内容不能为空");return false}$(".livemask").parent().addClass("hide");$(".replyBox").addClass("hide");$(".replyCon").html("");$("textarea[name=topicContent]").val("");$(".replyDiv").removeAttr("onclick");$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/saveComments.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,msgId:d,comments:encodeURI(e)},success:function(g){var f=g.code;if(f==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+roomId;return}else{if(f==402){saveMessagerPhoneNumber()}else{if(f==403){}}}$(".livemask").parent().addClass("hide");$(".replyBox").addClass("hide");$(".replyCon").html("");$("textarea[name=topicContent]").val("");$(".replyDiv").removeAttr("onclick");if(f==1){selectMessageLIVE()}else{layerOpen("评论发送失败")}}})}}function commentsList(c){var a=$("input[name=userId]").val();if(a==0){var b=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{$("input[name=commentsMsgId]").val(c);$(".replymask").removeClass("hide");$('textarea[name="topicContent"]').focus()}}function selectRoomNumber(){var a=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/online/number.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(d){var b=d.code;if(b==1){var c=JSON.parse(d.data).number;if(c==undefined||c==null){c=0}checknumberlength($(".onlineNumberSpan"),c)}}})}function selectcommentsList(b){var a=$("input[name=userId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/comments/selectList.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:b,userId:a},success:function(l){var k=l.code;if(k==1){var t=JSON.parse(l.iLiveCommentsMap);for(var m=0;m<t.length;m++){var d=t[m];var r=d.list;var e='<div class="arrow-up"></div>';for(var h=0;h<r.length;h++){if(h<5){var p=r[h];e+='<div class="pinlun">';e+='		<span class="plname">'+p.commentsName+":</span>"+p.comments;e+="	</div>"}}if((r.length!=0)&&(r.length>5)){e+='<div class="tishi discuss" onclick="selectCommentAll('+d.msgId+")\"><i class='iconfont icon-laquo'></i> 查看全部"+r.length+"条评论</div>"}$("#commentsList_"+d.msgId).html(e)}var n=JSON.parse(l.praiseMap);for(var s in n){var f=n[s].length;if(f==undefined){f=0}var q=0;for(var m=0;m<f;m++){var o=n[s][m];var c=o.userId;if(parseInt(a)==parseInt(c)){q=1}}if(q==0){var g='<i class="heartIcon iconfont icon-xin"  onclick="saveILiveMessagePraise('+s+')"></i>';g+='<span  class="inlineName" id="praiseNumber_'+s+'">'+f+"</span>";$("#messagePraise_"+s).html(g)}else{var g='<i class="heartIcon iconfont icon-xin checked"></i>';g+='<span  class="inlineName" id="praiseNumber_'+s+'">'+f+"</span>";$("#messagePraise_"+s).html(g)}}}else{layerOpen("获取话题评论失败")}}})}function tableContent(a,b){selectHTML(b);selectAppointment();if(a!=0){$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/getrecordlist.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:b},success:function(c){if(c.code==1){getReviewList(c)}else{layerOpen("直播回看获取失败")}}})}}function loginfunction(){var a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a}function loadJsCss(a,b){if(b=="js"){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a)}else{if(b=="css"){var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a)}}if(typeof c!="undefined"){document.getElementsByTagName("head")[0].appendChild(c)}}var gallerySwiper,thumbsSwiper,def_Manual;function selectDocument(c,b,d,a){def_Manual=a;if(c==-1){checkslide();if(b==0){$(".pptBtn").addClass("hide")}gallerySwiper.slideTo(d-1,1000,false)}else{$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/document/getByd.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{docId:c},success:function(j){if(j.code==1){var h=j.data;var e=h.list;var k="";k+='<div class="swiper-container " id="gallery">';k+='  <div class="swiper-wrapper">';k+="  </div>";k+="</div>";k+='<div class="swiper-container " id="thumbs">';k+='  <div class="swiper-wrapper">';for(var g=0;g<e.length;g++){var f=e[g].url;k+='<div class="swiper-slide"><img src="'+f+'"></div>'}k+="  </div>";k+='<div class="swiper-scrollbar"></div>';k+="</div>";k+="</div>";if(b==0){k+='	<div class="pptBtn hide">';k+="	</div>"}else{k+='	<div class="pptBtn" style="top:40%"  onclick="downloadMask()">';k+="	</div>"}$(".wendang").html(k);wendangJS(e,d-1);if(b==0){$(".pptBtn").addClass("hide")}else{$(".pptBtn").removeClass("hide")}}else{layerOpen(j.message)}}})}}var firstImg;var num;var imgW;var timer;function wendangJS(a,b){thumbsSwiper=new Swiper("#thumbs",{spaceBetween:10,slidesPerView:3.5,watchSlidesVisibility:true,watchSlidesProgress:true,noSwiping:true,freeMode:true,freeModeMomentumRatio:5});gallerySwiper=new Swiper("#gallery",{spaceBetween:10,width:window.innerWidth,noSwiping:true,virtual:{slides:(function(){var e=[];for(var d=0;d<a.length;d++){var c=a[d].url;e.push('<div class="swiper-slide"><img data-src="'+c+'"  class="swiper-lazy"><div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div></div>')}return e}())},lazy:{loadPrevNext:true,loadPrevNextAmount:2},thumbs:{swiper:thumbsSwiper},scrollbar:{el:".swiper-scrollbar",draggable:true}});gallerySwiper.slideTo(b,1000,false);checkslide()}function checkslide(){swiperStatus=def_Manual;if(!def_Manual){gallerySwiper.$wrapperEl.addClass("swiper-no-swiping");thumbsSwiper.$wrapperEl.addClass("swiper-no-swiping");$(".swiper-scrollbar").addClass("hide")}else{gallerySwiper.$wrapperEl.removeClass("swiper-no-swiping");thumbsSwiper.$wrapperEl.removeClass("swiper-no-swiping");$(".swiper-scrollbar").removeClass("hide")}}function downloadMask(){$(".downloadMask").slideDown(500)}$(document).delegate(".downloadClose","click",function(){$(".downloadMask").slideUp(500)});$(document).delegate(".leftCheck","click",function(){$(".downloadMask").slideUp(500)});$(".rightCheck").on("click",function(){var a;$(".MainUl li").each(function(b,c){if($(c).find("input").attr("checked")=="checked"){a=$(c).find("input").attr("fileUrl")}});window.location.href=a});function selectDocumentList(a){$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/document/getByEnterpriseId.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{enterpriseId:a},success:function(h){if(h.code==1){var c=h.data;var j="";for(var f=0;f<c.length;f++){var b=c[f];var e=b.url;var d=b.name;var g=b.type;j+="<li>";j+="	<label>";j+='		<div class="way-choose">';j+='			<input fileUrl="'+e+'" type="radio" name="radio" class="agreement-checkbox choose-way">';j+="		</div>";j+='		<div class="pptImg">';if(g=="doc"||g=="docx"){j+='			<img src="img/img-world.png"/>'}else{j+='			<img src="img/img-ppt.png"/>'}j+="		</div>";j+='		<div class="pptCon">';j+='			<p class="pptName">'+d+"</p>";j+="		</div>";j+="	</label>";j+="</li>"}$(".MainUl").html(j)}else{layerOpen(h.message)}}})}function checknumberlength(b,a){if(a<9999){$(b).text(a)}else{a=(a/10000).toFixed(1)/1;$(b).text(a+"w")}};