function danmu(e){var a=$(e);a.hasClass("active")?(danmuSwitch=!1,$("canvas").barrager("clear"),$("canvas").addClass("hide"),a.removeClass("active"),a.find(".mui-switch-handle").css({"transition-duration":"0.2s",transform:"translate(0px, 0px)"})):(danmuSwitch=!0,$("canvas").removeClass("hide"),a.addClass("active"),a.find(".mui-switch-handle").css({"transition-duration":"0.2s",transform:"translate(14px, 0px)"}))}function saveUserPlayRewards(){var e=$("input[name=playRewardsAmount]").val();if(null==e||""==e||null==e)layerOpen("打赏金额不能为空");else if(parseFloat(e)<parseFloat(minRewardsAmount)||parseFloat(e)>parseFloat(maxRewardsAmount))layerOpen("打赏金额超出打赏范围");else{var a=100*parseFloat(e),t=$("title").text();wechatSweepUnifyTheOrder(2,t,a,0)}}function saveUserPlayRewardsPay(){var e=$("input[name=playRewardsAmount]").val();if(null==e||""==e||null==e)layerOpen("打赏金额不能为空");else if(parseFloat(e)<parseFloat(minRewardsAmount)||parseFloat(e)>parseFloat(maxRewardsAmount))layerOpen("打赏金额超出打赏范围");else{var a=$("input[name=roomId]").val(),t=$("input[name=userId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/rewards/addPlayRewards.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:a,playRewardsAmount:e,userId:t},success:function(e){1==e.code?(console.log("打赏成功"),$(".rewardMask").slideUp(500)):layerOpen(e.message)}})}}function selectChoujiang(){console.log("回去抽奖、投票是否开启");var e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isStartPrizr.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(a){var t=a.code;if(401==t)window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e;else if(402==t)saveMessagerPhoneNumber();else if(403==t);else if(1==t){var s=a.data.isPlayRewards,i=a.data.isStartPrizr,n=a.data.isStartRedPacket,o=a.data.isStartSign,l=a.data.isStartVote;o?setTimeout(function(){$("#qiandao").removeClass("hide")},350):setTimeout(function(){$("#qiandao").addClass("hide")},350),i||l||s||n?setTimeout(function(){$(".btnIcons").removeClass("hide")},350):setTimeout(function(){$(".btnIcons").addClass("hide")},350),1==i&&$(".drawIcon").removeClass("hide"),1==l&&$(".toupiaoIcon").removeClass("hide"),1==n&&($(".hongbaoIcon").removeClass("hide"),hongbao()),1==s&&($(".rewardIcon").removeClass("hide"),playRewards())}else layerOpen(a.message)}})}function playRewards(){var e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/rewards/selectPlayRewards.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{roomId:e,terminalType:"h5"},success:function(e){if(1==e.code){var a=e.data;if(0==a.rewardsSwitch)$(".rewardIcon").addClass("hide"),minRewardsAmount=0,maxRewardsAmount=0;else{if($(".rewardIcon").removeClass("hide"),0==a.rewardsTitleType)$(".rewardPic").text(a.promotionalLanguage);else if(1==a.rewardsTitleType){var t='<img src="'+a.promotionalImage+'" alt=""/>';$(".rewardPic").html(t)}minRewardsAmount=parseFloat(a.minRewardsAmount),maxRewardsAmount=parseFloat(a.maxRewardsAmount),$("input[name=playRewardsAmount]").attr("placeholder",minRewardsAmount+"~"+maxRewardsAmount+"元")}}else layerOpen(e.message)}})}function hongbao(){$(".hongbaoIcon").on("click",function(){var e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isRedPacket.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{roomId:e},success:function(e){var a=e.code;1==a?(openhongbao(e.packet.command),hbflag=!0):$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"data.message"})}}),$(".hongbaoClose").on("click",function(){$(".hongbaoMask").slideUp(500),$(".livemask").click()});var a=new ClipboardJS(".copyBtn");a.on("success",function(e){console.info("Action:",e.action),console.info("Text:",e.text),console.info("Trigger:",e.trigger),layerOpen("复制成功"),e.clearSelection()}),a.on("error",function(e){layerOpen("复制失败，请长按复制")})})}function openhongbao(e){if($(".hongbaoMask").slideDown(500),!hbflag){var a=e.split(""),t=$("#popuphongbao")[0],s=t.getContext("2d"),i=$("#imghongbao")[0],n=new Image,o=[],l=[];$.each(a,function(e,a){e<=9?o.push(a):l.push(a)});var r=o.join("  "),c=l.join("  ");n.src="img/hongbaokl.png",n.onload=function(){s.drawImage(n,0,0),s.textBaseline="middle",s.textAlign="center";var a=t.width/2,o=t.height/2;s.fillStyle="#000",c.length>0?(s.font="24px Microsoft YaHei",s.fillText(r,a,o+45),s.fillText(c,a,o+80)):(s.font="28px Microsoft YaHei",s.fillText(r,a,o+65)),i.src=t.toDataURL("image/jpg"),$("#copyhongbao").val(e)}}}function selectGiftList(){var e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/gift/giftList.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{roomId:e,terminalType:"h5"},success:function(e){if(1==e.code){var a=e.isSystemGift;if(1==a){for(var t=e.data,s="",i=0;i<t.length;i++){var n=t[i];s+='<li id="gift_'+n.giftId+'" giftId="'+n.giftId+'" giftPrice="'+n.giftPrice+'" giftName="'+n.giftName+'">',s+='\t<div class="giftPic"><img src="'+n.giftImage+'" alt=""/></div>',s+='\t<div class="giftName">'+n.giftName+"</div>",s+='\t<div class="giftMoney">'+n.giftPrice+"元</div>",s+="</li>"}$("#giftList").html(s),$(".giftIcon").removeClass("hide")}else $(".giftIcon").addClass("hide")}else layerOpen(e.message)}})}function saveMessagerPhoneNumber(){console.log("弹框进行手机号绑定"),$(".passMask").fadeIn(500)}function selectAdvertising(){var e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectAdvertising.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(a){if(401==a.code)window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e;else if(402==a.code)saveMessagerPhoneNumber();else if(403==a.code);else if(1==a.code){var t=a.data,s=t.startType;if(1==s){console.log("开启");var i=t.content;$("#iLiveRollingAdvertising").removeClass("hide").text(i),$("#iLiveRollingAdvertising").marquee({duration:5e3})}else console.log("关闭"),$("#iLiveRollingAdvertising").addClass("hide")}else console.log("获取滚动消息失败："+a.message)}})}function selectRoomLogo(){var e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectRoom.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(e){if(1==e.code){var a=JSON.parse(e.iLiveLiveRoom),t=a.liveEvent;t.openLogoSwitch,t.liveTitle}else layer.open({content:"获取直播间信息失败",btn:"确定",yes:function(e){errorfunction()}})}})}function selectAppointment(){var e=$("input[name=userId]").val();if(0!=e){var a=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/homepage/isAppointment.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:e,roomId:a},success:function(e){1==e.code?1==e.data.isAppointment?$(".appointment").addClass("select").text("取消提醒"):$(".appointment").removeClass("select").text("直播开始提醒"):layerOpen("预约信息查询失败!")}})}}function saveAppointment(){var e=$("input[name=userId]").val(),a=$("input[name=roomId]").val();if(0==e){a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a}else $.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/homepage/saveAppointment.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:e,roomId:a},success:function(e){if(401==e.code)window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a;else if(402==e.code)saveMessagerPhoneNumber();else if(403==e.code);else if(1==e.code)if(null!=e.data.userid){var t=e.status;1==t?(selectAppointment(),layer.open({content:e.message,btn:["是","否"],yes:function(){openConfirm()},no:function(e){layer.close(e)}})):2==t&&(selectAppointment(),layerOpen(e.message))}else $(".appointment").text("直播开始提醒"),layerOpen(e.message);else layerOpen("预约失败")}})}function openConfirm(){console.log("你确认了查看直播方更多直播内容"),window.location.href="http://apizb.tv189.com/version/wap/download/ios"}function temporaryCancel(){console.log("你放弃查看直播方更多直播内容")}function OpenQianDao(){var e=winHeight-VideoBox-menuBox;GetSignId(function(){$(document.body).addClass("modal-open"),layerId=layer.open({type:1,content:qiandaoHTML(),anim:"up",style:"position:absolute; left:0; bottom:0; width:100%; height:"+e+"px; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;"})})}function GetSignId(e){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isSign.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{roomId:a},success:function(a){if(1!=a.code)return layerOpen(a.message),!1;signId=a.signId,e()}})}function qiandaoHTML(){return html='<div class="main-popup "><div class="Input"><input type="tel" placeholder="手机号"   maxlength="11" name="phoneNum" id="phoneNum" onblur="validate(this)"/></div><div class="Input"><input type="tel" placeholder="动态密码"  maxlength="6"  name="vPassword_Q" onblur="wchatHackInput()"/><span class="yzmBtn1" onclick="getAuthenticode(this)" id="spenTimer">获取动态密码</span></div><div class="Input"><input type="text" placeholder="昵称 建议使用您的真实姓名签到，2-10个字"  minlength="2" maxlength="10" onblur="wchatHackInput()" name="username_Q"/></div><div class="text-center loginBox"><button type="button" class="confirmbutton QiandaoBtn disableBtn" disabled onclick="saveQiandao()">点击立即签到</button></div></div>',html}function validate(e){wchatHackInput();var a=e.value;if(null!=a&&""!=a){if(!isPoneAvailable(a.trim()))return layerOpen("请输入正确的手机号"),!1;$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/prize/siginPhone.jspx?userPhone="+a+"&signId="+signId,dataType:"jsonp",jsonp:"callback",async:!1,cache:!1,success:function(e){var a=e.status;if(1==a)return layerOpen("您已签到"),$(".QiandaoBtn").attr("disabled","true").addClass("disableBtn"),!1;$(".QiandaoBtn").removeAttr("disabled").removeClass("disableBtn")}})}}function saveQiandao(){wchatHackInput();var e=$("input[name=phoneNum]").val(),a=$("input[name=vPassword_Q]").val(),t=$("input[name=username_Q]").val();if(null==e||""==e.replace("s+",""))return layerOpen("请输入手机号!"),!1;if(null==a||""==a.replace("s+",""))return layerOpen("验证码不能为空!"),!1;if(null==t||""==t.replace("s+",""))return layerOpen("昵称不能为空!"),!1;var s="http://"+tomcatBase+"/ilive/prize/userSign.jspx";$.ajax({type:"POST",url:s,dataType:"jsonp",jsonp:"callback",cache:!1,data:{userphone:e,username:encodeURIComponent(t),vPassword:a,roomId:roomId,signId:signId},success:function(e){return"0"==e.status?(layerOpen(e.msg),!1):1e3==e.status?(layerOpen(e.msg),layer.close(layerId),!1):1001==e.status?(layerOpen(e.msg),!1):1002==e.status?(layerOpen(e.msg),!1):void 0}})}function saveDianZan(e){var a=$("input[name=userId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/register/registerRoom.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:a,roomId:e},success:function(a){401==a.code?window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e:402==a.code?saveMessagerPhoneNumber():403==a.code||(1==a.code?$("#dianZan").removeAttr("onclick").addClass("checked"):layerOpen(a.message))}})}function hideMask(){$(".replymask").addClass("hide"),$(".replyBox").addClass("hide"),$(".newmask").addClass("hide")}function selectMessageLIVE(){var e=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/message/selectMessageLIVE.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(a){var t=a.code;if(1==t){mescroll&&mescroll.endSuccess();var s=a.data;commentsAllow=a.commentsAllow;var i="",n="";if(s.length>0)for(var o=0;o<s.length;o++){var l=s[o];if(0==l.top){if(i+='<div class="themeBox" id="msgId_'+l.msgId+'">',i+='\t<div class="themeHeader">',i+='\t\t<div class="themeName">',i+='\t\t\t<span class="inlineName">'+l.senderName+"：</span>",i+='\t\t\t<span class="hottheme"><i class="fireIcon"></i> '+l.senderImage+"</span>",i+="\t\t</div>",i+='\t\t<div class="themeTime">'+l.createTime+"</div>",i+="\t</div>",i+='\t<div class="themeBody">',i+='\t\t<div class="themeText">'+l.webContent+"</div>",i+='\t\t<div class="themeText thumb" thumblist="list1">',2==l.msgType||4==l.msgType)for(var r=l.images,c=0;c<r.length;c++)i+='<img class="toBig" src="'+r[c]+'"/>';else 5!=l.msgType&&3!=l.msgType||(i+='<video id="video_'+l.msgId+'"  poster="http://pic.zb.tv189.com/img/defaultVedio.png" class="toVideo" src="'+l.video+'" controls></video>');i+="\t\t</div>",i+=' \t\t<div class="themeBottom">',i+=' \t\t\t<div class="reply"  onclick="commentsList('+l.msgId+')">',i+='\t\t\t\t<i class="replyIcon iconfont icon-huifu"></i><span class="inlineName">回复</span>',i+="\t\t\t</div>",i+=' \t\t\t<div class="comment" id="messagePraise_'+l.msgId+'">',i+=' \t\t\t\t<i class="heartIcon iconfont icon-xin" onclick="saveILiveMessagePraise('+l.msgId+')"/></i><span class="inlineName" id="praiseNumber_'+l.msgId+'" >'+l.praiseNumber+"</span>",i+=" \t\t\t</div>",i+=" \t\t</div>",i+=" \t</div>",i+=' \t<div class="themeFooter" id="commentsList_'+l.msgId+'"><div class="arrow-up"></div><div class="tishi">暂无评论</div></div>',i+="</div>"}else{if(n+='<div class="themeBox" id="msgId_'+l.msgId+'">',n+='\t<div class="themeHeader">',n+='\t\t<div class="themeName">',n+='\t\t\t<span class="inlineName">'+l.senderName+"：</span>",n+='\t\t\t<span class="hottheme"><i class="fireIcon"></i> '+l.senderImage+"</span>",n+='\t\t\t<span class="zdBox">置顶</span>',n+="\t\t</div>",n+='\t\t<div class="themeTime">'+l.createTime+"</div>",n+="\t</div>",n+='\t<div class="themeBody">',n+='\t\t<div class="themeText">'+l.webContent+"</div>",n+='\t\t<div class="themeText thumb" thumblist="list1">',2==l.msgType||4==l.msgType)for(r=l.images,c=0;c<r.length;c++)n+='<img class="toBig" src="'+r[c]+'"/>';else 5!=l.msgType&&3!=l.msgType||(n+='<video id="video_'+l.msgId+'"  class="toVideo" poster="http://pic.zb.tv189.com/img/defaultVedio.png"  src="'+l.video+'" controls></video>');n+="\t\t</div>",n+=' \t\t<div class="themeBottom">',n+=' \t\t\t<div class="reply"  onclick="commentsList('+l.msgId+')">',n+='\t\t\t\t<i class="replyIcon iconfont icon-huifu"></i><span class="inlineName">回复</span>',n+="\t\t\t</div>",n+=' \t\t\t<div class="comment" id="messagePraise_'+l.msgId+'">',n+=' \t\t\t\t<i class="heartIcon iconfont icon-xin" onclick="saveILiveMessagePraise('+l.msgId+')"/></i><span class="inlineName" id="praiseNumber_'+l.msgId+'" >'+l.praiseNumber+"</span>",n+=" \t\t\t</div>",n+=" \t\t</div>",n+=" \t</div>",n+=' \t<div class="themeFooter" id="commentsList_'+l.msgId+'"><div class="arrow-up"></div><div class="tishi">暂无评论</div></div>',n+="</div>"}}$("#topTalkBoxList1").html(n),$("#themeDiv").html(i),$(".redDot").addClass("hide"),$("#newTopic").addClass("hide"),0==s.length?$("#topicNull").removeClass("hide"):($("#topicNull").addClass("hide"),selectcommentsList(e))}else console.log("失败")},error:function(e){mescroll&&mescroll.endErr()}})}function selectCommentAll(e){var a=$("input[name=userId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/comments/selectCommentsAllByMsgId.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",msgId:e,userId:a},success:function(a){var t=a.code;if(1==t){for(var s="",i=JSON.parse(a.commentsList),n=0;n<i.length;n++){var o=i[n];s+='<div class="pinlun">',s+='\t\t<span class="plname">'+o.commentsName+":</span>"+o.comments,s+="\t</div>"}$(".replyBox").removeClass("hide"),$(".replyCon").html(s),$(".replyDiv").attr("onclick","commentsList("+e+")")}else console.log(a.message)}})}function saveILiveMessagePraise(e){var a=$("input[name=userId]").val();if(0!=a)$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/praise/savePraise.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:a,msgId:e},success:function(a){var s=a.code;if(401==s?window.location.href="http://"+h5Base+"/phone/login.html?roomId="+t:402==s&&saveMessagerPhoneNumber(),1!=s)layerOpen("点赞操作失败");else{var i=a.praiseNumber;if(0==i){var n=$("#praiseNumber_").text(),o='<i class="heartIcon iconfont icon-xin checked"></i>';o+='<span  class="inlineName" id="praiseNumber_'+e+'">'+n+"</span>",$("#messagePraise_"+e).html(o)}else{o='<i class="heartIcon iconfont icon-xin checked"></i>';o+='<span  class="inlineName" id="praiseNumber_'+e+'">'+i+"</span>",$("#messagePraise_"+e).html(o)}}}});else{var t=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+t}}function selectMediaFile(e){var a=$("input[name=roomId]").val(),t=$("input[name=userId]").val();""!=t&&null!=t||(t=0),window.location.href="http://"+h5Base+"/phone/review.html?fileId="+e+"&userId="+t+"&roomId="+a}function selectTimer(e){var a=e.split(" "),t=a[0].split("-"),s=parseInt(t[0],10),i=parseInt(t[1],10)-1,n=parseInt(t[2],10),o=a[1].split(":"),l=parseInt(o[0],10),r=parseInt(o[1],10),c=parseInt(o[2],10),d=new Date(s,i,n,l,r,c),p=new Date,m=d.getTime()-p.getTime();if(m>0){var v=Math.floor(m/864e5),u=m%864e5,h=Math.floor(u/36e5),g=u%36e5,f=Math.floor(g/6e4),y=g%6e4,w=Math.round(y/1e3),I=v+" 天 "+h+" 小时 "+f+" 分钟 "+w+" 秒";$("#openCountdownSwitch").text(I),setTimeout(function(){selectTimer(e)},1e3)}else $("#openCountdownSwitch").text("0 天 0 小时 0 分钟 0  秒")}function selectHTML(e){window.setInterval(function(){var e={p:"1"};if(ws)try{ws.send(JSON.stringify(e))}catch(e){console.log("websocket 连接已关闭")}},1e4),$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/roomenter.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e,sessionType:1,webType:1},success:function(a){if(404==a.code)window.location.href="http://"+h5Base+"/phone/end.html";else if(402==a.code){var t=$("input[name=userId]").val();if(0==t)return layer.open({content:"绑定手机号，获取用户失败",btn:"确定",yes:function(e){errorfunction()}}),!1;window.location.href="http://"+h5Base+"/phone/phoneNumber.html?roomId="+e+"&userId="+t}else if(1==a.code){switch(hlsAddr=a.hlsAddr,liveStart){case 0:$("#liveStart").removeClass("hide"),$("#enterpriseList").css("padding-bottom","1.25rem");break;case 1:$(".marqueeBox").css("bottom","16%"),myPlayer.ready(function(){$(".vjs-big-play-button").removeClass("hide"),this.src({src:hlsAddr,type:"application/x-mpegURL"}),this.poster(a.data.liveEvent.playBgAddr),$(".vjs-live-control").text("实时直播")});break;case 2:liveStart=1,$(".videoBox").append('<div id="vLoad"></div>'),setTimeout(function(){$("#vLoad").hide(),$(".marqueeBox").css("bottom","16%"),myPlayer.ready(function(){$(".vjs-big-play-button").removeClass("hide"),this.src({src:hlsAddr,type:"application/x-mpegURL"}),this.poster(a.data.liveEvent.playBgAddr),$(".vjs-live-control").text("实时直播")})},13e3);break;case 3:setTimeout(function(){myPlayer.ready(function(){this.poster(a.data.liveEvent.playBgAddr)})},0);break;case 4:$("#liveStart").addClass("hide"),$("#enterpriseList").css("padding-bottom",".5rem")}selectRoomLogo(),selectAdvertising(),selectGiftList();var s=a.token,i=10,n=a.estoppelType;if(0==n)$(".jinyanBox").removeClass("hide"),$("#jinyanBoxImg").attr("src","img/jinyan.png");else{var o=a.forbidTalk;console.log("禁言标示："+o),1==o?(i=11,$(".jinyanBox").removeClass("hide"),$("#jinyanBoxImg").attr("src","img/jinyan.png")):(i=10,$(".jinyanBox").addClass("hide"),$("#jinyanBoxImg").attr("src","img/talking.png"))}if("undefined"==typeof WebSocket)return void layer.open({content:"你的浏览器不支持信息交流",btn:"确定",yes:function(e){errorfunction()}});var l="ws://"+tomcatBase+"/ilive/webSocketServer.jspx?username="+s;ws=new WebSocket(l),ws.onopen=function(e){console.log("连接成功")},ws.onclose=function(e){console.log("关闭连接 ")},ws.onerror=function(e){console.log("建立连接异常"),window.location.href=window.location.href},ws.onmessage=function(e){var a=JSON.parse(e.data),t=a.liveMsgType;switch(a.roomType){case 0:var s=a.iLiveEventVo;n=s.estoppleType,0==n?($(".jinyanBox").removeClass("hide"),$("#jinyanBoxImg").attr("src","img/jinyan.png")):1==n&&(11==i?($(".jinyanBox").removeClass("hide"),$("#jinyanBoxImg").attr("src","img/jinyan.png")):($(".jinyanBox").addClass("hide"),$("#jinyanBoxImg").attr("src","img/talking.png")));var o=s.liveStatus;s.playBgAddr;switch(o){case 1:setTimeout(function(){$("#endLive").addClass("hide"),$("#playBg").addClass("hide"),$(".videoPlay").addClass("hide"),$(".marqueeBox").css("bottom","16%"),myPlayer.ready(function(){$(".vjs-big-play-button").removeClass("hide"),this.pause(),this.src({src:hlsAddr,type:"application/x-mpegURL"}),$(".vjs-live-control").text("实时直播")})},5e3);break;case 2:setTimeout(function(){$(".marqueeBox").css("bottom","0"),$("#endLive").removeClass("hide").find(".textMask").text("当前暂无直播画面"),myPlayer.ready(function(){$(".vjs-big-play-button").addClass("hide"),this.pause(),this.src({src:"none",type:"application/x-mpegURL"})})},5e3);break;case 3:setTimeout(function(){$("#playBg").removeClass("hide"),$("#endLive").removeClass("hide").find(".textMask").text("本场直播已结束"),$(".marqueeBox").css("bottom","0"),myPlayer.ready(function(){$(".vjs-big-play-button").addClass("hide"),this.pause(),this.src({src:"none",type:"application/x-mpegURL"})})},23e3)}break;case 1:var l,r=a.deleteAll;if(1==r)$("#talkBoxList2").children().remove(),$("#topTalkBoxList2").children().remove();else if(1==a.deleted)$("#msgId_"+a.msgId).remove();else{var c=$("input[name=userId]").val();if(a.senderId==c&&(1==n?(i=a.opType,11==i?($(".jinyanBox").removeClass("hide"),$("#jinyanBoxImg").attr("src","img/jinyan.png"),$(".giftIcon").addClass("hide")):($(".jinyanBox").addClass("hide"),$("#jinyanBoxImg").attr("src","img/talking.png"),$(".giftIcon").removeClass("hide"))):i=a.opType),2==t)flyDanmu(a.webContent),1==a.checked?($("#msgId_"+a.msgId).remove(),0==a.top?(l='<div class="talkline commentBox" id="msgId_'+a.msgId+'">',l+='\t<div class="userImg"><img src='+a.senderImage+"></div>",l+='\t<div class="commentText"><div class="inlineName"><span class="senderName">'+a.senderName+"</span><span class='createTime'>"+a.createTime+'</span> </div><div class="comment">'+a.webContent+"</div> </div>",l+="</div>",$("#topTalkBoxList2 #msgId_"+a.msgId).prepend(l),$("#talkBoxList2").prepend(l)):(l='<div class="topBox" id="msgId_'+a.msgId+'">',l+='\t<div class="userImg"><img src='+a.senderImage+"></div>",l+='\t<div class="commentText"><div class="inlineName"><span class="senderName">'+a.senderName+"</span><i class=\"questionIcon stickIcon\"></i><span class='createTime'>"+a.createTime+'</span></div><div class="comment">'+a.webContent+"</div> </div>",l+="</div>",$("#talkBoxList2 #msgId_"+a.msgId).prepend(l),$("#topTalkBoxList2").prepend(l))):a.senderId==c&&($("#msgId_"+a.msgId).remove(),0==a.top?(l='<div class="talkline commentBox" id="msgId_'+a.msgId+'">',l+='\t<div class="userImg"><img src='+a.senderImage+"></div>",l+='\t<div class="commentText"><div class="inlineName"><span class="senderName">'+a.senderName+"</span><span class='createTime'>"+a.createTime+'</span></div><div class="comment">'+a.webContent+"</div> </div>",l+="</div>",$("#topTalkBoxList2 #msgId_"+a.msgId).prepend(l),$("#talkBoxList2").prepend(l)):(l='<div class="topBox" id="msgId_'+a.msgId+'">',l+='\t<div class="userImg"><img src='+a.senderImage+"></div>",l+='\t<div class="commentText"><div class="inlineName"><span class="senderName">'+a.senderName+"</span><i class=\"questionIcon stickIcon\"></i><span class='createTime'>"+a.createTime+'</span></div><div class="comment">'+a.webContent+"</div> </div>",l+="</div>",$("#talkBoxList2 #msgId_"+a.msgId).prepend(l),$("#topTalkBoxList2").prepend(l)));else if(3==t)if(0==a.replyType){var d=a.senderId;c=$("input[name=userId]").val();0==d||null==d||null==d||d==c&&(l='<div class="talkline questionBox" id="msgId_'+a.msgId+'" >',l+='\t<div class="userImg"><img src='+a.senderImage+"></div>",l+='\t<div class="commentText"><div class="inlineName">'+a.senderName+' <i class="questionIcon"><img src="img/question.png"></i><span class=\'createTime\'>'+a.createTime+'</span></div><div class="comment">'+a.webContent+"</div> </div>",l+="</div>",$("#msgId_"+a.msgId).remove(),l+="</div>",$("#talkBoxList2").prepend(l))}else l='<div class="talkline questionBox" id="msgId_'+a.msgId+'" >',l+='\t<div class="userImg"><img src='+a.senderImage+"></div>",l+='\t<div class="commentText"><div class="inlineName">'+a.senderName+' <i class="questionIcon"><img src="img/question.png"></i><span class=\'createTime\'>'+a.createTime+'</span></div><div class="comment">'+a.webContent+"</div> </div>",l+='\t<div class="questionanswer">',l+='\t\t<div class="arrow-up"></div>',l+='\t\t<div class="questionName"><i class="questionIcon"><img src="img/answer.png" alt=""/></i><span class="inlineName">'+a.replyName+"</span></div>",l+='\t\t<div class="commentText">'+a.replyContent+"</div>",l+="\t</div></div>",l+="</div>",l+="</div>",$("#msgId_"+a.msgId).remove(),l+="</div>",$("#talkBoxList2").prepend(l)}var p=$("#topTalkBoxList2").height(),m=$("#talkBoxList2").height();p+m>$("#talkLi").height()&&$("#talkLi").addClass("dixian");break;case 2:console.log("发现新话题"),$(".redDot").removeClass("hide"),$("#newTopic").removeClass("hide");break;case 3:window.location.href="http://"+h5Base+"/phone/end.html";break;case 4:console.log("广告滚动"),selectAdvertising();break;case 5:console.log("抽奖"),selectChoujiang();break;case 6:console.log("投票"),selectChoujiang();break;case 7:console.log("赠送礼物");var v=a.iLiveUserGift;if(0==v.giftOperation){var u=v.userName,h=v.giftImage,g=v.giftNumber;arr.push({code:0,userName:u,giftImage:h,giftNumber:g}),giveGift()}else selectGiftList();break;case 8:break;case 9:console.log("打赏");var f=a.iLiveUserPlayRewards;if(0==f.playRewardsOperation)playRewards();else{var y=f.playRewardsAmount;u=f.userName;arr.push({code:1,userName:u,rewardsPrice:y}),giveGift()}break;case 10:var w=a.welcomeLanguage;arr.push({code:2,welcomeLanguage:w}),giveGift();break;case 11:var I=a.documentId,b=a.documentPageNO,x=a.documentManual,T=a.documentDownload;selectDocument(I,T,b,x);break;case 15:console.log("签到活动"),selectChoujiang();break;case 16:console.log("红包"),selectChoujiang();break;default:console.log("操作类型"+a.roomType)}}}else if(2==a.code){var r=window.sessionStorage.getItem("permissionsjump");if(null==r||"true"==r)return window.sessionStorage.setItem("permissionsjump",!0),window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e,!1;window.location.href="http://"+h5Base+"/phone/permissions.html?roomId="+e}else 3==a.code?window.location.href="http://"+h5Base+"/phone/standby.html?roomId="+e:window.location.href="http://"+h5Base+"/phone/error.html?roomId="+e}})}function errorfunctionAuthentication(){var e=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/permissions.html?roomId="+e}function errorfunctionFull(){var e=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/standby.html?roomId="+e}function sendMessageSubmitted(){wchatHackInput();var e=$("input[name=roomId]").val(),a=$("input[name=userId]").val();if(0!=a){var t=$(".wen").attr("msgValue");console.log("消息类型："+t);var s=$.trim($("input[name=liveEventId]").val()),i=$.trim($("input[name=msgContent]").val());if(""==i.replace("/^s+|s+$/g+","")||null==i)return layerOpen("请输入消息内容"),!1;2==t||3==t?$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/sendMessage.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:a,roomId:e,liveMsgType:t,content:encodeURI(i),liveEventId:s,msgType:1},success:function(a){var t=a.code;if(401==t)window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e;else if(402==t)saveMessagerPhoneNumber();else if(403==t);else if(1==t){console.log("发送消息成功");a.iLiveMessage;$(".wen").attr("msgValue","2"),$(".newmask").addClass("hide"),$("input[name=msgContent]").val("");var s=document.getElementById("talkLi");s.scrollTop=0}else layerOpen("消息发送失败")}}):layerOpen("发送消息类型错误")}else window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e}function saveTopicContent(){if(0==commentsAllow)$(".livemask").parent().addClass("hide"),$(".replyBox").addClass("hide"),$(".replyCon").html(""),$("textarea[name=topicContent]").val(""),$(".replyDiv").removeAttr("onclick"),layerOpen("评论功能已关闭");else{var e=$("input[name=userId]").val(),a=$("input[name=commentsMsgId]").val();if(0==e)return window.location.href="http://"+h5Base+"/phone/login.html?roomId="+roomId,!1;if(0==a)return layerOpen("请选择评论话题"),!1;var t=$.trim($("textarea[name=topicContent]").val()),s=t.replace(new RegExp(/\n/g),"<br>"),i=s.replace(new RegExp(/\s/g),"&nbsp;");if(""==i.replace("/^s+|s+$/g+","")||null==i)return layerOpen("评论内容不能为空"),!1;$(".livemask").parent().addClass("hide"),$(".replyBox").addClass("hide"),$(".replyCon").html(""),$("textarea[name=topicContent]").val(""),$(".replyDiv").removeAttr("onclick"),$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/saveComments.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:e,msgId:a,comments:encodeURI(i)},success:function(e){var a=e.code;401!=a?(402==a&&saveMessagerPhoneNumber(),$(".livemask").parent().addClass("hide"),$(".replyBox").addClass("hide"),$(".replyCon").html(""),$("textarea[name=topicContent]").val(""),$(".replyDiv").removeAttr("onclick"),1==a?selectMessageLIVE():layerOpen("评论发送失败")):window.location.href="http://"+h5Base+"/phone/login.html?roomId="+roomId}})}}function commentsList(e){var a=$("input[name=userId]").val();if(0==a){var t=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+t}else $("input[name=commentsMsgId]").val(e),$(".replymask").removeClass("hide"),$('textarea[name="topicContent"]').focus()}function selectRoomNumber(){var e=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/online/number.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(e){var a=e.code;if(1==a){var t=JSON.parse(e.data).number;null!=t&&null!=t||(t=0),checknumberlength($(".onlineNumberSpan"),t)}}})}function selectcommentsList(e){var a=$("input[name=userId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/comments/selectList.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e,userId:a},success:function(e){var t=e.code;if(1==t){for(var s=JSON.parse(e.iLiveCommentsMap),i=0;i<s.length;i++){for(var n=s[i],o=n.list,l='<div class="arrow-up"></div>',r=0;r<o.length;r++)if(r<5){var c=o[r];l+='<div class="pinlun">',l+='\t\t<span class="plname">'+c.commentsName+":</span>"+c.comments,l+="\t</div>"}0!=o.length&&o.length>5&&(l+='<div class="tishi discuss" onclick="selectCommentAll('+n.msgId+")\"><i class='iconfont icon-laquo'></i> 查看全部"+o.length+"条评论</div>"),$("#commentsList_"+n.msgId).html(l)}var d=JSON.parse(e.praiseMap);for(var p in d){var m=d[p].length;null==m&&(m=0);var v=0;for(i=0;i<m;i++){var u=d[p][i],h=u.userId;parseInt(a)==parseInt(h)&&(v=1)}if(0==v){var g='<i class="heartIcon iconfont icon-xin"  onclick="saveILiveMessagePraise('+p+')"></i>';g+='<span  class="inlineName" id="praiseNumber_'+p+'">'+m+"</span>",$("#messagePraise_"+p).html(g)}else{g='<i class="heartIcon iconfont icon-xin checked"></i>';g+='<span  class="inlineName" id="praiseNumber_'+p+'">'+m+"</span>",$("#messagePraise_"+p).html(g)}}}else layerOpen("获取话题评论失败")}})}function tableContent(e,a){selectHTML(a),selectAppointment(),0!=e&&$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/getrecordlist.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:a},success:function(e){1==e.code?getReviewList(e):layerOpen("直播回看获取失败")}})}function loginfunction(){var e=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e}function loadJsCss(e,a){if("js"==a){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e)}else if("css"==a){t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)}void 0!==t&&document.getElementsByTagName("head")[0].appendChild(t)}function selectDocument(e,a,t,s){def_Manual=s,-1==e?(checkslide(),0==a&&$(".pptBtn").addClass("hide"),gallerySwiper.slideTo(t-1,1e3,!1)):$.ajax({type:"POST",
url:"http://"+tomcatBase+"/ilive/document/getByd.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{docId:e},success:function(e){if(1==e.code){var s=e.data,i=s.list,n="";n+='<div class="swiper-container " id="gallery">',n+='  <div class="swiper-wrapper">',n+="  </div>",n+="</div>",n+='<div class="swiper-container " id="thumbs">',n+='  <div class="swiper-wrapper">';for(var o=0;o<i.length;o++){var l=i[o].url;n+='<div class="swiper-slide"><img src="'+l+'"></div>'}n+="  </div>",n+='<div class="swiper-scrollbar"></div>',n+="</div>",n+="</div>",0==a?(n+='\t<div class="pptBtn hide">',n+="\t</div>"):(n+='\t<div class="pptBtn" style="top:40%"  onclick="downloadMask()">',n+="\t</div>"),$(".wendang").html(n),wendangJS(i,t-1),0==a?$(".pptBtn").addClass("hide"):$(".pptBtn").removeClass("hide")}else layerOpen(e.message)}})}function wendangJS(e,a){thumbsSwiper=new Swiper("#thumbs",{spaceBetween:10,slidesPerView:3.5,watchSlidesVisibility:!0,watchSlidesProgress:!0,noSwiping:!0,freeMode:!0,freeModeMomentumRatio:5}),gallerySwiper=new Swiper("#gallery",{spaceBetween:10,width:window.innerWidth,noSwiping:!0,virtual:{slides:function(){for(var a=[],t=0;t<e.length;t++){var s=e[t].url;a.push('<div class="swiper-slide"><img data-src="'+s+'"  class="swiper-lazy"><div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div></div>')}return a}()},lazy:{loadPrevNext:!0,loadPrevNextAmount:2},thumbs:{swiper:thumbsSwiper},scrollbar:{el:".swiper-scrollbar",draggable:!0}}),gallerySwiper.slideTo(a,1e3,!1),checkslide()}function checkslide(){swiperStatus=def_Manual,def_Manual?(gallerySwiper.$wrapperEl.removeClass("swiper-no-swiping"),thumbsSwiper.$wrapperEl.removeClass("swiper-no-swiping"),$(".swiper-scrollbar").removeClass("hide")):(gallerySwiper.$wrapperEl.addClass("swiper-no-swiping"),thumbsSwiper.$wrapperEl.addClass("swiper-no-swiping"),$(".swiper-scrollbar").addClass("hide"))}function downloadMask(){$(".downloadMask").slideDown(500)}function selectDocumentList(e){$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/document/getByEnterpriseId.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{enterpriseId:e},success:function(e){if(1==e.code){for(var a=e.data,t="",s=0;s<a.length;s++){var i=a[s],n=i.url,o=i.name,l=i.type;t+="<li>",t+="\t<label>",t+='\t\t<div class="way-choose">',t+='\t\t\t<input fileUrl="'+n+'" type="radio" name="radio" class="agreement-checkbox choose-way">',t+="\t\t</div>",t+='\t\t<div class="pptImg">',t+="doc"==l||"docx"==l?'\t\t\t<img src="img/img-world.png"/>':'\t\t\t<img src="img/img-ppt.png"/>',t+="\t\t</div>",t+='\t\t<div class="pptCon">',t+='\t\t\t<p class="pptName">'+o+"</p>",t+="\t\t</div>",t+="\t</label>",t+="</li>"}$(".MainUl").html(t)}else layerOpen(e.message)}})}function checknumberlength(e,a){a<9999?$(e).text(a):(a=(a/1e4).toFixed(1)/1,$(e).text(a+"w"))}var mescroll,liveStartTime,hlsAddr,myPlayer,swiperStatus,layerId,danmuSwitch,liveStart=0,countdownTitle=null,minRewardsAmount=0,maxRewardsAmount=0,roomName="";$(function(){var e=GetQueryString("roomId");/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)||(window.location.href="http://"+h5Base+"/pc/play.html?roomId="+e),null!=e&&"null"!=e||(e=0),$("input[name=roomId]").val(e);var a=GetQueryString("userId");null!=a&&"null"!=a||(a=0),$("input[name=userId]").val(a),0==e?errorfunction():(onResize(),$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectPageDecorate.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(a){var t=a.code;if(1==t){for(var s="",i="",n=JSON.parse(a.pageDecorates),o=!1,l=0;l<n.length;l++){var r=l,c=n[l],d=c.menuType,p=c.menuName;switch(d){case 1:s+="<li ",0==l&&(s+=' class="liactive"',$(".wen").attr("msgValue",d),$("textarea[name=msgContent]").attr("maxlength","40"),$("#sendMessageDIV").addClass("hide")),s+=' liveMsgType="'+d+'"><span>'+p+'</span><i class="redDot" style="display:none;"></i></li>',i+='<li class="theme" style=\'z-index:'+r+"'>",i+='\t<div id="mescroll" class="mescroll">',i+='\t\t<div class="hintBox hide" id="newTopic">有一条新的内容，下拉刷新观看</div>',i+='\t\t<div class="nomoreIcon hide" id="topicNull">',i+='\t\t   <div class="nothemeBox"></div>',i+='\t\t   <p class="nothemeText">暂无话题发布...</p >',i+="\t\t</div>",i+='\t\t<div id="topTalkBoxList1"></div>',i+='\t\t<div class="themeCon" id="themeDiv" ></div>',i+="\t</div>",i+="</li>",o=!0;break;case 2:s+=" <li ",0==l&&(s+='class="liactive"',$(".wen").attr("msgValue",d),$("textarea[name=msgContent]").attr("maxlength","100"),$("#sendMessageDIV").removeClass("hide")),s+=' liveMsgType="'+d+'"><span>'+p+"</span></li>",i+='<li class="talkLi" id="talkLi" style=\'z-index:'+r+"'>",i+='\t<div id="topTalkBoxList2"></div>',i+='\t<div id="talkBoxList2"></div>',i+="\t<div class='dixian' style='display: none'><span>我是有底线的</span></div>",i+="</li>";break;case 3:break;case 4:s+=" <li ",0==l&&(s+='class="liactive"',$(".wen").attr("msgValue",d),$("#sendMessageDIV").addClass("hide")),s+=' liveMsgType="'+d+'"><span>'+p+"</span></li>",i+='<li class="zbjj" id="enterpriseList" style=\'z-index:'+r+";'></li>";break;case 5:s+=" <li ",0==l&&(s+='class="liactive"',$(".wen").attr("msgValue",d),$("#sendMessageDIV").addClass("hide")),s+=' liveMsgType="'+d+'"><span>'+p+"</span></li>",i+='<li class="review" id="review" style=\'z-index:'+r+";'></li>";break;case 6:s+=" <li ",0==l&&(s+='class="liactive"',$(".wen").attr("msgValue",d),$("#sendMessageDIV").addClass("hide")),s+=' liveMsgType="'+d+'"><span>'+p+"</span></li>",i+='<li class="wendang" liveMsgType="'+d+"\" style='z-index:"+r+";'>",i+="</li>"}}$("#menuBoxDIV").append(s),$("#contentBoxDIV").prepend(i),selectChoujiang();var m=n.length,v=function(e){return document.querySelector("."+e)},u=100*m,h=u-200;$(".contentBox ul").css("width",u+"%");v("firstBox");var g,f,y=$(".menuBox li"),w=document.querySelector(".contentBox"),I=document.querySelector(".contentBox ul");I.style.left="0%",o&&(mescroll=new MeScroll("mescroll",{down:{hardwareClass:"mescroll-hardware",callback:selectMessageLIVE},up:{use:!1}}));for(l=0;l<y.length;l++)y[l].addEventListener("touchend",function(e,a){return function(){b(a),I.style.left="-"+100*a+"%"}}(event,l));function b(e){swiperStatus=!1;for(var a=0;a<y.length;a++)y[a].classList.remove("liactive");y[e].classList.add("liactive"),hideMask();var t=$(".liactive").attr("liveMsgType");$("#liveStart").addClass("hide"),$("#sendMessageDIV").addClass("hide"),2==t&&$("#sendMessageDIV").removeClass("hide"),4==t&&0==liveStart&&$("#liveStart").removeClass("hide"),6==t&&checkslide(),$(".wen").attr("msgValue",t).css({background:'url("img/graywen.png") no-repeat',backgroundSize:"100%"})}w.addEventListener("touchstart",function(e){var a=e.touches[0];g=a.clientX,e.stopPropagation()}),w.addEventListener("touchend",function(e){if(!swiperStatus){var a=e.changedTouches[0];f=a.clientX-g;var t=parseInt(I.style.left);if(f>0&&f>100){if(t<=-100){I.style.left=t+100+"%";var s=(1+~parseInt(I.style.left))/100;b(s)}}else if(f<0&&f<-100&&t>=-h){I.style.left=t-100+"%";s=(1+~parseInt(I.style.left))/100;b(s)}}}),w.addEventListener("touchmove",function(e){e.stopPropagation()}),$(".imgBox").lightGallery({loop:!1,auto:!1,closable:!0}),$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/checkRoomLogin.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(a){var t,s=a.code;if(404==s)window.location.href="http://"+h5Base+"/phone/end.html";else if(402==s)if(t=JSON.parse(a.data).userInfo,null!=t||null!=t){var i=t.userId;null==i&&null==i||$("input[name=userId]").val(i),window.location.href="http://"+h5Base+"/phone/phoneNumber.html?roomId="+e+"&userId="+i}else layer.open({content:"绑定手机号，获取用户失败",btn:"确定",yes:function(e){errorfunction()}});else{if(1!=s)return layerOpen(a.message),!1;var n=JSON.parse(a.data),o=n.repeateGuide;if(window.sessionStorage.setItem("roomName",n.roomTitle||"天翼直播平台"),0==o){var l=n.openGuideSwitch;if(1==l)return void window.location.replace("http://"+h5Base+"/phone/guide.html?roomId="+e)}var r=n.roomNeedLogin;if(1==r)return void(window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e);if(2==r){if(t=n.userInfo,null!=t||null!=t){i=t.userId;null==i&&null==i||$("input[name=userId]").val(i);var c={userphone:t.mobile};window.sessionStorage.setItem("plinfo",JSON.stringify(c))}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/getRoomInfo.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:e},success:function(a){var t=a.code;if(1==t){var s=a.data.liveEvent,i=s.liveEventId;if($("input[name=liveEventId]").val(i),null==s||null==s)return layer.open({content:"直播间信息错误",btn:"确定",yes:function(e){errorfunction()}}),!1;var n=s.liveStatus;roomName=s.liveTitle||"",document.title=roomName,liveStartTime=s.liveStartTime,null!=liveStartTime&&null!=liveStartTime||(liveStartTime=""),$("#playBg").css("background-image","url("+s.converAddr+")"),$(".marqueeBox").css("bottom","0");var o=liveStartTime.split(" "),l=o[0].split("-"),r=parseInt(l[0],10),c=parseInt(l[1],10)-1,d=parseInt(l[2],10),p=o[1].split(":"),m=parseInt(p[0],10),v=parseInt(p[1],10),u=parseInt(p[2],10),h=new Date(r,c,d,m,v,u);switch(myPlayer=videojs("video",{textTrackDisplay:!1,errorDisplay:!1}),$(".vjs-big-play-button").addClass("hide"),n){case 0:liveStart=0;var g=s.openCountdownSwitch;if(1==g){countdownTitle=s.countdownTitle,$("#customContent").text(countdownTitle),$(".videoPlay").removeClass("hide"),$("#timeStart").removeClass("hide");var f=h.getTime();$("#countdown").countdown({timestamp:f,callback:function(e,a,t,s){}})}else $("#endLive").removeClass("hide").find(".textMask").text("本场直播尚未开始");break;case 1:$("#playBg").addClass("hide"),liveStart=1;break;case 2:liveStart=3,$("#endLive").removeClass("hide").find(".textMask").text("当前暂无直播画面"),$("#playBg").addClass("hide");break;case 3:liveStart=4,$("#endLive").removeClass("hide").find(".textMask").text("本场直播已结束")}var y=s.pageDecorate;if(null==y||null==y)return layer.open({content:"直播间错误",btn:"确定",yes:function(e){errorfunction()}}),!1;for(var w=0,I=0,b=0;b<y.length;b++){var x=y[b];4==x.menuType?w=1:5==x.menuType?I=1:1==x.menuType&&1}if(0!=w){var T=$("input[name=userId]").val(),k=a.data.enterprise;s.isSign;if(null!=k||null!=k){var C=k.enterpriseId,j=(k.enterpriseImg,k.enterpriseName),B=(k.enterpriseDesc,k.applyTime,0);1969==C&&(B=15e3);var S=B+k.concernTotal;concernTotalTemp=S,S>9999&&(S=(S/1e4).toFixed(1)/1+"w");var N='<div class="zbjjHeader" id="enterpriseId_'+C+'">';N+='<div class="zbjjLeft">',N+='\t\t<div class="liveTitle"  title="'+roomName+'">'+roomName+"</div>",N+="\t\t<div class=\"small-liveTitle \"><i class='iconfont icon-shijian'></i>"+liveStartTime.slice(0,liveStartTime.length-3)+"</div>",N+="\t</div>",N+='\t<div class="zbjjHeaderCon">',N+='\t\t<div class="peopleNum">',N+='\t\t\t<i class="peopleIcon iconfont icon-mi"><span class="onlineNumberSpan">0</span></i>',N+="\t\t</div>",N+='\t\t<div class="shareCon">',N+='<i id="dianZan" class="collIcon iconfont icon-dianzan" onclick="saveDianZan('+e+')" title="点赞"><span class="onlineDianZan">55.5w</span></i>',N+='<i id="qiandao" class="signIcon iconfont icon-qiandao hide" onclick="OpenQianDao()" title="签到"><span class="onlineQianDao">0</span></i>',N+="\t\t</div>",N+="\t</div>",N+="</div>";var L=k.certStatus,M={cerrs:!1,onclick:"",type:1,className:"guanzhu icon-jia",icon:""};if(4==L){M.cerrs=!0,M.onclick='onclick="zbjcompany('+C+')"';var A=k.concernStatus;0!=A&&(M.type=0,M.className="yiguanzhu",M.icon="icon-youjiantou")}N+='<div class="zbjcompany"  '+M.onclick+'  id="zbjcompany">',N+='<i class="iconfont '+M.icon+'"></i>',N+='<div class="companyimg"></div>',N+='<div class="company">',N+='<div class="small-liveTitle">',N+="<span>"+j+"</span>",M.cerrs&&(N+='<span class=" iconfont btn '+M.className+' " id="concernStatus" onclick="updateConcernStatus('+C+","+M.type+',event)"></span>',N+='<span class="zhuye btn iconfont icon-jia1"></span>'),N+="</div>",N+='<div class="small-fans" id="concernTotal">粉丝数: <span class="smallText">'+S+"</span> 人</div>",N+="</div>",N+="</div>",N+='<div class="zbjjMain">',N+='\t<div class="zbjjList">',N+='\t\t<div class="ListConTit">内容介绍</div>',N+='\t\t<div id="liveDesc_enterpriseId" class="ListCon"></div>',N+="\t</div>",N+="</div>",N+='<div class="yuyueBox hide" id="liveStart">',N+=' <button class="yuyue appointment" onclick="saveAppointment()">直播开始提醒</button>',N+="</div>"}else{N='<div class="zbjjHeader" id="enterpriseId_'+C+'">';N+='\t<div class="zbjjHeaderCon">',N+='\t\t<div class="peopleNum">',N+='\t\t\t<i class="peopleIcon iconfont icon-mi"><span class="onlineNumberSpan">0</span></i>',N+="\t\t</div>",N+='\t\t<div class="shareCon">',N+='<i id="dianZan" class="collIcon iconfont icon-dianzan" onclick="saveDianZan('+e+')" title="点赞"><span class="onlineDianZan">55.5w</span></i>',N+='<i id="qiandao" class="signIcon iconfont icon-qiandao hide" onclick="OpenQianDao()" title="签到"><span class="onlineQianDao">0</span></i>',N+="\t\t</div>",N+="\t</div>",N+="</div>",N+='<div class="zbjjMain">',N+='\t<div class="zbjjList">',N+='\t\t<div class="ListConTit">内容介绍</div>',N+='\t\t<div id="liveDesc_enterpriseId" class="ListCon"></div>',N+="\t</div>",N+="</div>"}$("#enterpriseList").html(N);var P=s.liveDesc;$("#liveDesc_enterpriseId").html(P),selectRoomNumber(),getEnterprise(C),window.setInterval("selectRoomNumber()",6e4),$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/register/queryIsRegister.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",liveEventId:i,userId:T},success:function(e){var a=e.code;if(1!=a)return layerOpen("获取签到、点赞失败"),!1;var t=e.data.isQiandaoReg,s=e.data.isDianzanReg;1==t&&$("#qiandao").addClass("checked").removeAttr("onclick"),1==s&&$("#dianZan").addClass("checked").removeAttr("onclick")}})}var O=s.openSignupSwitch;if(1==O){s.diyformAddr;return void(window.location.href="http://"+h5Base+"/phone/form.html?roomId="+e)}var R=s.viewAuthorized;if(2==R)return void(window.location.href="http://"+h5Base+"/phone/password.html?roomId="+e);if(6==R)return void(window.location.href="http://"+h5Base+"/phone/FCode.html?roomId="+e);if(3==R){var D=s.viewMoney;null!=D&&""!=D&&null!=D||(D=.01);var _=100*parseFloat(D),z=$("input[name=userId]").val(),E=s.liveTitle||"",V=s.welcomeMsg;$(".ewmTit").text(V),$("#ewmMoneyDiv").text("￥"+D),$("#checkbox-1-1").attr("wechatSweepUnifyTheOrder","wechatSweepUnifyTheOrder(3,'"+E+"',"+_+",0)"),$("#submitBtnMoney").attr("onclick","wechatSweepUnifyTheOrder(3,'"+E+"',"+_+",0)"),$("#ewmPayAgreement").attr("href","http://"+h5Base+"/phone/agree.html?roomId="+e+"&userId="+z);var q=s.openFCodeSwitch;1==q?$("#ewmCode").removeClass("hide"):$("#ewmCode").addClass("hide"),$("#payDiv").removeClass("hide")}else 1==R?tableContent(I,e):(console.log("观看权限管理值为：viewAuthorized："+R),tableContent(I,e));var G=s.documentId;if(0!=G){var U=s.documentDownload,F=s.documentPageNO,H=s.documentManual;C=k.enterpriseId;selectDocument(G,U,F,H),selectDocumentList(C,H)}}else window.location.href="http://"+h5Base+"/phone/nopermission.html?roomId="+e}})}}}})}}}))}),$(".btnIcons").on("click",function(){$(this).toggleClass("active"),$(this).prev().toggleClass("active ").find(".livemask").toggleClass("hide")});var hbflag=!1;$(".closepass .icon-close").click(function(){$(".passMask").fadeOut()});var signId,flag=!0;$(".talkConRight").click(function(){var e=$("input[name=userId]").val();if(0!=e)$(".wen").attr("msgValue","2"),$(".newmask").removeClass("hide"),$('input[name="msgContent"]').focus();else{var a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a}}),$(".talkConLeft").click(function(){var e=$("input[name=userId]").val();if(0==e){var a=$("input[name=roomId]").val();return window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a,!1}$(".wen").attr("msgValue","3"),$(".wen").css({background:"url(img/question.png) no-repeat","background-size":"100% 100%"}),$(".newmask").removeClass("hide"),$('input[type="text"],textarea').focus().attr("maxlength","100")}),$(".livemask").click(function(){if($(this).parent().hasClass("liveIcon"))return $(this).addClass("hide"),void $(this).parent().removeClass("active").next().removeClass("active");$(this).parent().addClass("hide"),$(".wen").attr("msgValue","2"),$('input[type="text"],textarea').attr("maxlength","40")}),$(".talkCon .wen").click(function(){3==$(this).attr("msgValue")?($(this).css({background:"url(img/graywen.png) no-repeat","background-size":"100% 100%"}),$(this).attr("msgValue","2"),$('input[type="text"],textarea').attr("maxlength","40")):($(this).css({background:"url(img/question.png) no-repeat","background-size":"100% 100%"}),$(this).attr("msgValue","3"),$('input[type="text"],textarea').attr("maxlength","100"))}),$(".textarea").bind("input propertychange",function(){0!=$(".textarea").val().length?($(".sendMessage").removeAttr("disabled"),$(".sendMessage").css("background","#0084ff")):$(".sendMessage").css("background","#b2daff")}),$(".replyInput").bind("input propertychange",function(){0!=$(".replyInput").val().length?($(".replyMessage").removeAttr("disabled"),$(".replyMessage").css("background","#0084ff")):($(".replyMessage").css("background","#b2daff"),$(".replyMessage").attr("disabled",!0))});var ws,gallerySwiper,thumbsSwiper,def_Manual,firstImg,num,imgW,timer,commentsAllow=0;$(".closeReply").click(function(){$(".replyBox").addClass("hide"),$(".replyCon").html(""),$(".replyDiv").removeAttr("onclick")}),$(document).delegate(".downloadClose","click",function(){$(".downloadMask").slideUp(500)}),$(document).delegate(".leftCheck","click",function(){$(".downloadMask").slideUp(500)}),$(".rightCheck").on("click",function(){var e;$(".MainUl li").each(function(a,t){"checked"==$(t).find("input").attr("checked")&&(e=$(t).find("input").attr("fileUrl"))}),window.location.href=e});