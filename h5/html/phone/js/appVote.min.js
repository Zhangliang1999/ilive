function connectWebViewJavascriptBridge(t){window.WebViewJavascriptBridge?t(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){t(WebViewJavascriptBridge)},!1)}function next(){if(0==voteId)return layerOpen("投票活动标示未获得"),!1;var t=document.getElementById("QuestonBox");if(0==vote_num){var e=!0,n="你没有选择答案，无法继续下一题",o=0,i=problemAnswers;$("#QuestonBox li").each(function(t,n){if(1==$(n).find("input").prop("checked")){o+=1;var i=$(n).find("input").attr("problem_Answer");problemAnswers=i+","+problemAnswers,e=!1}});var s=$("#QuestonBox li").attr("maxVoteNum");if(o>s&&(n="选择项大于最大限制数",e=!0),e)return problemAnswers=i,layerOpen(n),!1;console.log(problemAnswers);var a=$("input[name=userId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/addVote.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{userId:a,problemAnswers:problemAnswers,voteId:voteId},success:function(t){if(1!=t.code)return layerOpen(t.message),!1;successVode()}})}else{e=!0,n="你没有选择答案，无法继续下一题",o=0;$("#QuestonBox li").each(function(t,n){if(1==$(n).find("input").prop("checked")){o+=1;var i=$(n).find("input").attr("problem_Answer");problemAnswers=problemAnswers+i+",",e=!1}});s=$("#QuestonBox li").attr("maxVoteNum");if(o>s&&(n="选择项大于最大限制数",e=!0),e)return problemAnswers="",layerOpen(n),!1;vote_num--,show_num++;n=document.getElementById("question_"+show_num).innerHTML;t.innerHTML=n}}function closeVode(){layer.closeAll()}function selectTouPiao(){var t=$("input[name=userId]").val(),e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getVote.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{roomId:e,userId:t},success:function(t){if(console.log(t),401==t.code)setlogin();else if(402==t.code)layer.closeAll(),setlogin("bindPhone");else if(403==t.code);else{if(1!=t.code)return layerOpen(t.message),!1;var e=t.data;if(voteId=e.id,isOpen=e.isOpen,0==t.voteStatus){var n='<div class="voteResult">';n+='\t<div class="voteMain">';var o=e.list;vote_num=o.length-1,problemAnswers="";for(var i=0;i<vote_num+1;i++){var s=o[i],a=s.maxVoteNum;if(0==i){n+='\t\t<div id="QuestonBox">',n+='\t\t\t<div class="voteList">',n+='\t\t\t\t<div class="voteQuestion">'+s.problemName+"(多选题 ， 最大"+a+"项)</div>",n+='\t\t\t\t<div class="voteListCon">',n+='\t\t\t\t\t<ul class="MainUl">';for(var l=s.listOption,d=0;d<l.length;d++){var c=l[d];n+='\t\t\t\t\t\t<li maxVoteNum = "'+a+'">',n+="\t\t\t\t\t\t\t<label>",n+='\t\t\t\t\t\t\t\t<div class="way-choose">',n+='\t\t\t\t\t\t\t\t\t<input type="checkbox" problem_Answer="'+s.id+"_"+c.id+'"  name="problem_'+s.id+'" class="agreement-checkbox choose-way">',n+="\t\t\t\t\t\t\t\t</div>",n+="<div class='content'>"+c.content+"</div>",2==s.style&&(n+='\t\t\t\t\t\t\t<img class="wayImg" src="'+c.contentImg+'" alt=""/>'),n+="\t\t\t\t\t\t\t</label>",n+="\t\t\t\t\t\t</li>"}n+="\t\t\t\t\t</ul>",n+="\t\t\t\t</div>",n+="\t\t\t</div>",n+="\t\t</div>"}else{n+='\t\t<div id="question_'+i+'" style="display: none;" class="voteList">',n+='\t\t\t<div class="voteQuestion">'+s.problemName+"(多选题 ， 最大"+a+"项)</div>",n+='\t\t\t<div class="voteListCon">',n+='\t\t\t\t<ul class="MainUl">';for(l=s.listOption,d=0;d<l.length;d++){c=l[d];n+='\t\t\t\t\t<li maxVoteNum = "'+a+'">',n+="\t\t\t\t\t\t<label>",n+='\t\t\t\t\t\t\t<div class="way-choose">',n+='\t\t\t\t\t\t\t\t<input type="checkbox" problem_Answer="'+s.id+"_"+c.id+'" name="problem_'+s.id+'" class="agreement-checkbox choose-way">',n+="\t\t\t\t\t\t\t</div>",n+="<div class='content'>"+c.content+"</div>",2==s.style&&(n+='\t\t\t\t\t\t\t<img class="wayImg" src="'+c.contentImg+'" alt=""/>'),n+="\t\t\t\t\t\t</label>",n+="\t\t\t\t\t</li>"}n+="\t\t\t\t</ul>",n+="\t\t\t</div>",n+="\t\t</div>"}}n+="\t</div>",n+='\t<div class="voteconButton">继&nbsp;续</div>',n+="</div>",$("#vodeContentDiv").html(n)}else if(1==t.voteStatus){var v=t.data.startTime;noStartVode(v)}else 2==t.voteStatus?endVode():3==t.voteStatus&&participationVode()}}})}function endVode(){var t='<div class="voteNostart">';t+='\t<div class="voteNostartPic"></div>',t+='\t<div class="voteText">投票活动已结束</div>',t+="</div>",$("#vodeContentDiv").html(t)}function noStartVode(t){var e='<div class="voteNostart">';e+='\t<div class="voteNostartPic"></div>',e+='\t<div class="voteText">投票将于'+t+"开始</div>",e+="</div>",$("#vodeContentDiv").html(e)}function successVode(){var t='<div class="voteEnd">';t+='\t<div class="voteendPic"></div>',t+='\t<div class="voteText">投票提交已完成</div>',t+='\t<div class="voteText">感谢您的参与</div>',t+=1==isOpen?'\t<div class="voteendButton" onclick="vodeContent()">投&nbsp;票&nbsp;结&nbsp;果</div>':'\t<div class="voteendButton" onclick="closeVode()">关&nbsp;闭</div>',t+="</div>",$("#vodeContentDiv").html(t)}function participationVode(){var t='<div class="voteEnd">';t+='\t<div class="voteendPic"></div>',t+='\t<div class="voteText">你已参与过投票</div>',t+='\t<div class="voteText">感谢您的参与</div>',t+=1==isOpen?'\t<div class="voteendButton" onclick="vodeContent()">投&nbsp;票&nbsp;结&nbsp;果</div>':'\t<div class="voteendButton" onclick="closeVode()">关&nbsp;闭</div>',t+="</div>",$("#vodeContentDiv").html(t)}function vodeContent(){if(0==voteId)return layerOpen("投票活动标示未获得"),!1;$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getResult.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{voteId:voteId},success:function(t){if(console.log(t),1!=t.code)return layerOpen(t.message),!1;console.log("投票结果");for(var e=t.data,n=e.list,o='<div class="voteResult">',i=0;i<n.length;i++){var s=n[i];o+='\t<div class="voteList">',o+='\t\t<div class="voteQuestion">Q'+(i+1)+": "+s.problemName+"</div>";for(var a=s.listOption,l=0;l<a.length;l++){var d=a[l];o+='\t\t\t<div class="voteListCon">',o+='\t\t\t\t<div class="voteListName">'+d.content+"</div>",o+='\t\t\t\t<div class="Bar">',o+='\t\t\t\t\t<div class="progress" style="width:'+d.percen+'%;"></div>',o+="\t\t\t\t</div>",o+='\t\t\t\t<div class="progressNum">'+d.percen+"%</div>",o+="\t\t\t</div>"}o+="\t</div>"}o+="</div>",$("#vodeContentDiv").html(o)}})}var bridgeConstant;$("body").css("cursor","none"),window.onerror=function(t){log("window.onerror: "+t)},connectWebViewJavascriptBridge(function(t){function e(t,e){var o=document.getElementById("log"),i=document.createElement("div");i.className="logLine",i.innerHTML=n+++". "+t+(e?":<br/>"+JSON.stringify(e):""),o.children.length?o.insertBefore(i,o.children[0]):o.appendChild(i)}bridgeConstant=t;var n=1;t.init(function(t,n){e("JS got a message",t);var o={"Javascript Responds":"Wee!"};e("JS responding with",o),n(o)}),t.registerHandler("testJavascriptHandler",function(t,n){e("ObjC called testJavascriptHandler with",t);var o={"Javascript Says":"Right back atcha!"};e("JS responding with",o),n(o)});var o=document.getElementById("buttons").appendChild(document.createElement("button"));o.innerHTML="Send message to ObjC",o.onclick=function(n){n.preventDefault();var o="Hello from JS button";e("JS sending message",o),t.send(o,function(t){e("JS got response",t)})},document.body.appendChild(document.createElement("br"));var i=document.getElementById("buttons").appendChild(document.createElement("button"));i.innerHTML="Fire testObjcCallback",i.onclick=function(n){n.preventDefault(),e('JS calling handler "testObjcCallback"'),t.callHandler("testObjcCallback",{foo:"bar"},function(t){e("JS got response",t)})}}),$(document).ready(function(){$("body").delegate(".toupiaoIcon","click",function(){var t=$("input[name=userId]").val();if(0==t)if(confirm("是否进入登录？")){var e=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/phone/login.html?roomId="+e}else $.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"不登录无法进行抽奖"});else selectTouPiao()}),$(".voteClose").on("click",function(){$(".voteMask").slideUp(500)}),$(".voteendButton").click(function(){$(".voteMask").slideUp(500)}),$("body").delegate(".voteconButton","click",function(){next()})});var vote_num=0,show_num=0,problemAnswers="",voteId=0,isOpen=0;$("body").delegate(".voteconButton","click",function(){next()});