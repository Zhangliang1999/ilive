var krpanoplugin=function(){function bt(a){return String("yesontrue1")[aD](String(a)[ay]())>=0}function aX(){a2=bq,bf=bA;if(a8===undefined){bs=aC;return}a8&&!bs?(window[bz](aF,aN,aC),bi[aB][bx][bz](bB,ba,aC),bi[aB][bx][bz](bn,bc,aC),bi[aB][bx][bz](aE,bc,aC),bs=aC,a0=-aO(),aZ=0,a1=0,aR=0,bo=bi[by][bp],a6=bi[bD][bg],bi[bD][bg]=aC):bs=bq}function bI(){a8&&bs&&(window[bC](aF,aN,aC),bi[aB][bx][bC](bB,ba),bi[aB][bx][bC](bn,bc),bi[aB][bx][bC](aE,bc)),bu&&bi.call("tween(view.camroll,0)"),bs=bq,a6!=bA&&(bi[bD][bg]=a6,a6=bA)}function aV(){bs?bI():aX()}function a4(c){c=c*Math.PI/180;var b=Math.cos(c),a=Math.sin(c);return[1,0,0,0,b,a,0,-a,b]}function aY(c){c=c*Math.PI/180;var b=Math.cos(c),a=Math.sin(c);return[b,0,-a,0,1,0,a,0,b]}function aU(c){c=c*Math.PI/180;var b=Math.cos(c),a=Math.sin(c);return[b,a,0,-a,b,0,0,0,1]}function be(a,o){var h=new Array(9),c=o[0],m=o[1],b=o[2],g=o[3],k=o[4],j=o[5],n=o[6],i=o[7],e=o[8],l=a[0],f=a[1],d=a[2];return h[0]=l*c+f*g+d*n,h[1]=l*m+f*k+d*i,h[2]=l*b+f*j+d*e,l=a[3],f=a[4],d=a[5],h[3]=l*c+f*g+d*n,h[4]=l*m+f*k+d*i,h[5]=l*b+f*j+d*e,l=a[6],f=a[7],d=a[8],h[6]=l*c+f*g+d*n,h[7]=l*m+f*k+d*i,h[8]=l*b+f*j+d*e,h}function aP(d){var b,a,c;return d[3]>0.9999?(b=Math[bj](d[2],d[8]),a=Math.PI/2,c=0):d[3]<-0.9999?(b=Math[bj](d[2],d[8]),a=-Math.PI/2,c=0):(b=Math[bj](-d[6],d[0]),c=Math[bj](-d[5],d[4]),a=Math.asin(d[3])),{pan:b*180/Math.PI,tilt:a*180/Math.PI,roll:c*180/Math.PI}}function bl(e,d){var a=Math[bv](e-d),c=Math[bv](e-360-d),b=Math[bv](e+360-d);return c<a&&c<b?e-360:b<a&&b<c?e+360:e}function az(b){b+=360180;var a=b|0;return a%360+(b-a)-180}function bH(c){var s=c.accelerationIncludingGravity,z=c.rotationRate;if(s&&z){a8===undefined&&(a8=aC,bi.call(aI[bF],aI));if(!bs){return}var D=0;if(c.interval>0){D=Number(c.interval)/1000}else{if(window[a5]&&window[a5].now){var y=window[a5].now();aK>0&&(D=y-aK),aK=y}}var x=aO(),a=Number(s.x),l=Number(s.y),e=Number(s.z),E=Number(z[bh]),q=Number(z.beta),d=Number(z.gamma),t=Number(bi.get(a3)),u=Number(bi.get(aW)),F=Number(bi.get(aJ)),p=t,f=u,k=F,C=0.1,w=Math[bj](e,l)*180/Math.PI;w=bl(w,aT),aT=az(aT*(1-C)+w*C);var g=Math[bj](e,a)*180/Math.PI;g=bl(g,aS),aS=az(aS*(1-C)+g*C);if(bu){var B=-Math[bj](a,l)*180/Math.PI;B=bl(B,bd),bd=bd*(1-C)+B*C}else{bd=0}var r=aU(-aT),A=a4(-aS+90),v=a4(-bd),j=be(be(A,r),v),m=aP(j),h=m.tilt,b=bq;Math[bv](Math[bv](f)-h)<45&&(b=aC,f<0&&(h=-h)),bu?k=bd+x:k=0;if(aH==bq&&b){var i=h-f;i>10?i=10:i<-10&&(i=-10),f+=i*0.1}var n=be(be(aY(-p),aU(-f)),a4(-k));n=be(n,a4(+x)),n=be(n,aY(q*180/Math.PI*D)),n=be(n,aU(E*180/Math.PI*D)),n=be(n,a4(-x));var o=aP(n);p=o.pan,f=o.tilt,k=o[aG],bi.set(a3,p),bi.set(aW,f),bi.set(aJ,k)}}function bb(a){window[bC](aF,bb,bq),a8=aC,bs&&(bs=bq,aX()),bi.call(aI[bF],aI)}function ba(a){aA=aC}function bc(a){aA=bq}function aO(){var c=Number.NaN,b=screen.width>screen.height,e=screen[bk]||screen.msOrientation||screen.mozOrientation;if(e){e=(""+e)[ay]();var d=e[aD]("portrait")>=0,a=e[aD]("landscape")>=0,g=e[aD]("primary")>=0,f=e[aD]("secondary")>=0;d&&g?c=0:a&&g?c=90:a&&f?c=-90:d&&f&&(c=180),!isNaN(c)&&!bi[bw].mobile&&(c-=90)}return isNaN(c)&&(c=bi._have_top_access?top[bk]:window[bk]),isNaN(c)&&(bi[bw].mobile?c=b?90:0:c=b?0:90),c}function aN(o){if(!aA&&bs){var e=aO(),d=aQ({yaw:o[bh]*a7,pitch:o.beta*a7,roll:o.gamma*a7}),i=bE(d.yaw/a7),b=d[aM]/a7,h=i,m,g=bi[by].hlookat,n=bi[by].vlookat,j=bi[by][bp],l=g-a1,k=n-aR;if(!a2){if(bf==bA){bf=d}else{if(d.yaw!=bf.yaw||d[aM]!=bf[aM]||d[aG]!=bf[aG]){bf=bA,a2=aC,aH&&(aZ=-b)}}return}bu&&(bo=bE(180+Number(e)-d[aG]/a7));if(Math[bv](b)>70){h=o[bh];switch(e){case 0:b>0&&(h+=180);break;case 90:h+=90;break;case -90:h+=-90;break;case 180:b<0&&(h+=180)}h=bE(h),Math[bv](h-i)>180&&(h+=h<i?360:-360),m=Math.min(1,(Math[bv](b)-70)/10),i=i*(1-m)+h*m,bo*=1-m}a0+=l,aZ+=k,Math[bv](b+aZ)>90&&(aZ=b+aZ>0?90-b:-90-b),a1=bE(-i-180+a0),aR=Math.max(Math.min(b+aZ,90),-90),Math[bv](a1-g)>180&&(g+=a1>g?360:-360),a1=(1-br)*a1+br*g,aR=(1-br)*aR+br*n,Math[bv](bo-j)>180&&(j+=bo>j?360:-360),bo=(1-br)*bo+br*j;var f=bE(a1),c=aR,a=bE(bo);isNaN(f)||(bi[by].hlookat=f),isNaN(c)||(bi[by].vlookat=c),isNaN(a)||(bi[by][bp]=a),aZ!=0&&aL>0&&(k==0?aL==1?(aZ=0,bm=0):(bm=1-(1-bm)*bi[aB].touchfriction,aZ*=1-Math.pow(aL,2)*bm,Math[bv](aZ)<0.1&&(aZ=0,bm=0)):bm=0)}}function aQ(i){var a,e,c,g=Math.cos(i.yaw),b=Math.sin(i.yaw),d=Math.cos(i[aM]),k=Math.sin(i[aM]),j=Math.cos(i[aG]),h=Math.sin(i[aG]),f=[b*h-g*k*j,-g*d,g*k*h+b*j,d*j,-k,-d*h,b*k*j+g*h,b*d,-b*k*h+g*j];return f[3]>0.9999?(a=Math[bj](f[2],f[8]),c=Math.PI/2,e=0):f[3]<-0.9999?(a=Math[bj](f[2],f[8]),c=-Math.PI/2,e=0):(a=Math[bj](-f[6],f[0]),e=Math[bj](-f[5],f[4]),c=Math.asin(f[3])),{yaw:a,pitch:c,roll:e}}function bE(a){return a%=360,a<=180?a:a-360}var bA=null,bq=!1,aD="indexOf",ay="toLowerCase",bw="device",ax="registerattribute",aC=!0,bp="camroll",bF="onavailable",bz="addEventListener",aF="deviceorientation",bC="removeEventListener",bx="layer",aB="control",bB="touchstart",bn="touchend",aE="touchcancel",by="view",bg="loadwhilemoving",bD="display",bj="atan2",bv="abs",a5="performance",bh="alpha",a3="view.hlookat",aW="view.vlookat",aJ="view.camroll",aG="roll",bk="orientation",aM="pitch",a9=this,bi=bA,bG=bA,aI=bA,a8=undefined,bs=bq,aL=0,aH=bq,bu=bq,br=0.5,aA=bq,a6=bA,a2=bq,bf=bA,a0=0,aZ=0,a1=0,aR=0,bo=0,bm=0,a7=Math.PI/180;a9.registerplugin=function(a,b,d){bi=a,aI=d;if(bi.version<"1.18"){bi.trace(3,"gyro plugin - too old krpano version (min. 1.18)");return}bG=bi[bw],aI[ax]("available",bq,function(e){},function(){return a8==aC?aC:bq}),aI[ax]("enabled",aC,function(e){bt(e)?aX():bI()},function(){return bs}),aI[ax]("velastic",0,function(e){aL=Math.max(Math.min(Number(e),1),0)},function(){return aL}),aI[ax]("vrelative",bq,function(e){aH=bt(e)},function(){return aH}),aI[ax](bp,aC,function(e){bu=bt(e)},function(){return bu}),aI[ax]("friction",0,function(e){br=Math.max(Math.min(Number(e),1),0)},function(){return br}),aI[ax](bF,bA),aI.enable=aX,aI.disable=bI,aI.toggle=aV;var c=bG.android&&(""+navigator.userAgent)[ay]()[aD]("ucbrowser")>0;bG.android&&bG.chrome?window[bz](aF,bb,bq):(!bG.androidstock||!!c)&&(!bi[bw].realDesktop||bG.ie||c)&&window[bz](aF,bb,bq)},a9.unloadplugin=function(){window[bC]("devicemotion",bH,bq),window[bC](aF,bb,bq),window[bC](aF,aN,bq),bI(),aI=bA,bG=bA,bi=bA};var aK=0,aS=0,aT=0,bd=0};