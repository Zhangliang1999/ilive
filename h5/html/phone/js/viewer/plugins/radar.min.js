var krpanoplugin=function(){function g(l,f){function h(a){return"rgb("+(a>>16&255)+","+(a>>8&255)+","+(a&255)+")"}var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width",l);n.setAttribute("height",f);n.style.position="absolute";n.style.left="0px";n.style.top="0px";var m=document.createElementNS("http://www.w3.org/2000/svg","path");n.appendChild(m);var p={};p.svg=n;p.path=m;p.setstyle=function(r,a,e,t,q){m.setAttribute("stroke",h(r));m.setAttribute("stroke-width",a);m.setAttribute("stroke-opacity",e);m.setAttribute("fill",h(t));m.setAttribute("fill-opacity",q)};p.drawpie=function(w,e,r,q,x){var u,v;q>x&&(u=x,x=q,q=u);q=q*Math.PI/180;x=x*Math.PI/180;v=x-q;u=(q+x)/2;var t=v>Math.PI?1:0;v>=2*Math.PI&&(v=2*Math.PI-0.01);q=u-v/2;x=u+v/2;u=w+r*Math.sin(q);q=e-r*Math.cos(q);v=w+r*Math.sin(x);x=e-r*Math.cos(x);m.setAttribute("d","M "+w+","+e+" L "+u+","+q+" A "+r+","+r+" 0 "+t+" 1 "+v+","+x+" Z")};return p}function U(c){Q=!0;W(c);ab.mouse&&(window.addEventListener("mousemove",W,!0),window.addEventListener("mouseup",Y,!0));ab.touch&&(window.addEventListener(ab.touchmove,W,!0),window.addEventListener(ab.touchcancel,Y,!0),window.addEventListener(ab.touchend,Y,!0))}function Y(c){ab.mouse&&(window.removeEventListener("mousemove",W,!0),window.removeEventListener("mouseup",Y,!0));ab.touch&&(window.removeEventListener(ab.touchmove,W,!0),window.removeEventListener(ab.touchcancel,Y,!0),window.removeEventListener(ab.touchend,Y,!0))}function W(e){if(null==ac){Y(e)}else{if(null!=aa){e&&(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation());var c,f=c=0,h=aa.svg.parentNode.getBoundingClientRect();ab.touch?(e=e.changedTouches?e.changedTouches:[e],0<e.length&&(f=e[0],c=Math.round(f.clientX-h.left),f=Math.round(f.clientY-h.top))):(c=Math.round(e.clientX-h.left),f=Math.round(e.clientY-h.top));c=180*Math.atan2(f-0.5*T*ac.stagescale,c-0.5*R*ac.stagescale)/Math.PI;c-=V;if(1==Q){P=c-Number(ac.view.hlookat),Q=!1}else{for(c-=P;180<c;){c-=360}for(;-180>c;){c+=360}ac.view.hlookat=c}Z=!0}}}function N(){var h=X/2*ac.stagescale;2000<h&&(h=2000);var a=Math.ceil(2*h),f=2+2*S+a;if(f!=L){L=f;var m=aa.svg;m.setAttribute("width",f);m.setAttribute("height",f);m.style.left=(a-f>>1)+"px";m.style.top=(a-f>>1)+"px";Z=!0}a=V+O-0+ac.view.hlookat;m=ac.view.hfov;M&&(m=-m);ad&&ad.sprite&&(ad.sprite.style.pointerEvents="none");var c=aa.path.style;c.pointerEvents=ad.enabled?"visiblePainted":"none";c.cursor=ad.handcursor?"pointer":"default";if(0.01<Math.abs(a-s)||0.02<Math.abs(m-k)){s=a,k=m,Z=!0}Z&&(Z=!1,aa.setstyle(K,S,o,j,d),aa.drawpie(f/2-0.5,f/2-0.5,h,a-0.5*m,a+0.5*m))}var ac=null,ad=null,b=null,ab=null,aa=null,X=256,R=256,T=256,V=0,O=90,M=!1,j=16777215,K=16777215,d=0.5,o=0.3,S=0,Q=!1,P=null,Z=!0,i=null,L=-1,s=0,k=0;this.registerplugin=function(c,a,e){ac=c;ad=e;"1.18">ac.version?(ac.trace(3,"Radar Plugin - too old krpano version (min. 1.18)"),ad=ac=null):(b=ac.device,ab=b.browser.events,ad.registerattribute("heading",0,function(f){V=Number(f);Z=!0},function(){return V}),ad.registerattribute("headingoffset",90,function(f){O=Number(f);Z=!0},function(){return O}),ad.registerattribute("invert",!1,function(f){M="true"==String(f).toLowerCase();Z=!0},function(){return M}),ad.registerattribute("fillcolor",16777215,function(f){j=parseInt(f);Z=!0},function(){return j}),ad.registerattribute("linecolor",16777215,function(f){K=parseInt(f);Z=!0},function(){return K}),ad.registerattribute("fillalpha",0.5,function(f){d=Number(f);Z=!0},function(){return d}),ad.registerattribute("linealpha",0.3,function(f){o=Number(f);Z=!0},function(){return o}),ad.registerattribute("linewidth",0,function(f){S=Number(f);Z=!0},function(){return S}),ad.registercontentsize(X,X),aa=g(X,X),ad._assignEvents(aa.path),aa.path.kobject=ad,ad.sprite.style.pointerEvents="none",ad.sprite.appendChild(aa.svg),ab.mouse&&aa.path.addEventListener("mousedown",U,!0),ab.touch&&aa.path.addEventListener(ab.touchstart,U,!0),i=setInterval(N,1000/30))};this.unloadplugin=function(){if(ac&&ad){clearInterval(i);try{aa.path.kobject=null,ad.sprite.removeChild(aa.svg)}catch(a){}ac=ad=null}};this.onresize=function(e,c){R=e;T=c;X=Math.max(e,c);Z=!0;N();aa.path.style[b.browser.css.transform]="scale("+(e/X).toFixed(6)+","+(c/X).toFixed(6)+")";return !1}};