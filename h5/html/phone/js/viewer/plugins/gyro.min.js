var krpanoplugin=function(){function a7(a){return String("yesontrue1")[av](String(a)[ao]())>=0}function aN(){aS=am,af=aE;if(aY===undefined){a6=au;return}aY&&!a6?(window[aD](ax,bf,au),a1[ar][aB][aD](aF,aa,au),a1[ar][aB][aD](ak,ac,au),a1[ar][aB][aD](aw,ac,au),a6=au,aQ=-bg(),aP=0,aR=0,bj=0,a4=a1[aC][al],aW=a1[aH][ag],a1[aH][ag]=au):a6=am}function aM(){aY&&a6&&(window[aG](ax,bf,au),a1[ar][aB][aG](aF,aa),a1[ar][aB][aG](ak,ac),a1[ar][aB][aG](aw,ac)),a8&&a1.call("tween(view.camroll,0)"),a6=am,aW!=aE&&(a1[aH][ag]=aW,aW=aE)}function bn(){a6?aM():aN()}function aU(b){b=b*Math.PI/180;var a=Math.cos(b),c=Math.sin(b);return[1,0,0,0,a,c,0,-c,a]}function aO(b){b=b*Math.PI/180;var a=Math.cos(b),c=Math.sin(b);return[a,0,-c,0,1,0,c,0,a]}function bm(b){b=b*Math.PI/180;var a=Math.cos(b),c=Math.sin(b);return[a,c,0,-c,a,0,0,0,1]}function ae(x,C){var k=new Array(9),b=C[0],q=C[1],D=C[2],j=C[3],B=C[4],A=C[5],w=C[6],m=C[7],z=C[8],v=x[0],g=x[1],y=x[2];return k[0]=v*b+g*j+y*w,k[1]=v*q+g*B+y*m,k[2]=v*D+g*A+y*z,v=x[3],g=x[4],y=x[5],k[3]=v*b+g*j+y*w,k[4]=v*q+g*B+y*m,k[5]=v*D+g*A+y*z,v=x[6],g=x[7],y=x[8],k[6]=v*b+g*j+y*w,k[7]=v*q+g*B+y*m,k[8]=v*D+g*A+y*z,k}function bh(c){var a,d,b;return c[3]>0.9999?(a=Math[ai](c[2],c[8]),d=Math.PI/2,b=0):c[3]<-0.9999?(a=Math[ai](c[2],c[8]),d=-Math.PI/2,b=0):(a=Math[ai](-c[6],c[0]),b=Math[ai](-c[5],c[4]),d=Math.asin(c[3])),{pan:a*180/Math.PI,tilt:d*180/Math.PI,roll:b*180/Math.PI}}function aj(d,b){var f=Math[a9](d-b),c=Math[a9](d-360-b),a=Math[a9](d+360-b);return c<f&&c<a?d-360:a<f&&a<c?d+360:d}function ap(b){b+=360180;var a=b|0;return a%360+(b-a)-180}function aL(bs){var Y=bs.accelerationIncludingGravity,N=bs.rotationRate;if(Y&&N){aY===undefined&&(aY=au,a1.call(ba[aJ],ba));if(!a6){return}var bo=0;if(bs.interval>0){bo=Number(bs.interval)/1000}else{if(window[aV]&&window[aV].now){var M=window[aV].now();bc>0&&(bo=M-bc),bc=M}}var K=bg(),br=Number(Y.x),at=Number(Y.y),bu=Number(Y.z),bp=Number(N[ah]),T=Number(N.beta),bt=Number(N.gamma),H=Number(a1.get(aT)),Z=Number(a1.get(a0)),bq=Number(a1.get(bb)),F=H,bv=Z,C=bq,S=0.1,x=Math[ai](bu,at)*180/Math.PI;x=aj(x,bl),bl=ap(bl*(1-S)+x*S);var bw=Math[ai](bu,br)*180/Math.PI;bw=aj(bw,bk),bk=ap(bk*(1-S)+bw*S);if(a8){var Q=-Math[ai](br,at)*180/Math.PI;Q=aj(Q,ad),ad=ad*(1-S)+Q*S}else{ad=0}var G=bm(-bl),P=aU(-bk+90),w=aU(-ad),o=ae(ae(P,G),w),D=bh(o),j=D.tilt,a=am;Math[a9](Math[a9](bv)-j)<45&&(a=au,bv<0&&(j=-j)),a8?C=ad+K:C=0;if(az==am&&a){var k=j-bv;k>10?k=10:k<-10&&(k=-10),bv+=k*0.1}var t=ae(ae(aO(-F),bm(-bv)),aU(-C));t=ae(t,aU(+K)),t=ae(t,aO(T*180/Math.PI*bo)),t=ae(t,bm(bp*180/Math.PI*bo)),t=ae(t,aU(-K));var E=bh(t);F=E.pan,bv=E.tilt,C=E[ay],a1.set(aT,F),a1.set(a0,bv),a1.set(bb,C)}}function ab(a){window[aG](ax,ab,am),aY=au,a6&&(a6=am,aN()),a1.call(ba[aJ],ba)}function aa(a){aq=au}function ac(a){aq=am}function bg(){var i=Number.NaN,d=screen.width>screen.height,g=screen[a2]||screen.msOrientation||screen.mozOrientation;if(g){g=(""+g)[ao]();var j=g[av]("portrait")>=0,c=g[av]("landscape")>=0,b=g[av]("primary")>=0,h=g[av]("secondary")>=0;j&&b?i=0:c&&b?i=90:c&&h?i=-90:j&&h&&(i=180),!isNaN(i)&&!a1[aA].mobile&&(i-=90)}return isNaN(i)&&(i=a1._have_top_access?top[a2]:window[a2]),isNaN(i)&&(a1[aA].mobile?i=d?90:0:i=d?0:90),i}function bf(C){if(!aq&&a6){var g=bg(),e=bi({yaw:C[ah]*aX,pitch:C.beta*aX,roll:C.gamma*aX}),o=aI(e.yaw/aX),D=e[be]/aX,A=o,q,k=a1[aC].hlookat,w=a1[aC].vlookat,p=a1[aC][al],u=k-aR,B=w-bj;if(!aS){if(af==aE){af=e}else{if(e.yaw!=af.yaw||e[be]!=af[be]||e[ay]!=af[ay]){af=aE,aS=au,az&&(aP=-D)}}return}a8&&(a4=aI(180+Number(g)-e[ay]/aX));if(Math[a9](D)>70){A=C[ah];switch(g){case 0:D>0&&(A+=180);break;case 90:A+=90;break;case -90:A+=-90;break;case 180:D<0&&(A+=180)}A=aI(A),Math[a9](A-o)>180&&(A+=A<o?360:-360),q=Math.min(1,(Math[a9](D)-70)/10),o=o*(1-q)+A*q,a4*=1-q}aQ+=u,aP+=B,Math[a9](D+aP)>90&&(aP=D+aP>0?90-D:-90-D),aR=aI(-o-180+aQ),bj=Math.max(Math.min(D+aP,90),-90),Math[a9](aR-k)>180&&(k+=aR>k?360:-360),aR=(1-a5)*aR+a5*k,bj=(1-a5)*bj+a5*w,Math[a9](a4-p)>180&&(p+=a4>p?360:-360),a4=(1-a5)*a4+a5*p;var j=aI(aR),z=bj,x=aI(a4);isNaN(j)||(a1[aC].hlookat=j),isNaN(z)||(a1[aC].vlookat=z),isNaN(x)||(a1[aC][al]=x),aP!=0&&bd>0&&(B==0?bd==1?(aP=0,a3=0):(a3=1-(1-a3)*a1[ar].touchfriction,aP*=1-Math.pow(bd,2)*a3,Math[a9](aP)<0.1&&(aP=0,a3=0)):a3=0)}}function bi(k){var q,d,b,h=Math.cos(k.yaw),v=Math.sin(k.yaw),c=Math.cos(k[be]),p=Math.sin(k[be]),m=Math.cos(k[ay]),j=Math.sin(k[ay]),g=[v*j-h*p*m,-h*c,h*p*j+v*m,c*m,-p,-c*j,v*p*m+h*j,v*c,-v*p*j+h*m];return g[3]>0.9999?(q=Math[ai](g[2],g[8]),b=Math.PI/2,d=0):g[3]<-0.9999?(q=Math[ai](g[2],g[8]),b=-Math.PI/2,d=0):(q=Math[ai](-g[6],g[0]),d=Math[ai](-g[5],g[4]),b=Math.asin(g[3])),{yaw:q,pitch:b,roll:d}}function aI(a){return a%=360,a<=180?a:a-360}var aE=null,am=!1,av="indexOf",ao="toLowerCase",aA="device",an="registerattribute",au=!0,al="camroll",aJ="onavailable",aD="addEventListener",ax="deviceorientation",aG="removeEventListener",aB="layer",ar="control",aF="touchstart",ak="touchend",aw="touchcancel",aC="view",ag="loadwhilemoving",aH="display",ai="atan2",a9="abs",aV="performance",ah="alpha",aT="view.hlookat",a0="view.vlookat",bb="view.camroll",ay="roll",a2="orientation",be="pitch",aZ=this,a1=aE,aK=aE,ba=aE,aY=undefined,a6=am,bd=0,az=am,a8=am,a5=0.5,aq=am,aW=aE,aS=am,af=aE,aQ=0,aP=0,aR=0,bj=0,a4=0,a3=0,aX=Math.PI/180;aZ.registerplugin=function(f,a,b){a1=f,ba=b;if(a1.version<"1.18"){a1.trace(3,"gyro plugin - too old krpano version (min. 1.18)");return}aK=a1[aA],ba[an]("available",am,function(c){},function(){return aY==au?au:am}),ba[an]("enabled",au,function(c){a7(c)?aN():aM()},function(){return a6}),ba[an]("velastic",0,function(c){bd=Math.max(Math.min(Number(c),1),0)},function(){return bd}),ba[an]("vrelative",am,function(c){az=a7(c)},function(){return az}),ba[an](al,au,function(c){a8=a7(c)},function(){return a8}),ba[an]("friction",0,function(c){a5=Math.max(Math.min(Number(c),1),0)},function(){return a5}),ba[an](aJ,aE),ba.enable=aN,ba.disable=aM,ba.toggle=bn;var e=aK.android&&(""+navigator.userAgent)[ao]()[av]("ucbrowser")>0;aK.android&&aK.chrome?window[aD](ax,ab,am):(!aK.androidstock||!!e)&&(!a1[aA].realDesktop||aK.ie||e)&&window[aD](ax,ab,am)},aZ.unloadplugin=function(){window[aG]("devicemotion",aL,am),window[aG](ax,ab,am),window[aG](ax,bf,am),aM(),ba=aE,aK=aE,a1=aE};var bc=0,bk=0,bl=0,ad=0};