var krpanoplugin=function(){function D(d,i){function g(o){return"rgb("+(o>>16&255)+","+(o>>8&255)+","+(o&255)+")"}var k=document.createElementNS("http://www.w3.org/2000/svg","svg");k.setAttribute("width",d);k.setAttribute("height",i);k.style.position="absolute";k.style.left="0px";k.style.top="0px";var b=document.createElementNS("http://www.w3.org/2000/svg","path");k.appendChild(b);var j={};j.svg=k;j.path=b;j.setstyle=function(K,o,M,s,L){b.setAttribute("stroke",g(K));b.setAttribute("stroke-width",o);b.setAttribute("stroke-opacity",M);b.setAttribute("fill",g(s));b.setAttribute("fill-opacity",L)};j.drawpie=function(s,P,N,O,o){var L,K;O>o&&(L=o,o=O,O=L);O=O*Math.PI/180;o=o*Math.PI/180;K=o-O;L=(O+o)/2;var M=K>Math.PI?1:0;K>=2*Math.PI&&(K=2*Math.PI-0.01);O=L-K/2;o=L+K/2;L=s+N*Math.sin(O);O=P-N*Math.cos(O);K=s+N*Math.sin(o);o=P-N*Math.cos(o);b.setAttribute("d","M "+s+","+P+" L "+L+","+O+" A "+N+","+N+" 0 "+M+" 1 "+K+","+o+" Z")};return j}function l(b){q=!0;f(b);I.mouse&&(window.addEventListener("mousemove",f,!0),window.addEventListener("mouseup",c,!0));I.touch&&(window.addEventListener(I.touchmove,f,!0),window.addEventListener(I.touchcancel,c,!0),window.addEventListener(I.touchend,c,!0))}function c(b){I.mouse&&(window.removeEventListener("mousemove",f,!0),window.removeEventListener("mouseup",c,!0));I.touch&&(window.removeEventListener(I.touchmove,f,!0),window.removeEventListener(I.touchcancel,c,!0),window.removeEventListener(I.touchend,c,!0))}function f(g){if(null==G){c(g)}else{if(null!=J){g&&(g.preventDefault(),g.stopImmediatePropagation(),g.stopPropagation());var i,d=i=0,b=J.svg.parentNode.getBoundingClientRect();I.touch?(g=g.changedTouches?g.changedTouches:[g],0<g.length&&(d=g[0],i=Math.round(d.clientX-b.left),d=Math.round(d.clientY-b.top))):(i=Math.round(g.clientX-b.left),d=Math.round(g.clientY-b.top));i=180*Math.atan2(d-0.5*m*G.stagescale,i-0.5*p*G.stagescale)/Math.PI;i-=h;if(1==q){r=i-Number(G.view.hlookat),q=!1}else{for(i-=r;180<i;){i-=360}for(;-180>i;){i+=360}G.view.hlookat=i}a=!0}}}function u(){var g=e/2*G.stagescale;2000<g&&(g=2000);var d=Math.ceil(2*g),i=2+2*n+d;if(i!=w){w=i;var b=J.svg;b.setAttribute("width",i);b.setAttribute("height",i);b.style.left=(d-i>>1)+"px";b.style.top=(d-i>>1)+"px";a=!0}d=h+t-0+G.view.hlookat;b=G.view.hfov;v&&(b=-b);F&&F.sprite&&(F.sprite.style.pointerEvents="none");var j=J.path.style;j.pointerEvents=F.enabled?"visiblePainted":"none";j.cursor=F.handcursor?"pointer":"default";if(0.01<Math.abs(d-y)||0.02<Math.abs(b-A)){y=d,A=b,a=!0}a&&(a=!1,J.setstyle(x,n,z,B,E),J.drawpie(i/2-0.5,i/2-0.5,g,d-0.5*b,d+0.5*b))}var G=null,F=null,H=null,I=null,J=null,e=256,p=256,m=256,h=0,t=90,v=!1,B=16777215,x=16777215,E=0.5,z=0.3,n=0,q=!1,r=null,a=!0,C=null,w=-1,y=0,A=0;this.registerplugin=function(g,b,d){G=g;F=d;"1.18">G.version?(G.trace(3,"Radar Plugin - too old krpano version (min. 1.18)"),F=G=null):(H=G.device,I=H.browser.events,F.registerattribute("heading",0,function(i){h=Number(i);a=!0},function(){return h}),F.registerattribute("headingoffset",90,function(i){t=Number(i);a=!0},function(){return t}),F.registerattribute("invert",!1,function(i){v="true"==String(i).toLowerCase();a=!0},function(){return v}),F.registerattribute("fillcolor",16777215,function(i){B=parseInt(i);a=!0},function(){return B}),F.registerattribute("linecolor",16777215,function(i){x=parseInt(i);a=!0},function(){return x}),F.registerattribute("fillalpha",0.5,function(i){E=Number(i);a=!0},function(){return E}),F.registerattribute("linealpha",0.3,function(i){z=Number(i);a=!0},function(){return z}),F.registerattribute("linewidth",0,function(i){n=Number(i);a=!0},function(){return n}),F.registercontentsize(e,e),J=D(e,e),F._assignEvents(J.path),J.path.kobject=F,F.sprite.style.pointerEvents="none",F.sprite.appendChild(J.svg),I.mouse&&J.path.addEventListener("mousedown",l,!0),I.touch&&J.path.addEventListener(I.touchstart,l,!0),C=setInterval(u,1000/30))};this.unloadplugin=function(){if(G&&F){clearInterval(C);try{J.path.kobject=null,F.sprite.removeChild(J.svg)}catch(b){}G=F=null}};this.onresize=function(b,d){p=b;m=d;e=Math.max(b,d);a=!0;u();J.path.style[H.browser.css.transform]="scale("+(b/e).toFixed(6)+","+(d/e).toFixed(6)+")";return !1}};