var krpanoplugin=function(){function ap(ax){return String("yesontrue1")[t](String(ax)[y]())>=0}function Z(){U=A,H=ai;if(O===undefined){aq=u;return}O&&!aq?(window[aj](r,j,u),aw[v][al][aj](ah,M,u),aw[v][al][aj](C,K,u),aw[v][al][aj](s,K,u),aq=u,W=-i(),X=0,V=0,f=0,at=aw[ak][B],Q=aw[af][G],aw[af][G]=u):aq=A}function aa(){O&&aq&&(window[ag](r,j,u),aw[v][al][ag](ah,M),aw[v][al][ag](C,K),aw[v][al][ag](s,K)),ao&&aw.call("tween(view.camroll,0)"),aq=A,Q!=ai&&(aw[af][G]=Q,Q=ai)}function b(){aq?aa():Z()}function S(ax){ax=ax*Math.PI/180;var ay=Math.cos(ax),az=Math.sin(ax);return[1,0,0,0,ay,az,0,-az,ay]}function Y(ax){ax=ax*Math.PI/180;var ay=Math.cos(ax),az=Math.sin(ax);return[ay,0,-az,0,1,0,az,0,ay]}function c(ax){ax=ax*Math.PI/180;var ay=Math.cos(ax),az=Math.sin(ax);return[ay,az,0,-az,ay,0,0,0,1]}function I(aJ,ay){var aD=new Array(9),aI=ay[0],az=ay[1],ax=ay[2],aE=ay[3],aA=ay[4],aB=ay[5],aK=ay[6],aC=ay[7],aG=ay[8],aL=aJ[0],aF=aJ[1],aH=aJ[2];return aD[0]=aL*aI+aF*aE+aH*aK,aD[1]=aL*az+aF*aA+aH*aC,aD[2]=aL*ax+aF*aB+aH*aG,aL=aJ[3],aF=aJ[4],aH=aJ[5],aD[3]=aL*aI+aF*aE+aH*aK,aD[4]=aL*az+aF*aA+aH*aC,aD[5]=aL*ax+aF*aB+aH*aG,aL=aJ[6],aF=aJ[7],aH=aJ[8],aD[6]=aL*aI+aF*aE+aH*aK,aD[7]=aL*az+aF*aA+aH*aC,aD[8]=aL*ax+aF*aB+aH*aG,aD}function h(aA){var ay,az,ax;return aA[3]>0.9999?(ay=Math[E](aA[2],aA[8]),az=Math.PI/2,ax=0):aA[3]<-0.9999?(ay=Math[E](aA[2],aA[8]),az=-Math.PI/2,ax=0):(ay=Math[E](-aA[6],aA[0]),ax=Math[E](-aA[5],aA[4]),az=Math.asin(aA[3])),{pan:ay*180/Math.PI,tilt:az*180/Math.PI,roll:ax*180/Math.PI}}function D(aA,ax){var az=Math[an](aA-ax),aB=Math[an](aA-360-ax),ay=Math[an](aA+360-ax);return aB<az&&aB<ay?aA-360:ay<az&&ay<aB?aA+360:aA}function x(ax){ax+=360180;var ay=ax|0;return ay%360+(ax-ay)-180}function ab(aX){var ay=aX.accelerationIncludingGravity,aD=aX.rotationRate;if(ay&&aD){O===undefined&&(O=u,aw.call(o[ad],o));if(!aq){return}var a2=0;if(aX.interval>0){a2=Number(aX.interval)/1000}else{if(window[R]&&window[R].now){var aE=window[R].now();m>0&&(a2=aE-m),m=aE}}var aF=i(),aZ=Number(ay.x),aO=Number(ay.y),aV=Number(ay.z),a1=Number(aD[F]),az=Number(aD.beta),aW=Number(aD.gamma),aI=Number(aw.get(T)),ax=Number(aw.get(a)),a0=Number(aw.get(n)),aK=aI,aU=ax,aP=a0,aA=0.1,aG=Math[E](aV,aO)*180/Math.PI;aG=D(aG,d),d=x(d*(1-aA)+aG*aA);var aT=Math[E](aV,aZ)*180/Math.PI;aT=D(aT,e),e=x(e*(1-aA)+aT*aA);if(ao){var aB=-Math[E](aZ,aO)*180/Math.PI;aB=D(aB,J),J=J*(1-aA)+aB*aA}else{J=0}var aJ=c(-d),aC=S(-e+90),aH=S(-J),aQ=I(I(aC,aJ),aH),aN=h(aQ),aS=aN.tilt,aY=A;Math[an](Math[an](aU)-aS)<45&&(aY=u,aU<0&&(aS=-aS)),ao?aP=J+aF:aP=0;if(p==A&&aY){var aR=aS-aU;aR>10?aR=10:aR<-10&&(aR=-10),aU+=aR*0.1}var aM=I(I(Y(-aK),c(-aU)),S(-aP));aM=I(aM,S(+aF)),aM=I(aM,Y(az*180/Math.PI*a2)),aM=I(aM,c(a1*180/Math.PI*a2)),aM=I(aM,S(-aF));var aL=h(aM);aK=aL.pan,aU=aL.tilt,aP=aL[q],aw.set(T,aK),aw.set(a,aU),aw.set(n,aP)}}function L(ax){window[ag](r,L,A),O=u,aq&&(aq=A,Z()),aw.call(o[ad],o)}function M(ax){w=u}function K(ax){w=A}function i(){var az=Number.NaN,aC=screen.width>screen.height,aB=screen[av]||screen.msOrientation||screen.mozOrientation;if(aB){aB=(""+aB)[y]();var ay=aB[t]("portrait")>=0,aD=aB[t]("landscape")>=0,ax=aB[t]("primary")>=0,aA=aB[t]("secondary")>=0;ay&&ax?az=0:aD&&ax?az=90:aD&&aA?az=-90:ay&&aA&&(az=180),!isNaN(az)&&!aw[am].mobile&&(az-=90)}return isNaN(az)&&(az=aw._have_top_access?top[av]:window[av]),isNaN(az)&&(aw[am].mobile?az=aC?90:0:az=aC?0:90),az}function j(ay){if(!w&&aq){var aG=i(),aH=g({yaw:ay[F]*P,pitch:ay.beta*P,roll:ay.gamma*P}),aC=ae(aH.yaw/P),ax=aH[k]/P,aD=aC,az,aE=aw[ak].hlookat,aK=aw[ak].vlookat,aB=aw[ak][B],aL=aE-V,aA=aK-f;if(!U){if(H==ai){H=aH}else{if(aH.yaw!=H.yaw||aH[k]!=H[k]||aH[q]!=H[q]){H=ai,U=u,p&&(X=-ax)}}return}ao&&(at=ae(180+Number(aG)-aH[q]/P));if(Math[an](ax)>70){aD=ay[F];switch(aG){case 0:ax>0&&(aD+=180);break;case 90:aD+=90;break;case -90:aD+=-90;break;case 180:ax<0&&(aD+=180)}aD=ae(aD),Math[an](aD-aC)>180&&(aD+=aD<aC?360:-360),az=Math.min(1,(Math[an](ax)-70)/10),aC=aC*(1-az)+aD*az,at*=1-az}W+=aL,X+=aA,Math[an](ax+X)>90&&(X=ax+X>0?90-ax:-90-ax),V=ae(-aC-180+W),f=Math.max(Math.min(ax+X,90),-90),Math[an](V-aE)>180&&(aE+=V>aE?360:-360),V=(1-ar)*V+ar*aE,f=(1-ar)*f+ar*aK,Math[an](at-aB)>180&&(aB+=at>aB?360:-360),at=(1-ar)*at+ar*aB;var aF=ae(V),aI=f,aJ=ae(at);isNaN(aF)||(aw[ak].hlookat=aF),isNaN(aI)||(aw[ak].vlookat=aI),isNaN(aJ)||(aw[ak][B]=aJ),X!=0&&l>0&&(aA==0?l==1?(X=0,au=0):(au=1-(1-au)*aw[v].touchfriction,X*=1-Math.pow(l,2)*au,Math[an](X)<0.1&&(X=0,au=0)):au=0)}}function g(aA){var ax,aE,aG,aC=Math.cos(aA.yaw),aH=Math.sin(aA.yaw),aF=Math.cos(aA[k]),ay=Math.sin(aA[k]),az=Math.cos(aA[q]),aB=Math.sin(aA[q]),aD=[aH*aB-aC*ay*az,-aC*aF,aC*ay*aB+aH*az,aF*az,-ay,-aF*aB,aH*ay*az+aC*aB,aH*aF,-aH*ay*aB+aC*az];return aD[3]>0.9999?(ax=Math[E](aD[2],aD[8]),aG=Math.PI/2,aE=0):aD[3]<-0.9999?(ax=Math[E](aD[2],aD[8]),aG=-Math.PI/2,aE=0):(ax=Math[E](-aD[6],aD[0]),aE=Math[E](-aD[5],aD[4]),aG=Math.asin(aD[3])),{yaw:ax,pitch:aG,roll:aE}}function ae(ax){return ax%=360,ax<=180?ax:ax-360}var ai=null,A=!1,t="indexOf",y="toLowerCase",am="device",z="registerattribute",u=!0,B="camroll",ad="onavailable",aj="addEventListener",r="deviceorientation",ag="removeEventListener",al="layer",v="control",ah="touchstart",C="touchend",s="touchcancel",ak="view",G="loadwhilemoving",af="display",E="atan2",an="abs",R="performance",F="alpha",T="view.hlookat",a="view.vlookat",n="view.camroll",q="roll",av="orientation",k="pitch",N=this,aw=ai,ac=ai,o=ai,O=undefined,aq=A,l=0,p=A,ao=A,ar=0.5,w=A,Q=ai,U=A,H=ai,W=0,X=0,V=0,f=0,at=0,au=0,P=Math.PI/180;N.registerplugin=function(az,ay,ax){aw=az,o=ax;if(aw.version<"1.18"){aw.trace(3,"gyro plugin - too old krpano version (min. 1.18)");return}ac=aw[am],o[z]("available",A,function(aB){},function(){return O==u?u:A}),o[z]("enabled",u,function(aB){ap(aB)?Z():aa()},function(){return aq}),o[z]("velastic",0,function(aB){l=Math.max(Math.min(Number(aB),1),0)},function(){return l}),o[z]("vrelative",A,function(aB){p=ap(aB)},function(){return p}),o[z](B,u,function(aB){ao=ap(aB)},function(){return ao}),o[z]("friction",0,function(aB){ar=Math.max(Math.min(Number(aB),1),0)},function(){return ar}),o[z](ad,ai),o.enable=Z,o.disable=aa,o.toggle=b;var aA=ac.android&&(""+navigator.userAgent)[y]()[t]("ucbrowser")>0;ac.android&&ac.chrome?window[aj](r,L,A):(!ac.androidstock||!!aA)&&(!aw[am].realDesktop||ac.ie||aA)&&window[aj](r,L,A)},N.unloadplugin=function(){window[ag]("devicemotion",ab,A),window[ag](r,L,A),window[ag](r,j,A),aa(),o=ai,ac=ai,aw=ai};var m=0,e=0,d=0,J=0};