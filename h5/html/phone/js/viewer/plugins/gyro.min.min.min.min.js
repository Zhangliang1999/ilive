var krpanoplugin=function(){function h(ax){return String("yesontrue1")[aj](String(ax)[C]())>=0}function P(){av=k,v=M;if(ao===undefined){i=ak;return}ao&&!i?(window[b](ah,Z,ak),s[al][d][b](L,A,ak),s[al][d][b](n,y,ak),s[al][d][b](ai,y,ak),i=ak,a=-Y(),N=0,aw=0,V=0,m=s[c][l],aq=s[J][u],s[J][u]=ak):i=k}function E(){ao&&i&&(window[K](ah,Z,ak),s[al][d][K](L,A),s[al][d][K](n,y),s[al][d][K](ai,y)),g&&s.call("tween(view.camroll,0)"),i=k,aq!=M&&(s[J][u]=aq,aq=M)}function R(){i?E():P()}function at(az){az=az*Math.PI/180;var ax=Math.cos(az),ay=Math.sin(az);return[1,0,0,0,ax,ay,0,-ay,ax]}function O(az){az=az*Math.PI/180;var ax=Math.cos(az),ay=Math.sin(az);return[ax,0,-ay,0,1,0,ay,0,ax]}function S(az){az=az*Math.PI/180;var ax=Math.cos(az),ay=Math.sin(az);return[ax,ay,0,-ay,ax,0,0,0,1]}function w(aL,ax){var aE=new Array(9),aJ=ax[0],az=ax[1],aK=ax[2],aF=ax[3],aB=ax[4],aC=ax[5],ay=ax[6],aD=ax[7],aH=ax[8],aA=aL[0],aG=aL[1],aI=aL[2];return aE[0]=aA*aJ+aG*aF+aI*ay,aE[1]=aA*az+aG*aB+aI*aD,aE[2]=aA*aK+aG*aC+aI*aH,aA=aL[3],aG=aL[4],aI=aL[5],aE[3]=aA*aJ+aG*aF+aI*ay,aE[4]=aA*az+aG*aB+aI*aD,aE[5]=aA*aK+aG*aC+aI*aH,aA=aL[6],aG=aL[7],aI=aL[8],aE[6]=aA*aJ+aG*aF+aI*ay,aE[7]=aA*az+aG*aB+aI*aD,aE[8]=aA*aK+aG*aC+aI*aH,aE}function X(az){var ax,ay,aA;return az[3]>0.9999?(ax=Math[r](az[2],az[8]),ay=Math.PI/2,aA=0):az[3]<-0.9999?(ax=Math[r](az[2],az[8]),ay=-Math.PI/2,aA=0):(ax=Math[r](-az[6],az[0]),aA=Math[r](-az[5],az[4]),ay=Math.asin(az[3])),{pan:ax*180/Math.PI,tilt:ay*180/Math.PI,roll:aA*180/Math.PI}}function p(az,aA){var ay=Math[f](az-aA),aB=Math[f](az-360-aA),ax=Math[f](az+360-aA);return aB<ay&&aB<ax?az-360:ax<ay&&ax<aB?az+360:az}function B(ax){ax+=360180;var ay=ax|0;return ay%360+(ax-ay)-180}function F(a0){var aG=a0.accelerationIncludingGravity,ax=a0.rotationRate;if(aG&&ax){ao===undefined&&(ao=ak,s.call(ae[H],ae));if(!i){return}var aH=0;if(a0.interval>0){aH=Number(a0.interval)/1000}else{if(window[ar]&&window[ar].now){var ay=window[ar].now();ac>0&&(aH=ay-ac),ac=ay}}var az=Y(),a2=Number(aG.x),aR=Number(aG.y),aY=Number(aG.z),aE=Number(ax[t]),aL=Number(ax.beta),aZ=Number(ax.gamma),aF=Number(s.get(au)),aD=Number(s.get(Q)),aC=Number(s.get(ad)),aN=aF,aX=aD,aS=aC,aJ=0.1,aA=Math[r](aY,aR)*180/Math.PI;aA=p(aA,T),T=B(T*(1-aJ)+aA*aJ);var aW=Math[r](aY,a2)*180/Math.PI;aW=p(aW,U),U=B(U*(1-aJ)+aW*aJ);if(g){var aK=-Math[r](a2,aR)*180/Math.PI;aK=p(aK,x),x=x*(1-aJ)+aK*aJ}else{x=0}var aI=S(-T),aM=at(-U+90),aB=at(-x),aT=w(w(aM,aI),aB),aQ=X(aT),aV=aQ.tilt,a1=k;Math[f](Math[f](aX)-aV)<45&&(a1=ak,aX<0&&(aV=-aV)),g?aS=x+az:aS=0;if(af==k&&a1){var aU=aV-aX;aU>10?aU=10:aU<-10&&(aU=-10),aX+=aU*0.1}var aP=w(w(O(-aN),S(-aX)),at(-aS));aP=w(aP,at(+az)),aP=w(aP,O(aL*180/Math.PI*aH)),aP=w(aP,S(aE*180/Math.PI*aH)),aP=w(aP,at(-az));var aO=X(aP);aN=aO.pan,aX=aO.tilt,aS=aO[ag],s.set(au,aN),s.set(Q,aX),s.set(ad,aS)}}function z(ax){window[K](ah,z,k),ao=ak,i&&(i=k,P()),s.call(ae[H],ae)}function A(ax){am=ak}function y(ax){am=k}function Y(){var aD=Number.NaN,ax=screen.width>screen.height,aB=screen[q]||screen.msOrientation||screen.mozOrientation;if(aB){aB=(""+aB)[C]();var aC=aB[aj]("portrait")>=0,ay=aB[aj]("landscape")>=0,az=aB[aj]("primary")>=0,aA=aB[aj]("secondary")>=0;aC&&az?aD=0:ay&&az?aD=90:ay&&aA?aD=-90:aC&&aA&&(aD=180),!isNaN(aD)&&!s[e].mobile&&(aD-=90)}return isNaN(aD)&&(aD=s._have_top_access?top[q]:window[q]),isNaN(aD)&&(s[e].mobile?aD=ax?90:0:aD=ax?0:90),aD}function Z(ax){if(!am&&i){var aH=Y(),aI=W({yaw:ax[t]*ap,pitch:ax.beta*ap,roll:ax.gamma*ap}),aD=I(aI.yaw/ap),aK=aI[aa]/ap,aE=aD,az,aF=s[c].hlookat,ay=s[c].vlookat,aC=s[c][l],aA=aF-aw,aB=ay-V;if(!av){if(v==M){v=aI}else{if(aI.yaw!=v.yaw||aI[aa]!=v[aa]||aI[ag]!=v[ag]){v=M,av=ak,af&&(N=-aK)}}return}g&&(m=I(180+Number(aH)-aI[ag]/ap));if(Math[f](aK)>70){aE=ax[t];switch(aH){case 0:aK>0&&(aE+=180);break;case 90:aE+=90;break;case -90:aE+=-90;break;case 180:aK<0&&(aE+=180)}aE=I(aE),Math[f](aE-aD)>180&&(aE+=aE<aD?360:-360),az=Math.min(1,(Math[f](aK)-70)/10),aD=aD*(1-az)+aE*az,m*=1-az}a+=aA,N+=aB,Math[f](aK+N)>90&&(N=aK+N>0?90-aK:-90-aK),aw=I(-aD-180+a),V=Math.max(Math.min(aK+N,90),-90),Math[f](aw-aF)>180&&(aF+=aw>aF?360:-360),aw=(1-j)*aw+j*aF,V=(1-j)*V+j*ay,Math[f](m-aC)>180&&(aC+=m>aC?360:-360),m=(1-j)*m+j*aC;var aG=I(aw),aJ=V,aL=I(m);isNaN(aG)||(s[c].hlookat=aG),isNaN(aJ)||(s[c].vlookat=aJ),isNaN(aL)||(s[c][l]=aL),N!=0&&ab>0&&(aB==0?ab==1?(N=0,o=0):(o=1-(1-o)*s[al].touchfriction,N*=1-Math.pow(ab,2)*o,Math[f](N)<0.1&&(N=0,o=0)):o=0)}}function W(az){var aH,aD,aF,aB=Math.cos(az.yaw),aG=Math.sin(az.yaw),aE=Math.cos(az[aa]),ax=Math.sin(az[aa]),ay=Math.cos(az[ag]),aA=Math.sin(az[ag]),aC=[aG*aA-aB*ax*ay,-aB*aE,aB*ax*aA+aG*ay,aE*ay,-ax,-aE*aA,aG*ax*ay+aB*aA,aG*aE,-aG*ax*aA+aB*ay];return aC[3]>0.9999?(aH=Math[r](aC[2],aC[8]),aF=Math.PI/2,aD=0):aC[3]<-0.9999?(aH=Math[r](aC[2],aC[8]),aF=-Math.PI/2,aD=0):(aH=Math[r](-aC[6],aC[0]),aD=Math[r](-aC[5],aC[4]),aF=Math.asin(aC[3])),{yaw:aH,pitch:aF,roll:aD}}function I(ax){return ax%=360,ax<=180?ax:ax-360}var M=null,k=!1,aj="indexOf",C="toLowerCase",e="device",D="registerattribute",ak=!0,l="camroll",H="onavailable",b="addEventListener",ah="deviceorientation",K="removeEventListener",d="layer",al="control",L="touchstart",n="touchend",ai="touchcancel",c="view",u="loadwhilemoving",J="display",r="atan2",f="abs",ar="performance",t="alpha",au="view.hlookat",Q="view.vlookat",ad="view.camroll",ag="roll",q="orientation",aa="pitch",an=this,s=M,G=M,ae=M,ao=undefined,i=k,ab=0,af=k,g=k,j=0.5,am=k,aq=M,av=k,v=M,a=0,N=0,aw=0,V=0,m=0,o=0,ap=Math.PI/180;an.registerplugin=function(ay,ax,az){s=ay,ae=az;if(s.version<"1.18"){s.trace(3,"gyro plugin - too old krpano version (min. 1.18)");return}G=s[e],ae[D]("available",k,function(aB){},function(){return ao==ak?ak:k}),ae[D]("enabled",ak,function(aB){h(aB)?P():E()},function(){return i}),ae[D]("velastic",0,function(aB){ab=Math.max(Math.min(Number(aB),1),0)},function(){return ab}),ae[D]("vrelative",k,function(aB){af=h(aB)},function(){return af}),ae[D](l,ak,function(aB){g=h(aB)},function(){return g}),ae[D]("friction",0,function(aB){j=Math.max(Math.min(Number(aB),1),0)},function(){return j}),ae[D](H,M),ae.enable=P,ae.disable=E,ae.toggle=R;var aA=G.android&&(""+navigator.userAgent)[C]()[aj]("ucbrowser")>0;G.android&&G.chrome?window[b](ah,z,k):(!G.androidstock||!!aA)&&(!s[e].realDesktop||G.ie||aA)&&window[b](ah,z,k)},an.unloadplugin=function(){window[K]("devicemotion",F,k),window[K](ah,z,k),window[K](ah,Z,k),E(),ae=M,G=M,s=M};var ac=0,U=0,T=0,x=0};