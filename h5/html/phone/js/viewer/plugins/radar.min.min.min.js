var krpanoplugin=function(){function P(l,f){function h(m){return"rgb("+(m>>16&255)+","+(m>>8&255)+","+(m&255)+")"}var c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width",l);c.setAttribute("height",f);c.style.position="absolute";c.style.left="0px";c.style.top="0px";var a=document.createElementNS("http://www.w3.org/2000/svg","path");c.appendChild(a);var e={};e.svg=c;e.path=a;e.setstyle=function(n,q,r,p,m){a.setAttribute("stroke",h(n));a.setAttribute("stroke-width",q);a.setAttribute("stroke-opacity",r);a.setAttribute("fill",h(p));a.setAttribute("fill-opacity",m)};e.drawpie=function(p,q,u,r,t){var m,n;r>t&&(m=t,t=r,r=m);r=r*Math.PI/180;t=t*Math.PI/180;n=t-r;m=(r+t)/2;var v=n>Math.PI?1:0;n>=2*Math.PI&&(n=2*Math.PI-0.01);r=m-n/2;t=m+n/2;m=p+u*Math.sin(r);r=q-u*Math.cos(r);n=p+u*Math.sin(t);t=q-u*Math.cos(t);a.setAttribute("d","M "+p+","+q+" L "+m+","+r+" A "+u+","+u+" 0 "+v+" 1 "+n+","+t+" Z")};return e}function Y(a){S=!0;aa(a);j.mouse&&(window.addEventListener("mousemove",aa,!0),window.addEventListener("mouseup",ac,!0));j.touch&&(window.addEventListener(j.touchmove,aa,!0),window.addEventListener(j.touchcancel,ac,!0),window.addEventListener(j.touchend,ac,!0))}function ac(a){j.mouse&&(window.removeEventListener("mousemove",aa,!0),window.removeEventListener("mouseup",ac,!0));j.touch&&(window.removeEventListener(j.touchmove,aa,!0),window.removeEventListener(j.touchcancel,ac,!0),window.removeEventListener(j.touchend,ac,!0))}function aa(e){if(null==s){ac(e)}else{if(null!=g){e&&(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation());var c,f=c=0,a=g.svg.parentNode.getBoundingClientRect();j.touch?(e=e.changedTouches?e.changedTouches:[e],0<e.length&&(f=e[0],c=Math.round(f.clientX-a.left),f=Math.round(f.clientY-a.top))):(c=Math.round(e.clientX-a.left),f=Math.round(e.clientY-a.top));c=180*Math.atan2(f-0.5*X*s.stagescale,c-0.5*V*s.stagescale)/Math.PI;c-=Z;if(1==S){R=c-Number(s.view.hlookat),S=!1}else{for(c-=R;180<c;){c-=360}for(;-180>c;){c+=360}s.view.hlookat=c}ad=!0}}}function M(){var f=ab/2*s.stagescale;2000<f&&(f=2000);var h=Math.ceil(2*f),e=2+2*W+h;if(e!=k){k=e;var a=g.svg;a.setAttribute("width",e);a.setAttribute("height",e);a.style.left=(h-e>>1)+"px";a.style.top=(h-e>>1)+"px";ad=!0}h=Z+O-0+s.view.hlookat;a=s.view.hfov;K&&(a=-a);L&&L.sprite&&(L.sprite.style.pointerEvents="none");var c=g.path.style;c.pointerEvents=L.enabled?"visiblePainted":"none";c.cursor=L.handcursor?"pointer":"default";if(0.01<Math.abs(h-d)||0.02<Math.abs(a-U)){d=h,U=a,ad=!0}ad&&(ad=!1,g.setstyle(i,W,b,T,N),g.drawpie(e/2-0.5,e/2-0.5,f,h-0.5*a,h+0.5*a))}var s=null,L=null,o=null,j=null,g=null,ab=256,V=256,X=256,Z=0,O=90,K=!1,T=16777215,i=16777215,N=0.5,b=0.3,W=0,S=!1,R=null,ad=!0,Q=null,k=-1,d=0,U=0;this.registerplugin=function(c,a,e){s=c;L=e;"1.18">s.version?(s.trace(3,"Radar Plugin - too old krpano version (min. 1.18)"),L=s=null):(o=s.device,j=o.browser.events,L.registerattribute("heading",0,function(f){Z=Number(f);ad=!0},function(){return Z}),L.registerattribute("headingoffset",90,function(f){O=Number(f);ad=!0},function(){return O}),L.registerattribute("invert",!1,function(f){K="true"==String(f).toLowerCase();ad=!0},function(){return K}),L.registerattribute("fillcolor",16777215,function(f){T=parseInt(f);ad=!0},function(){return T}),L.registerattribute("linecolor",16777215,function(f){i=parseInt(f);ad=!0},function(){return i}),L.registerattribute("fillalpha",0.5,function(f){N=Number(f);ad=!0},function(){return N}),L.registerattribute("linealpha",0.3,function(f){b=Number(f);ad=!0},function(){return b}),L.registerattribute("linewidth",0,function(f){W=Number(f);ad=!0},function(){return W}),L.registercontentsize(ab,ab),g=P(ab,ab),L._assignEvents(g.path),g.path.kobject=L,L.sprite.style.pointerEvents="none",L.sprite.appendChild(g.svg),j.mouse&&g.path.addEventListener("mousedown",Y,!0),j.touch&&g.path.addEventListener(j.touchstart,Y,!0),Q=setInterval(M,1000/30))};this.unloadplugin=function(){if(s&&L){clearInterval(Q);try{g.path.kobject=null,L.sprite.removeChild(g.svg)}catch(a){}s=L=null}};this.onresize=function(a,c){V=a;X=c;ab=Math.max(a,c);ad=!0;M();g.path.style[o.browser.css.transform]="scale("+(a/ab).toFixed(6)+","+(c/ab).toFixed(6)+")";return !1}};