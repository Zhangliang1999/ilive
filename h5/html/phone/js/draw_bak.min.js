var indexs=0;function openPrize(a){$(".drawMask").attr("drawMask","0");var b='<div class="drawNostart">';b+='	<div class="drawnostartImg"></div>';b+='	<div class="endText">抽奖还未开始</div>';b+='	<div class="startText">将于<span class="">'+a+"</span>开启</div>";b+="</div>";$("#prizrContentDiv").html(b)}function closePrize(){$(".drawMask").attr("drawMask","0");var a='<div class="drawEnd">';a+='	<div class="drawEndImg"></div>';a+='	<p class="endText">抱歉！来晚了！抽奖已经结束...</p>';a+="</div>";$("#prizrContentDiv").html(a)}function inPrize(){var a=$("input[name=userId]").val();var b=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/getPrize.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:b,userId:a},success:function(g){console.log(g);if(g.code==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b;return false}else{if(g.code==402){saveMessagerPhoneNumber()}else{if(g.code==403){}else{if(g.code==1){var i=g.data;if(i==undefined||i==null||i==""){layerOpen("获取抽奖活动失败");return false}else{var h=g.prizeStatus;if(h==2){closePrize()}else{if(h==1){var d=i.startTime;openPrize(d)}else{if(h==0){var f="";var c=i.lotteryType;var k=i.userNum;if(k==""||k==undefined){k=0}if(c==2){f+='<div class="drawList">';f+='	<p class="nodrawText">摇一摇抽奖</p>';f+='	<div class="eggMain">';f+='	<audio id="shakemusic" src="music/red-01.mp3" style="display: none;"></audio>';f+='	<audio id="openmusic" src="music/red-02.mp3" style="display: none;"></audio>';f+='	<div class="red_bg">';f+='		<div class="red-ts"></div>';f+='		<div class="red-ss-bg">';f+='			<span class="red-ss animated"></span>';f+="		</div>";f+='		<div class="red-jh ">';f+='			剩余<span id="choujiangNumber">'+k+'</span>次机会 &nbsp;<a onclick="prizeList('+i.id+')">查看奖品</a>';f+="		</div>";f+="	</div>";f+="</div>";loadJsCss("js/shake.js","js");$(".drawMask").attr("drawMask","1")}else{if(c==1){f+='<div class="drawList">';f+='	<p class="nodrawText">砸金蛋</p>';f+='	<div class="eggMain">';f+='		<div class="egg">';f+='			<ul class="eggList">';f+='				<p class="hammer" id="hammer"><img src="img/chuizi.png" class="imgChuiZi"></p>';f+='				<li id="jindan" onClick="zadan(this)"></li>';f+="			</ul>";f+="		</div>";f+="	</div>";f+='	<p class="guize">剩余<span id="choujiangNumber">'+k+'</span>次机会 &nbsp;<a onclick="prizeList('+i.id+')">查看奖品</a></p>';f+="</div>";loadJsCss("js/goldeggs.js","js");$(".drawMask").attr("drawMask","0")}else{if(c==3){$(".drawMask").attr("drawMask","0");indexs=0;var j=i.list;var e=j.length;if(e<8){layerOpen("没有奖品");return false}else{f+='<p class="nodrawText">九宫格抽奖</p>';f+='<div class="drawMain">';f+='	<div class="draw" id="lottery">';f+="		<table>";f+="			<tr>";if(j[0].id!=0){f+='				<td id="prizeId_'+j[0].id+'" class="item lottery-unit lottery-unit-0" prizeId="0">';f+='					<div class="img">';f+='						<img src="'+j[0].prizeImg+'" >';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-0" prizeId="0">';indexs=indexs-1}f+='					<span class="name">'+j[0].prizeName+"</span>";f+="				</td>";f+='				<td class="gap"></td>';if(j[1].id!=0){f+='				<td id="prizeId_'+j[1].id+'" class="item lottery-unit lottery-unit-1" prizeId="1">';f+='					<div class="img">';f+='						<img src="'+j[1].prizeImg+'" >';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-1" prizeId="1">';indexs=indexs-1}f+='					<span class="name">'+j[1].prizeName+"</span>";f+="				</td>";f+='				<td class="gap"></td>';if(j[2].id!=0){f+='				<td id="prizeId_'+j[2].id+'" class="item lottery-unit lottery-unit-2"  prizeId="2">';f+='					<div class="img">';f+='						<img src="'+j[2].prizeImg+'" alt="">';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-2"  prizeId="2">';indexs=indexs-1}f+='					<span class="name">'+j[2].prizeName+"</span>";f+="				</td>";f+="			</tr>";f+="			<tr>";f+='				<td class="gap-2" colspan="5"></td>';f+="			</tr>";f+="			<tr>";if(j[7].id!=0){f+='				<td id="prizeId_'+j[7].id+'" class="item lottery-unit lottery-unit-7" prizeId="7">';f+='					<div class="img">';f+='						<img src="'+j[7].prizeImg+'" alt="">';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-7" prizeId="7">';indexs=indexs-1}f+='					<span class="name">'+j[7].prizeName+"</span>";f+="				</td>";f+='				<td class="gap"></td>';f+='				<td class=""><a class="draw-btn" href="javascript:">GO</a></td>';f+='				<td class="gap"></td>';if(j[3].id!=0){f+='				<td id="prizeId_'+j[3].id+'" class="item lottery-unit lottery-unit-3"  prizeId="3">';f+='					<div class="img">';f+='						<img src="'+j[3].prizeImg+'" alt="">';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-3"  prizeId="3">';indexs=indexs-1}f+='					<span class="name">'+j[3].prizeName+"</span>";f+="				</td>";f+="			</tr>";f+="			<tr>";f+='				<td class="gap-2" colspan="5"></td>';f+="			</tr>";f+="			<tr>";if(j[6].id!=0){f+='				<td id="prizeId_'+j[6].id+'" class="item lottery-unit lottery-unit-6"  prizeId="6">';f+='					<div class="img">';f+='						<img src="'+j[6].prizeImg+'" alt="">';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-6"  prizeId="6">';indexs=indexs-1}f+='					<span class="name">'+j[6].prizeName+"</span>";f+="				</td>";f+='				<td class="gap"></td>';if(j[5].id!=0){f+='				<td id="prizeId_'+j[5].id+'" class="item lottery-unit lottery-unit-5"  prizeId="5">';f+='					<div class="img">';f+='						<img src="'+j[5].prizeImg+'" alt="">';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-5"  prizeId="5">';indexs=indexs-1}f+='					<span class="name">'+j[5].prizeName+"</span>";f+="				</td>";f+='				<td class="gap"></td>';if(j[4].id!=0){f+='				<td id="prizeId_'+j[4].id+'" class="item lottery-unit lottery-unit-4"  prizeId="4">';f+='					<div class="img">';f+='						<img src="'+j[4].prizeImg+'" alt="">';f+="					</div>"}else{f+='				<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-4"  prizeId="4">';indexs=indexs-1}f+='					<span class="name">'+j[4].prizeName+"</span>";f+="				</td>";f+="			</tr>";f+="		</table>";f+="	</div>";f+="</div>";f+='<p class="guize">剩余<span id="choujiangNumber">'+k+'</span>次机会 &nbsp;<a onclick="prizeList('+i.id+')" >查看奖品</a></p>'}}}}$("#prizrContentDiv").html(f);if(c==3){var l=false;lottery.init("lottery");$(document).delegate(".draw-btn","click",function(){var m=$("#choujiangNumber").text();if(parseInt(m)>parseInt(0)){if(l){return false}else{lottery.speed=100;roll();l=true;return false}}else{layerOpen("抽奖次数已使用完毕")}})}}}}$(".drawMask").slideDown(500)}}else{layerOpen(g.message);return false}}}}}})}function winningPrize(a){$(".drawMask").attr("drawMask","0");if(a==0){notWinningPrize()}else{$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/getLotteryPrize.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",id:a},success:function(b){console.log(b);if(b.code==1){var c=b.data;var d='<div class="drawList">';d+='	<p class="nodrawText">恭喜您，中奖啦！</p>';d+='	<div class="startText">工作人员稍后会和您联系</div>';d+='	<div class="drawLitConTop">';d+='		<div class="drawImg"><img src="'+c.prizeImg+'" alt=""/></div>';d+="	</div>";d+='	<div class="drawLitConBottom">';d+='		<div class="drawLeft">'+c.prizeName+"</div>";d+='		<div class="drawRight">x1</div>';d+="	</div>";d+='	<div class="ensure" onclick="inPrize()">确&nbsp;定</div>';d+="</div>";$("#prizrContentDiv").html(d);$(".drawMask").slideDown(500)}else{layerOpen(b.message);return false}}})}}function notWinningPrize(){$(".drawMask").attr("drawMask","0");var a='<div class="drawEndImg"></div>';a+='<p class="nodrawText">大奖擦肩而过...</p>';a+='<div class="ensure"  onclick="inPrize()">确&nbsp;定</div>';$("#prizrContentDiv").html(a);$(".drawMask").slideDown(500)}function prizeList(a){$(".drawMask").attr("drawMask","0");$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/getPrizeList.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",lotteryId:a},success:function(d){console.log(d);if(d.code==1){var c=d.data;var e='<div class="drawList">';e+='	<div class="drawListMain">';e+='		<div class="drawListTit">本期奖品</div>';for(var b=0;b<c.length;b++){e+='		<div class="drawListCon">';e+='			<div class="drawLitConTop">';e+='				<div class="drawImg"><img src="'+c[b].prizeImg+'" alt=""/></div>';e+="			</div>";e+='			<div class="drawLitConBottom">';e+='				<div class="drawLeft">'+c[b].prizeName+"</div>";e+='				<div class="drawRight">x'+c[b].num+"</div>";e+="			</div>";e+="		</div>"}e+="	</div>";e+='	<div class="ensure"  onclick="inPrize()">一&nbsp;键&nbsp;参&nbsp;与</div>';e+="</div>";$("#prizrContentDiv").html(e);$(".drawMask").slideDown(500)}else{layerOpen(d.message);return false}}})}$(function(){$(".drawIcon").on("click",function(){var a=$("input[name=userId]").val();if(a==0){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+roomId}else{inPrize()}});$(".drawClose").on("click",function(){$(".drawMask").slideUp(500);$(".livemask").click()})});var lottery={index:-1,count:0,timer:0,speed:20,times:0,cycle:50,prize:-1,init:function(a){if($("#"+a).find(".lottery-unit").length>0){$lottery=$("#"+a);$units=$lottery.find(".lottery-unit");this.obj=$lottery;this.count=$units.length;$lottery.find(".lottery-unit.lottery-unit-"+this.index).addClass("drawactive")}},roll:function(){var a=this.index;var c=this.count;var b=this.obj;$(b).find(".lottery-unit.lottery-unit-"+a).removeClass("drawactive");a+=1;if(a>c-1){a=0}$(b).find(".lottery-unit.lottery-unit-"+a).addClass("drawactive");this.index=a;return false},stop:function(a){this.prize=a;return false}};var id=0;function roll(){lottery.times+=1;lottery.roll();if(lottery.times>lottery.cycle+10&&lottery.prize==lottery.index){clearTimeout(lottery.timer);lottery.prize=-1;lottery.times=0;click=false}else{if(lottery.times<lottery.cycle){lottery.speed-=10}else{if(lottery.times==lottery.cycle){var a=Math.random()*(lottery.count)|0;var b=$("input[name=userId]").val();var c=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/userLottery.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:b,roomId:c},success:function(d){console.log(d);if(d.code==1){id=d.data.prize;var e=$("#prizeId_"+id).attr("prizeId");lottery.prize=e}else{console.log(d.message);id=0}}})}else{if(lottery.times>lottery.cycle+10&&((lottery.prize==0&&lottery.index==7)||lottery.prize==lottery.index+1)){lottery.speed+=110;setTimeout(function(){winningPrize(id)},1000)}else{lottery.speed+=20}}}if(lottery.speed<40){lottery.speed=40}lottery.timer=setTimeout(roll,lottery.speed)}return false};