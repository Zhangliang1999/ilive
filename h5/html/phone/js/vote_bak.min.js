$(document).ready(function(){$("body").delegate(".toupiaoIcon","click",function(){var a=$("input[name=userId]").val();if(a==0){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+roomId}else{selectTouPiao()}});$(".voteClose").on("click",function(){$(".voteMask").slideUp(500);$(".livemask").click()});$(".voteendButton").click(function(){$(".voteMask").slideUp(500)});$("body").delegate(".voteconButton","click",function(){next()})});var vote_num=0;var show_num=0;var problemAnswers="";var voteId=0;var isOpen=0;function next(){if(voteId==0){layerOpen("投票活动标示未获得");return false}else{var a=document.getElementById("QuestonBox");if(vote_num==0){var b=true;var f="你没有选择答案，无法继续下一题";var d=0;var e=problemAnswers;$("#QuestonBox li").each(function(i,j){if($(j).find("input").attr("checked")=="checked"){d=d+1;var h=$(j).find("input").attr("problem_Answer");problemAnswers=h+","+problemAnswers;b=false}});var g=$("#QuestonBox li").attr("maxVoteNum");if(d>g){f="选择项大于最大限制数";b=true}if(b){problemAnswers=e;layerOpen(f);return false}else{console.log(problemAnswers);var c=$("input[name=userId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/addVote.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{userId:c,problemAnswers:problemAnswers,voteId:voteId},success:function(h){if(h.code==1){successVode()}else{layerOpen(h.message);return false}}})}}else{var b=true;var f="你没有选择答案，无法继续下一题";var d=0;$("#QuestonBox li").each(function(i,j){if($(j).find("input").attr("checked")=="checked"){d=d+1;var h=$(j).find("input").attr("problem_Answer");problemAnswers=problemAnswers+h+",";b=false}});var g=$("#QuestonBox li").attr("maxVoteNum");if(d>g){f="选择项大于最大限制数";b=true}if(b){problemAnswers="";layerOpen(f);return false}else{vote_num--;show_num++;var f=document.getElementById("question_"+show_num).innerHTML;a.innerHTML=f}}}}function selectTouPiao(){vote_num=0;problemAnswers="";var a=$("input[name=userId]").val();var b=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getVote.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:b,userId:a},success:function(h){console.log(h);if(h.code==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+b}else{if(h.code==402){saveMessagerPhoneNumber()}else{if(h.code==403){}else{if(h.code==1){var l=h.data;voteId=l.id;isOpen=l.isOpen;if(h.voteStatus==0){var g='<div class="voteResult">';g+='	<div class="voteMain">';var n=l.list;vote_num=n.length-1;problemAnswers="";for(var k=0;k<vote_num+1;k++){var c=n[k];var o=c.maxVoteNum;if(k==0){g+='		<div id="QuestonBox">';g+='			<div class="voteList">';g+='				<div class="voteQuestion">'+c.problemName+"(多选题 ， 最大"+o+"项)</div>";g+='				<div class="voteListCon">';g+='					<ul class="MainUl">';var m=c.listOption;for(var f=0;f<m.length;f++){var e=m[f];g+='						<li maxVoteNum = "'+o+'">';g+="							<label>";g+='								<div class="way-choose">';g+='									<input type="checkbox" problem_Answer="'+c.id+"_"+e.id+'"  name="problem_'+c.id+'" class="agreement-checkbox choose-way">';g+="								</div>";g+="<div class='content'>"+e.content+"</div>";if(c.style==2){g+='							<img class="wayImg" src="'+e.contentImg+'" alt=""/>'}g+="							</label>";g+="						</li>"}g+="					</ul>";g+="				</div>";g+="			</div>";g+="		</div>"}else{g+='		<div id="question_'+k+'" style="display: none;" class="voteList">';g+='			<div class="voteQuestion">'+c.problemName+"(多选题 ， 最大"+o+"项)</div>";g+='			<div class="voteListCon">';g+='				<ul class="MainUl">';var m=c.listOption;for(var f=0;f<m.length;f++){var e=m[f];g+='					<li maxVoteNum = "'+o+'">';g+="						<label>";g+='							<div class="way-choose">';g+='								<input type="checkbox" problem_Answer="'+c.id+"_"+e.id+'" name="problem_'+c.id+'" class="agreement-checkbox choose-way">';g+="							</div>";g+="<div class='content'>"+e.content+"</div>";if(c.style==2){g+='							<img class="wayImg" src="'+e.contentImg+'" alt=""/>'}g+="						</label>";g+="					</li>"}g+="				</ul>";g+="			</div>";g+="		</div>"}}g+="	</div>";g+='	<div class="voteconButton">继&nbsp;续</div>';g+="</div>";$("#vodeContentDiv").html(g);$(".voteMask").slideDown(500)}else{if(h.voteStatus==1){var d=h.data.startTime;noStartVode(d)}else{if(h.voteStatus==2){endVode()}else{if(h.voteStatus==3){participationVode()}}}}}else{layerOpen(h.message);return false}}}}}})}function endVode(){var a='<div class="voteNostart">';a+='	<div class="voteNostartPic"></div>';a+='	<div class="voteText">投票活动已结束</div>';a+="</div>";$("#vodeContentDiv").html(a);$(".voteMask").slideDown(500)}function noStartVode(a){var b='<div class="voteNostart">';b+='	<div class="voteNostartPic"></div>';b+='	<div class="voteText">投票将于'+a+"开始</div>";b+="</div>";$("#vodeContentDiv").html(b);$(".voteMask").slideDown(500)}function successVode(){var a='<div class="voteEnd">';a+='	<div class="voteendPic"></div>';a+='	<div class="voteText">投票提交已完成</div>';a+='	<div class="voteText">感谢您的参与</div>';if(isOpen==1){a+='	<div class="voteendButton" onclick="vodeContent()">投&nbsp;票&nbsp;结&nbsp;果</div>'}else{a+='	<div class="voteendButton" onclick="closeVode()">关&nbsp;闭</div>'}a+="</div>";$("#vodeContentDiv").html(a);$(".voteMask").slideDown(500)}function participationVode(){var a='<div class="voteEnd">';a+='	<div class="voteendPic"></div>';a+='	<div class="voteText">你已参与过投票</div>';a+='	<div class="voteText">感谢您的参与</div>';if(isOpen==1){a+='	<div class="voteendButton" onclick="vodeContent()">投&nbsp;票&nbsp;结&nbsp;果</div>'}else{a+='	<div class="voteendButton" onclick="closeVode()">关&nbsp;闭</div>'}a+="</div>";$("#vodeContentDiv").html(a);$(".voteMask").slideDown(500)}function closeVode(){$(".voteMask").slideUp(500)}function vodeContent(){if(voteId==0){layerOpen("投票活动标示未获得");return false}else{$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getResult.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{voteId:voteId},success:function(d){console.log(d);if(d.code==1){console.log("投票结果");var g=d.data;var k=g.list;var b='<div class="voteResult">';for(var e=0;e<k.length;e++){var a=k[e];b+='	<div class="voteList">';b+='		<div class="voteQuestion">'+a.problemName+"</div>";var h=a.listOption;for(var c=0;c<h.length;c++){var f=h[c];b+='			<div class="voteListCon">';b+='				<div class="voteListName">'+f.content+"</div>";b+='				<div class="Bar">';b+='					<div class="progress" style="width:'+f.percen+'%;"></div>';b+="				</div>";b+='				<div class="progressNum">'+f.percen+"%</div>";b+="			</div>"}b+="	</div>"}b+="</div>";$("#vodeContentDiv").html(b);$(".voteMask").slideDown(500)}else{layerOpen(d.message);return false}}})}};