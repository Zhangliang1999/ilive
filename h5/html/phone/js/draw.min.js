function openPrize(t){var i='<div class="drawNostart">';i+='\t<div class="drawnostartImg"></div>',i+='\t<div class="endText">抽奖还未开始</div>',i+='\t<div class="startText">将于<span class="">'+t+"</span>开启</div>",i+="</div>",$("#prizrContentDiv").html(i)}function closePrize(){var t='<div class="drawEnd">';t+='\t<div class="drawEndImg"></div>',t+='\t<p class="endText">抱歉！来晚了！抽奖已经结束...</p>',t+="</div>",$("#prizrContentDiv").html(t)}function inPrize(){var t=$("input[name=userId]").val(),i=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/getPrize.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",roomId:i,userId:t},success:function(t){if(console.log(t),401==t.code)return setlogin(),!1;if(402==t.code)setlogin("bindphone");else if(403==t.code);else{if(1!=t.code)return layerOpen(t.message),!1;var i=t.data;if(null==i||null==i||""==i)return layerOpen("获取抽奖活动失败"),!1;var e=t.prizeStatus;if(2==e)closePrize();else if(1==e){var s=i.startTime;openPrize(s)}else if(0==e){var d="",r=i.lotteryType,a=i.userNum;if(""!=a&&null!=a||(a=0),2==r)d+='<div class="drawList mescroll">',d+='\t<p class="nodrawText">摇一摇抽奖</p>',d+='\t<div class="eggMain">',d+='\t<audio id="shakemusic" src="music/red-01.mp3" style="display: none;"></audio>',d+='\t<audio id="openmusic" src="music/red-02.mp3" style="display: none;"></audio>',d+='\t<div class="red_bg">',d+='\t\t<div class="red-ts"></div>',d+='\t\t<div class="red-ss-bg">',d+='\t\t\t<span class="red-ss animated"></span>',d+="\t\t</div>",d+='\t\t<div class="red-jh ">',d+='\t\t\t剩余<span id="choujiangNumber">'+a+'</span>次机会 &nbsp;<a onclick="prizeList('+i.id+')">查看奖品</a>',d+="\t\t</div>",d+="\t</div>",d+="</div>";else if(1==r)d+='<div class="drawList mescroll">',d+='\t<p class="nodrawText">砸金蛋</p>',d+='\t<div class="eggMain">',d+='\t\t<div class="egg">',d+='\t\t\t<ul class="eggList">',d+='\t\t\t\t<p class="hammer" id="hammer"><img src="img/chuizi.png" class="imgChuiZi"></p>',d+='\t\t\t\t<li id="jindan" onClick="zadan(this)"></li>',d+="\t\t\t</ul>",d+="\t\t</div>",d+="\t</div>",d+='\t<p class="guize">剩余<span id="choujiangNumber">'+a+'</span>次机会 &nbsp;<a onclick="prizeList('+i.id+')">查看奖品</a></p>',d+="</div>";else if(3==r){indexs=0;var l=i.list,n=l.length;if(n<8)return layerOpen("没有奖品"),!1;d+='<div class="drawList mescroll">',d+='<p class="nodrawText">九宫格抽奖</p>',d+='<div class="drawMain">',d+='\t<div class="draw" id="lottery">',d+="\t\t<table>",d+="\t\t\t<tr>",0!=l[0].id?(d+='\t\t\t\t<td id="prizeId_'+l[0].id+'" class="item lottery-unit lottery-unit-0" prizeId="0">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[0].prizeImg+'" >',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-0" prizeId="0">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[0].prizeName+"</span>",d+="\t\t\t\t</td>",d+='\t\t\t\t<td class="gap"></td>',0!=l[1].id?(d+='\t\t\t\t<td id="prizeId_'+l[1].id+'" class="item lottery-unit lottery-unit-1" prizeId="1">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[1].prizeImg+'" >',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-1" prizeId="1">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[1].prizeName+"</span>",d+="\t\t\t\t</td>",d+='\t\t\t\t<td class="gap"></td>',0!=l[2].id?(d+='\t\t\t\t<td id="prizeId_'+l[2].id+'" class="item lottery-unit lottery-unit-2"  prizeId="2">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[2].prizeImg+'" alt="">',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-2"  prizeId="2">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[2].prizeName+"</span>",d+="\t\t\t\t</td>",d+="\t\t\t</tr>",d+="\t\t\t<tr>",d+='\t\t\t\t<td class="gap-2" colspan="5"></td>',d+="\t\t\t</tr>",d+="\t\t\t<tr>",0!=l[7].id?(d+='\t\t\t\t<td id="prizeId_'+l[7].id+'" class="item lottery-unit lottery-unit-7" prizeId="7">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[7].prizeImg+'" alt="">',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-7" prizeId="7">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[7].prizeName+"</span>",d+="\t\t\t\t</td>",d+='\t\t\t\t<td class="gap"></td>',d+='\t\t\t\t<td class=""><a class="draw-btn" href="javascript:">GO</a></td>',d+='\t\t\t\t<td class="gap"></td>',0!=l[3].id?(d+='\t\t\t\t<td id="prizeId_'+l[3].id+'" class="item lottery-unit lottery-unit-3"  prizeId="3">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[3].prizeImg+'" alt="">',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-3"  prizeId="3">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[3].prizeName+"</span>",d+="\t\t\t\t</td>",d+="\t\t\t</tr>",d+="\t\t\t<tr>",d+='\t\t\t\t<td class="gap-2" colspan="5"></td>',d+="\t\t\t</tr>",d+="\t\t\t<tr>",0!=l[6].id?(d+='\t\t\t\t<td id="prizeId_'+l[6].id+'" class="item lottery-unit lottery-unit-6"  prizeId="6">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[6].prizeImg+'" alt="">',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-6"  prizeId="6">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[6].prizeName+"</span>",d+="\t\t\t\t</td>",d+='\t\t\t\t<td class="gap"></td>',0!=l[5].id?(d+='\t\t\t\t<td id="prizeId_'+l[5].id+'" class="item lottery-unit lottery-unit-5"  prizeId="5">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[5].prizeImg+'" alt="">',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-5"  prizeId="5">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[5].prizeName+"</span>",d+="\t\t\t\t</td>",d+='\t\t\t\t<td class="gap"></td>',0!=l[4].id?(d+='\t\t\t\t<td id="prizeId_'+l[4].id+'" class="item lottery-unit lottery-unit-4"  prizeId="4">',d+='\t\t\t\t\t<div class="img">',d+='\t\t\t\t\t\t<img src="'+l[4].prizeImg+'" alt="">',d+="\t\t\t\t\t</div>"):(d+='\t\t\t\t<td id="prizeId_'+indexs+'" class="item lottery-unit lottery-unit-4"  prizeId="4">',indexs-=1),d+='\t\t\t\t\t<span class="name">'+l[4].prizeName+"</span>",d+="\t\t\t\t</td>",d+="\t\t\t</tr>",d+="\t\t</table>",d+="\t</div>",d+="</div>",d+='<p class="guize">剩余<span id="choujiangNumber">'+a+'</span>次机会 &nbsp;<a onclick="prizeList('+i.id+')" >查看奖品</a></p>',d+="</div>"}if($("#prizrContentDiv").html(d),3==r){var c=!1;lottery.init("lottery"),$(document).delegate(".draw-btn","click",function(){var t=$("#choujiangNumber").text();if(parseInt(t)>parseInt(0))return!c&&(lottery.speed=100,roll(),c=!0,!1);layerOpen("抽奖次数已使用完毕")})}}}}})}function winningPrize(t){0==t?notWinningPrize():$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/getLotteryPrize.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",id:t},success:function(t){if(console.log(t),1!=t.code)return layerOpen(t.message),!1;var i=t.data,e='<div class="drawList mescroll">';e+='\t<p class="nodrawText">恭喜您，中奖啦！</p>',e+='\t<div class="startText">工作人员稍后会和您联系</div>',e+='\t<div class="drawLitConTop">',e+='\t\t<div class="drawImg"><img src="'+i.prizeImg+'" alt=""/></div>',e+="\t</div>",e+='\t<div class="drawLitConBottom">',e+='\t\t<div class="drawLeft">'+i.prizeName+"</div>",e+='\t\t<div class="drawRight">x1</div>',e+="\t</div>",e+="\t</div>",e+='\t<div class="ensure" onclick="inPrize()">确&nbsp;定</div>',$("#prizrContentDiv").html(e)}})}function notWinningPrize(){$(".drawMask").attr("drawMask","0");var t='<div class="drawEndImg"></div>';t+='<p class="nodrawText">大奖擦肩而过...</p>',t+='<div class="ensure"  onclick="inPrize()">确&nbsp;定</div>',$("#prizrContentDiv").html(t)}function prizeList(t){$(".drawMask").attr("drawMask","0"),$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/getPrizeList.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",lotteryId:t},success:function(t){if(console.log(t),1!=t.code)return layerOpen(t.message),!1;var i=t.data,e='<div class="drawList mescroll">';e+='\t<div class="drawListMain">',e+='\t\t<div class="drawListTit">本期奖品</div>';for(var s=0;s<i.length;s++)e+='\t\t<div class="drawListCon">',e+='\t\t\t<div class="drawLitConTop">',e+='\t\t\t\t<div class="drawImg"><img src="'+i[s].prizeImg+'" alt=""/></div>',e+="\t\t\t</div>",e+='\t\t\t<div class="drawLitConBottom">',e+='\t\t\t\t<div class="drawLeft">'+i[s].prizeName+"</div>",e+='\t\t\t\t<div class="drawRight">x'+i[s].num+"</div>",e+="\t\t\t</div>",e+="\t\t</div>";e+="\t</div>",e+="</div>",e+='\t<div class="ensure"  onclick="inPrize()">一&nbsp;键&nbsp;参&nbsp;与</div>',$("#prizrContentDiv").html(e)}})}function roll(){if(lottery.times+=1,lottery.roll(),lottery.times>lottery.cycle+10&&lottery.prize==lottery.index)clearTimeout(lottery.timer),lottery.prize=-1,lottery.times=0,click=!1;else{if(lottery.times<lottery.cycle)lottery.speed-=10;else if(lottery.times==lottery.cycle){Math.random(),lottery.count;var t=$("input[name=userId]").val(),i=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/userLottery.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{terminalType:"h5",userId:t,roomId:i},success:function(t){if(console.log(t),1==t.code){id=t.data.prize;var i=$("#prizeId_"+id).attr("prizeId");lottery.prize=i}else console.log(t.message),id=0}})}else lottery.times>lottery.cycle+10&&(0==lottery.prize&&7==lottery.index||lottery.prize==lottery.index+1)?(lottery.speed+=110,setTimeout(function(){winningPrize(id)},1e3)):lottery.speed+=20;lottery.speed<40&&(lottery.speed=40),lottery.timer=setTimeout(roll,lottery.speed)}return!1}var indexs=0,lottery={index:-1,count:0,timer:0,speed:20,times:0,cycle:50,prize:-1,init:function(t){$("#"+t).find(".lottery-unit").length>0&&($lottery=$("#"+t),$units=$lottery.find(".lottery-unit"),this.obj=$lottery,this.count=$units.length,$lottery.find(".lottery-unit.lottery-unit-"+this.index).addClass("drawactive"))},roll:function(){var t=this.index,i=this.count,e=this.obj;return $(e).find(".lottery-unit.lottery-unit-"+t).removeClass("drawactive"),t+=1,t>i-1&&(t=0),$(e).find(".lottery-unit.lottery-unit-"+t).addClass("drawactive"),this.index=t,!1},stop:function(t){return this.prize=t,!1}},id=0;