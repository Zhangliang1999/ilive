function next(){if(0==voteId)return layerOpen("投票活动标示未获得"),!1;var t=document.getElementById("QuestonBox");if(0==vote_num){var e=!0,o="你没有选择答案，无法继续下一题",s=0,n=problemAnswers;$("#QuestonBox li").each(function(t,o){if(1==$(o).find("input").prop("checked")){s+=1;var n=$(o).find("input").attr("problem_Answer");problemAnswers=n+","+problemAnswers,e=!1}});var i=$("#QuestonBox li").attr("maxVoteNum");if(s>i&&(o="选择项大于最大限制数",e=!0),e)return problemAnswers=n,layerOpen(o),!1;console.log(problemAnswers);var a=$("input[name=userId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/addVote.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{userId:a,problemAnswers:problemAnswers,voteId:voteId},success:function(t){if(1!=t.code)return layerOpen(t.message),!1;successVode()}})}else{e=!0,o="你没有选择答案，无法继续下一题",s=0;$("#QuestonBox li").each(function(t,o){if(1==$(o).find("input").prop("checked")){s+=1;var n=$(o).find("input").attr("problem_Answer");problemAnswers=problemAnswers+n+",",e=!1}});i=$("#QuestonBox li").attr("maxVoteNum");if(s>i&&(o="选择项大于最大限制数",e=!0),e)return problemAnswers="",layerOpen(o),!1;vote_num--,show_num++;o=document.getElementById("question_"+show_num).innerHTML;t.innerHTML=o}}function closeVode(){layer.closeAll()}function selectTouPiao(){var t=$("input[name=userId]").val(),e=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getVote.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{roomId:e,userId:t},success:function(t){if(console.log(t),401==t.code)setlogin();else if(402==t.code)layer.closeAll(),setlogin("bindPhone");else if(403==t.code);else{if(1!=t.code)return layerOpen(t.message),!1;var e=t.data;if(voteId=e.id,isOpen=e.isOpen,0==t.voteStatus){var o='<div class="voteResult mescroll">';o+='\t<div class="voteMain">';var s=e.list;vote_num=s.length-1,problemAnswers="";for(var n=0;n<vote_num+1;n++){var i=s[n],a=i.maxVoteNum;if(0==n){o+='\t\t<div id="QuestonBox">',o+='\t\t\t<div class="voteList">',o+='\t\t\t\t<div class="voteQuestion">'+i.problemName+"(多选题 ， 最大"+a+"项)</div>",o+='\t\t\t\t<div class="voteListCon">',o+='\t\t\t\t\t<ul class="MainUl">';for(var v=i.listOption,l=0;l<v.length;l++){var d=v[l];o+='\t\t\t\t\t\t<li maxVoteNum = "'+a+'">',o+="\t\t\t\t\t\t\t<label>",o+='\t\t\t\t\t\t\t\t<div class="way-choose">',o+='\t\t\t\t\t\t\t\t\t<input type="checkbox" problem_Answer="'+i.id+"_"+d.id+'"  name="problem_'+i.id+'" class="agreement-checkbox choose-way">',o+="\t\t\t\t\t\t\t\t</div>",o+="<div class='content'>"+d.content+"</div>",2==i.style&&(o+='\t\t\t\t\t\t\t<img class="wayImg" src="'+d.contentImg+'" alt=""/>'),o+="\t\t\t\t\t\t\t</label>",o+="\t\t\t\t\t\t</li>"}o+="\t\t\t\t\t</ul>",o+="\t\t\t\t</div>",o+="\t\t\t</div>",o+="\t\t</div>"}else{o+='\t\t<div id="question_'+n+'" style="display: none;" class="voteList">',o+='\t\t\t<div class="voteQuestion">'+i.problemName+"(多选题 ， 最大"+a+"项)</div>",o+='\t\t\t<div class="voteListCon">',o+='\t\t\t\t<ul class="MainUl">';for(v=i.listOption,l=0;l<v.length;l++){d=v[l];o+='\t\t\t\t\t<li maxVoteNum = "'+a+'">',o+="\t\t\t\t\t\t<label>",o+='\t\t\t\t\t\t\t<div class="way-choose">',o+='\t\t\t\t\t\t\t\t<input type="checkbox" problem_Answer="'+i.id+"_"+d.id+'" name="problem_'+i.id+'" class="agreement-checkbox choose-way">',o+="\t\t\t\t\t\t\t</div>",o+="<div class='content'>"+d.content+"</div>",2==i.style&&(o+='\t\t\t\t\t\t\t<img class="wayImg" src="'+d.contentImg+'" alt=""/>'),o+="\t\t\t\t\t\t</label>",o+="\t\t\t\t\t</li>"}o+="\t\t\t\t</ul>",o+="\t\t\t</div>",o+="\t\t</div>"}}o+="\t</div>",o+="</div>",o+='\t<div class="voteconButton">继&nbsp;续</div>',$("#vodeContentDiv").html(o)}else if(1==t.voteStatus){var c=t.data.startTime;noStartVode(c)}else 2==t.voteStatus?endVode():3==t.voteStatus&&participationVode()}}})}function endVode(){var t='<div class="voteNostart">';t+='\t<div class="voteNostartPic"></div>',t+='\t<div class="voteText">投票活动已结束</div>',t+="</div>",$("#vodeContentDiv").html(t)}function noStartVode(t){var e='<div class="voteNostart">';e+='\t<div class="voteNostartPic"></div>',e+='\t<div class="voteText">投票将于'+t+"开始</div>",e+="</div>",$("#vodeContentDiv").html(e)}function successVode(){var t='<div class="voteEnd">';t+='\t<div class="voteendPic"></div>',t+='\t<div class="voteText">投票提交已完成</div>',t+='\t<div class="voteText">感谢您的参与</div>',t+=1==isOpen?'\t<div class="voteendButton" onclick="vodeContent()">投&nbsp;票&nbsp;结&nbsp;果</div>':'\t<div class="voteendButton" onclick="closeVode()">关&nbsp;闭</div>',t+="</div>",$("#vodeContentDiv").html(t)}function participationVode(){var t='<div class="voteEnd">';t+='\t<div class="voteendPic"></div>',t+='\t<div class="voteText">你已参与过投票</div>',t+='\t<div class="voteText">感谢您的参与</div>',t+=1==isOpen?'\t<div class="voteendButton" onclick="vodeContent()">投&nbsp;票&nbsp;结&nbsp;果</div>':'\t<div class="voteendButton" onclick="closeVode()">关&nbsp;闭</div>',t+="</div>",$("#vodeContentDiv").html(t)}function vodeContent(){if(0==voteId)return layerOpen("投票活动标示未获得"),!1;$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getResult.jspx",dataType:"jsonp",jsonp:"callback",cache:!1,data:{voteId:voteId},success:function(t){if(console.log(t),1!=t.code)return layerOpen(t.message),!1;console.log("投票结果");var e=t.data,o=e.list,s='<div class="voteResult mescroll">';s+='\t<div class="voteMain">';for(var n=0;n<o.length;n++){var i=o[n];s+='\t<div class="voteList">',s+='\t\t<div class="voteQuestion">Q'+(n+1)+": "+i.problemName+"</div>";for(var a=i.listOption,v=0;v<a.length;v++){var l=a[v];s+='\t\t\t<div class="voteListCon">',s+='\t\t\t\t<div class="voteListName">'+l.content+"</div>",s+='\t\t\t\t<div class="Bar">',s+='\t\t\t\t\t<div class="progress" style="width:'+l.percen+'%;"></div>',s+="\t\t\t\t</div>",s+='\t\t\t\t<div class="progressNum">'+l.percen+"%</div>",s+="\t\t\t</div>"}s+="\t</div>"}s+="</div>",s+="</div>",$("#vodeContentDiv").html(s)}})}var vote_num=0,show_num=0,problemAnswers="",voteId=0,isOpen=0;$("body").delegate(".voteconButton","click",function(){next()});