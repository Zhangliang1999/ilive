function savePhone(f){var d=$(f).parent();var b=d.find($("input[name=phoneNumber]")).val();var a=d.find($("input[name=passwordCode]")).val();var e=$("input[name=roomId]").val();var c=$("input[name=userId]").val();if(!isPoneAvailable(b.trim())){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"请输入正确的手机号"});return false}if(a==null||a==undefined){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"验证码不能为空"});return false}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/personal/bindMobile.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"pc",userId:c,phoneNum:b,vpassword:a},success:function(g){if(g.code==1){window.location.href="http://"+h5Base+"/pc/play.html?roomId="+e+"&userId="+c}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:g.message})}}})}function getAuthenticode(c){var a=$(c).parent().prev().find($("input")).val();var b=$(c).data("type")=="reg"?"reg":"bindMobile";if(!isPoneAvailable(a.trim())){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"请输入正确的手机号"});return false}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/appuser/sendmsg.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{phoneNum:a,type:b,terminalType:"pc"},success:function(e){var d=e.code;if(d==1){selectTimers(c)}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:e.message})}}})}var countdown=60;function selectTimers(a){if(countdown==0){$(a).removeAttr("disabled");$(a).text("获取验证码").attr("onclick","getAuthenticode(this)");countdown=60}else{$(a).attr("disabled",true);$(a).text("重新发送("+countdown+"s)").removeAttr("onclick");countdown--;setTimeout(function(){selectTimers(a)},1000)}}function questionSpan(){var a=$("input[name=liveMsgType]").val();if(a==2){$("input[name=liveMsgType]").val(3);$("#questionSpan").addClass("questionActive");$("input[name=content]").attr("maxlength","100")}else{$("input[name=liveMsgType]").val(2);$("#questionSpan").removeClass("questionActive");$("input[name=content]").attr("maxlength","40")}}function selectLiveMsgType(a){$("#questionSpan").removeClass("questionActive");if(a==2){$("input[name=liveMsgType]").val(2);$("#questionSpan").attr("onclick","questionSpan()");$("input[name=content]").removeAttr("readonly");$(".sendBtn").attr("onclick","sendMessageBtn()")}else{if(a==1){$("input[name=liveMsgType]").val(1);$("input[name=content]").attr("readonly","readonly");$("#questionSpan").removeAttr("onclick");$(".sendBtn").removeAttr("onclick");selectMessageLIVE()}}}function saveDianZan(){var a=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/register/registerRoom.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"pc",roomId:a},success:function(b){if(b.code==401){window.location.href="http://"+h5Base+"/phone/login.html?roomId="+a}else{if(b.code==402){saveMessagerPhoneNumber()}else{if(b.code==403){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:b.message})}else{if(b.code==1){$("#dianZanSpan").removeAttr("onclick").addClass("saveDianZan")}else{$("#dianZanSpan").removeAttr("onclick").addClass("saveDianZan")}}}}}})}function selectDianZan(){var a=$("input[name=roomId]").val();var c=$("input[name=userId]").val();var b=$("input[name=liveEventId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/register/queryIsRegister.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{liveEventId:b,userId:c},success:function(e){var d=e.code;if(d==1){var f=e.data.isDianzanReg;if(f){$("#dianZanSpan").removeAttr("onclick").addClass("saveDianZan")}}}})}function selectRoomLogo(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectRoom.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(g){if(g.code==1){var e=JSON.parse(g.iLiveLiveRoom);var c=e.liveEvent;var d=c.liveTitle;var b=e.bgdImg;var f=e.logoImg;if(f){$(".z-logo img").attr("src",f)}if(b){$(".header").css("background-image","url("+b+")")}if(d==undefined){d="天翼直播平台"}$("title").text(d);$("#roomName").text(d)}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"获取直播间信息失败"})}}})}function saveAppointment(){var a=$("input[name=userId]").val();var b=$("input[name=roomId]").val();if(a==0){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+b}else{$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/homepage/saveAppointment.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,roomId:b},success:function(d){if(d.code==401){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+b}else{if(d.code==402){saveMessagerPhoneNumber()}else{if(d.code==403){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:d.message})}else{if(d.code==1){if(d.data.userid!=undefined){var c=d.status;if(c==1){$("#uploadModal").modal();selectAppointment()}else{if(c==2){selectAppointment();$.DialogBySHF.Alert({Width:350,Height:200,Title:"预约提示",Content:d.message})}}}else{$(".appointment").text("我要预约");$.DialogBySHF.Alert({Width:350,Height:200,Title:"预约提示",Content:d.message})}}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"预约失败"})}}}}}})}}function openConfirmApp(){console.log("你确认了查看直播方更多直播内容");window.location.href="http://apizb.tv189.com/version/wap/download/ios"}function temporaryCancelApp(){console.log("你放弃查看直播方更多直播内容")}function saveMessagerPhoneNumber(){console.log("弹框进行手机号绑定");$("#myModal").modal()}function selectAppointment(){var a=$("input[name=userId]").val();if(a!=0){var b=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/homepage/isAppointment.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",userId:a,roomId:b},success:function(c){if(c.code==1){if(c.data.isAppointment==1){$("#saveAppointment").addClass("ordered");$("#saveAppointment").text("已预约本场直播")}else{$("#saveAppointment").removeClass("ordered");$("#saveAppointment").text("预约本场直播")}}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"预约信息查询失败"})}}})}}var ws;function selectHTML(b){var a=window.setInterval(function(){var d={p:"1"};if(ws){try{ws.send(JSON.stringify(d));console.log("websocket 连接已关闭")}catch(c){console.log("websocket 连接已关闭")}}},10000);$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/roomenter.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:b,sessionType:1,webType:2},success:function(i){if(i.code==404){window.location.href="http://"+h5Base+"/pc/end.html"}else{if(i.code==402){var j=$("input[name=userId]").val();if(j!=0){window.location.href="http://"+h5Base+"/pc/phoneNumber.html?roomId="+b+"&userId="+j}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"绑定手机号，获取用户失败",ConfirmFun:errorfunction})}}else{if(i.code==1){var j=$("input[name=userId]").val();if(j!=0){selectDianZan()}var k=i.hlsAddr;var e=i.rtmpAddr;videoDiv(e);var h=10;var f=i.estoppelType;if(f==0){$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{var c=i.forbidTalk;console.log("禁言标示："+c);if(c==1){h=11;$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{h=10;$("input[name=content]").removeAttr("disabled");$(".sendBtn").attr("onclick","sendMessageBtn()")}}if(typeof(WebSocket)=="undefined"){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"你的浏览器不支持信息交流",ConfirmFun:errorfunction});return}var g=i.token;var d="ws://"+tomcatBase+"/ilive/webSocketServer.jspx?username="+g;ws=new WebSocket(d);ws.onopen=function(l){console.log("连接成功")};ws.onclose=function(l){console.log("关闭连接 ")};ws.onerror=function(l){console.log("建立连接异常"+l)};ws.onmessage=function(u){var v=JSON.parse(u.data);switch(v.roomType){case 0:var w=v.iLiveEventVo;f=w.estoppleType;if(f==0){$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{if(f==1){if(h==11){$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{$("input[name=content]").removeAttr("disabled");$(".sendBtn").attr("onclick","sendMessageBtn()")}}}var A=w.liveStatus;var p=w.playBgAddr;var z=w.converAddr;switch(A){case 0:liveStart=0;$("#videoImage").css({display:"block","background-image":"url("+z+")"});$("#flash").css("display","none");$("#startLive").css("display","block");$("#stopLive").css("display","none");$("#endLive").css("display","none");$("#videoStartDiv").css("display","block");break;case 1:$("#flash").css("display","block");$("#videoImage").css("display","none");$("#videoStartDiv").css("display","none");$("#startLive").css("display","none");$("#stopLive").css("display","none");$("#endLive").css("display","none");$(".marqueeBox").css("bottom","30px");break;case 2:liveStart=0;$("#flash").css("display","none");$("#videoImage").css({display:"block","background-image":"url("+p+")"});$("#startLive").css("display","none");$("#stopLive").css("display","block");$("#endLive").css("display","none");$("#videoStartDiv").css("display","block");break;case 3:liveStart=0;$("#flash").css("display","none");$("#videoImage").css({display:"block","background-image":"url("+z+")"});$("#startLive").css("display","none");$("#stopLive").css("display","none");$("#endLive").css("display","block");$("#videoStartDiv").css("display","block");break;default:$("#videoImage").css({display:"block","background-image":"url("+z+")"})}break;case 1:if(v.deleted==1){$("#msgId_"+v.msgId).remove()}else{var m=v.deleteAll;if(m==1){$("#chatMessageDiv").children().remove();$("#topChatMessageDiv").children().remove()}else{var t=$("input[name=userId]").val();var l=v.liveMsgType;var r=v.update;if(v.senderId==t){if(f==1){h=v.opType;if(h==11){$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{$("input[name=content]").removeAttr("disabled");$(".sendBtn").attr("onclick","sendMessageBtn()")}}else{h=v.opType}}if(l==2){if(v.checked==1){$("#msgId_"+v.msgId).remove();if(v.top==0){var n='<div id="msgId_'+v.msgId+'">';n+='		<p class="sofa">';n+='			<i class="btext">'+v.senderName+"：</i>"+v.webContent;n+="		</p>";n+="</div>";$("#topChatMessageDiv #msgId_"+v.msgId).prepend(n);$("#chatMessageDiv").prepend(n)}else{var n='<div id="msgId_'+v.msgId+'">';n+='		<p class="sofa">';n+='			<span class="spanTop">顶</span><i class="btext">'+v.senderName+"：</i>"+v.webContent;n+="		</p>";n+="</div>";$("#chatMessageDiv #msgId_"+v.msgId).prepend(n);$("#topChatMessageDiv").prepend(n)}}else{if(v.senderId==t){$("#msgId_"+v.msgId).remove();if(v.top==0){var n='<div id="msgId_'+v.msgId+'">';n+='		<p class="sofa">';n+='			<i class="btext">'+v.senderName+"：</i>"+v.webContent;n+="		</p>";n+="</div>";$("#topChatMessageDiv #msgId_"+v.msgId).prepend(n);$("#chatMessageDiv").prepend(n)}else{var n='<div id="msgId_'+v.msgId+'">';n+='		<p class="sofa">';n+='			<span class="spanTop">顶</span><i class="btext">'+v.senderName+"：</i>"+v.webContent;n+="		</p>";n+="</div>";$("#chatMessageDiv #msgId_"+v.msgId).prepend(n);$("#topChatMessageDiv").prepend(n)}}}}else{if(l==3){if(v.replyType==1){var n='<div id="msgId_'+v.msgId+'">';n+='	<p class="quiz"><span class="spanTop">提问</span><i>'+v.senderName+"：</i>"+v.webContent+"</p>";n+='	<p class="answer btext"><span class="spanTop bluegb">回答</span><i>'+v.replyName+"：</i>"+v.replyContent+"</p>";n+="</div>";$("#msgId_"+v.msgId).remove();$("#chatMessageDiv").prepend(n)}else{var y=v.senderId;var t=$("input[name=userId]").val();if(y==0||y==null||y==undefined){}else{if(y==t){var n='<div id="msgId_'+v.msgId+'">';n+='	<p class="quiz"><span class="spanTop">提问</span><i>'+v.senderName+"：</i>"+v.webContent+"</p>";n+="</div>";$("#msgId_"+v.msgId).remove();$("#chatMessageDiv").prepend(n)}}}}}}}break;case 2:console.log("发现新话题");break;case 3:window.location.href="http://"+h5Base+"/pc/end.html";break;case 4:console.log("广告滚动");selectAdvertising();break;case 5:console.log("抽奖");selectActions();break;case 6:selectActions();console.log("投票");break;case 7:console.log("赠送礼物");break;case 8:break;case 9:selectActions();console.log("打赏");break;case 10:console.log("欢迎语");break;case 11:var o=v.documentId;var s=v.documentPageNO;var q=v.documentManual;var x=v.documentDownload;selectDocument(o,x,s,q);break;case 12:break;case 13:break;case 14:break;case 15:console.log("签到活动");selectActions();break;case 16:console.log("红包");selectActions();break;case 18:var w=v.iLiveEventVo;f=w.estoppleType;if(f==0){$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{if(f==1){if(h==11){$("input[name=content]").attr("disabled","disabled");$(".sendBtn").removeAttr("onclick")}else{$("input[name=content]").removeAttr("disabled");$(".sendBtn").attr("onclick","sendMessageBtn()")}}}break;default:console.log("操作类型"+v.roomType)}}}else{if(i.code==2){window.location.href="http://"+h5Base+"/pc/permissions.html"}else{if(i.code==3){window.location.href="http://"+h5Base+"/pc/standby.html?roomId="+b}else{window.location.href="http://"+h5Base+"/pc/error.html"}}}}}}})}function errorfunctionAuthentication(){window.location.href="http://"+h5Base+"/pc/permissions.html"}function errorfunctionFull(){var a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/pc/standby.html?roomId="+a}function selectcommentsList(a){$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/comments/selectList.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(k){var h=k.code;if(h==1){var t=JSON.parse(k.iLiveCommentsMap);for(var l=0;l<t.length;l++){var c=t[l];var r=c.list;var d="";for(var g=0;g<r.length;g++){var p=r[g];d+="<p>";d+='		<i class="btext">'+p.commentsName+":</i>"+p.comments;d+="</p>"}$("#commentsNumber_"+c.msgId).text(r.length);$("#commentsList_"+c.msgId).html(d)}var m=JSON.parse(k.praiseMap);var o=$("input[name=userId]").val();for(var s in m){var e=m[s].length;if(e==undefined){e=0}var q=0;for(var l=0;l<e;l++){var n=m[s][l];var b=n.userId;if(parseInt(o)==parseInt(b)){q=1}}if(q==0){var f='<i onclick="saveILiveMessagePraise('+s+')"></i>';f+='<span id="praiseNumber_'+s+'">'+e+"</span>";$("#messagePraise_"+s).html(f)}else{var f='<i style="background-position: -29px -13px;"></i>';f+='<span id="praiseNumber_'+s+'">'+e+"</span>";$("#messagePraise_"+s).html(f)}}}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"获取话题评论失败"})}}})}function checknumberlength(b,a){if(a<9999){$(b).text(a)}else{a=(a/10000).toFixed(1)/1;$(b).text(a+"w")}}function selectRoomNumber(){var a=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/online/number.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(d){var b=d.code;if(b==1){var c=JSON.parse(d.data).number;if(c==undefined||c==null){c=0}checknumberlength($("#roomNumber"),c)}}});setTimeout(function(){selectRoomNumber()},6000)}function sendMessageBtn(){var b=$("input[name=roomId]").val();var a=$("input[name=userId]").val();if(a==0){loginHtml();return}var c=$("input[name=liveMsgType]").val();var e=$("input[name=liveEventId]").val();var d=$("input[name=content]").val();if(d.replace("s+","")==""||d==undefined){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"内容不能为空"});return}if(c==2||c==3){$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/sendMessage.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"pc",userId:a,roomId:b,liveMsgType:c,content:encodeURI(d),liveEventId:e,msgType:1},success:function(h){var f=h.code;if(h.code==401){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+b}else{if(h.code==402){saveMessagerPhoneNumber()}else{if(h.code==403){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:h.message})}else{if(f==1){var g=h.iLiveMessage;if(c==2){var i='<div id="msgId_'+g.msgId+'">';i+='		<p class="sofa">';i+='			<i class="btext">'+g.senderName+"：</i>"+g.webContent;i+="		</p>";i+="</div>";$("#chatMessageDiv").prepend(i)}else{if(c==3){var i='<div id="msgId_'+g.msgId+'">';i+='	<p class="quiz"><label>提问</label><i>'+g.senderName+"：</i>"+g.webContent+"</p>";i+="</div>";$("#chatMessageDiv").prepend(i)}}$("input[name=content]").val("")}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:h.message})}}}}}})}else{if(c==1){if(msgId==0){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"请选择要评论的话题"});return}$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/saveComments.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"pc",userId:a,msgId:msgId,comments:encodeURI(d)},success:function(g){var f=g.code;if(g.code==401){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+b}else{if(g.code==402){saveMessagerPhoneNumber()}else{if(g.code==403){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:g.message})}else{if(f==1){$("input[name=liveMsgType]").val(1);$("input[name=content]").attr("readonly","readonly");$("#questionSpan").removeAttr("onclick");$(".sendBtn").removeAttr("onclick");$("input[name=content]").val("");msgId=0;selectMessageLIVE()}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:g.message})}}}}}})}else{alert(tablevalue)}}}var msgId=0;function saveComments(a){msgId=a;$("input[name=content]").removeAttr("readonly");$(".sendBtn").attr("onclick","sendMessageBtn()");$("input[name=liveMsgType]").val(1)}function saveILiveMessagePraise(b){var a=$("input[name=userId]").val();if(a==0){loginHtml();return}$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/praise/savePraise.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"pc",userId:a,msgId:b},success:function(e){var c=e.code;if(e.code==401){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+d}else{if(e.code==402){saveMessagerPhoneNumber()}else{if(e.code==403){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:e.message})}else{if(c==1){var d=$("input[name=roomId]").val();selectcommentsList(d)}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:e.message})}}}}}})}function selectMessageLIVE(){var a=$("input[name=roomId]").val();$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/message/selectMessageLIVE.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(d){var c=d.code;if(c==1){var e=d.data;var g="";var l="";for(var f=0;f<e.length;f++){var h=e[f];if(h.top==0){l+='<div id="msgId_'+h.msgId+'">';l+='		<p class="sofa">';l+='			<i class="btext">'+h.senderName+"：</i>";if(h.msgType==2){l+="		<br/>"}l+=h.webContent;l+="		</p>";if(h.msgType==2||h.msgType==4){var k=h.images;l+="<p>";for(var b=0;b<k.length;b++){l+='<img class="toBig" data-src="'+k[b]+'" src="'+k[b]+'" />'}l+="</p>"}else{if(h.msgType==5||h.msgType==3){l+="<p>";l+='<img class=" toVideo"  video="'+h.video+'" src="http://pic.zb.tv189.com/img/defaultVedio.png"/>';l+="<p>"}}l+='		<p class="handle">';l+='			<span class="message"><i onclick="saveComments('+h.msgId+')"></i><span id="commentsNumber_'+h.msgId+'">0</span></span>';l+='		 	<span class="thumbup" id="messagePraise_'+h.msgId+'"><i></i><span id="praiseNumber_'+h.msgId+'">0</span></span>';l+="		</p>";l+='		<div class="reply">';l+='			<div id="commentsList_'+h.msgId+'"></div>';l+="		</div>";l+="</div>"}else{g+='<div id="msgId_'+h.msgId+'">';g+='		<p class="sofa">';g+='			<span class="spanTop">顶</span><i class="btext">'+h.senderName+"：</i>"+h.webContent;g+="		</p>";if(h.msgType==2||h.msgType==4){g+="<p>";var k=h.images;for(var b=0;b<k.length;b++){g+='<img class="toBig" data-src="'+k[b]+'" src="'+k[b]+'" />'}g+="</p>"}else{if(h.msgType==5||h.msgType==3){g+="<p>";g+='<img class=" toVideo"  video="'+h.video+'" src="http://pic.zb.tv189.com/img/defaultVedio.png"/>';g+="</p>"}}g+='		<p class="handle">';g+='			<span class="message"><i></i><span id="commentsNumber_'+h.msgId+'">0</span></span>';g+='		 	<span class="thumbup" id="messagePraise_'+h.msgId+'"><i></i><span id="praiseNumber_'+h.msgId+'">0</span></span>';g+="		</p>";g+='		<div class="reply">';g+='			<div id="commentsList_'+h.msgId+'"></div>';g+="		</div>";g+="</div>"}}$("#topicDiv").html(l);$("#topTopicDiv").html(g);selectcommentsList(a)}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:d.message})}}})}function updateConcernStatus(b,c){var a=$("input[name=userId]").val();if(a==0){loginHtml();return}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/app/room/enterprise/concern.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"pc",enterpriseId:b,userId:a,type:c},success:function(e){var d=e.code;if(e.code==401){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+roomId}else{if(e.code==402){saveMessagerPhoneNumber()}else{if(e.code==403){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:e.message})}else{if(d==1){if(c==0){$("#yiguanzhu").css("display","none");$("#guanzhu").css("display","block");$.DialogBySHF.Alert({Width:350,Height:200,Title:"关注提示",Content:e.message})}else{$("#yiguanzhu").css("display","block");$("#guanzhu").css("display","none");$.DialogBySHF.Confirm({Width:350,Height:200,Title:"关注提示",Content:e.message,ConfirmFun:openConfirm,CancelFun:temporaryCancel});$("#btnDialogBySHFConfirm").val("现在打开");$("#btnDialogBySHFCancel").val("暂时不用")}}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:e.message})}}}}}})}function openConfirm(){console.log("你确认了查看直播方更多直播内容")}function temporaryCancel(){console.log("你放弃查看直播方更多直播内容")}function selectTimer(r){var p=r.split(" ");var l=p[0].split("-");var o=parseInt(l[0],10);var a=parseInt(l[1],10)-1;var u=parseInt(l[2],10);var m=p[1].split(":");var i=parseInt(m[0],10);var f=parseInt(m[1],10);var b=parseInt(m[2],10);var t=new Date(o,a,u,i,f,b);var e=new Date();var d=t.getTime()-e.getTime();if(d>0){var c=Math.floor(d/(24*3600*1000));var k=d%(24*3600*1000);var q=Math.floor(k/(3600*1000));var j=k%(3600*1000);var n=Math.floor(j/(60*1000));var h=j%(60*1000);var g=Math.round(h/1000);var s=c+" 天 "+q+" 小时 "+n+" 分钟 "+g+" 秒";$("#startLiveTime").html("距离直播开始：<i>"+c+"</i>天<i>"+q+"</i>小时<i>"+n+"</i>分<i>"+g+"</i>秒");setTimeout(function(){selectTimer(r)},1000)}else{$("#startLiveTime").html("距离直播开始：<i>0</i>天<i>0</i>小时<i>0</i>分<i>0</i>秒")}}function selectMediaFile(a){var c=$("input[name=roomId]").val();var b=$("input[name=userId]").val();window.location.href="http://"+h5Base+"/pc/review.html?fileId="+a+"&userId="+b+"&roomId="+c}function videoDiv(c){interfaceHttp=c,shareHtmlUrl="",shareStatu="",AddressSeparator="#",authUrl="true",ifShowImageBtn="false",ifAuthCDN_WS="false",PlayVideoAspect="mc169",ifShowLogo="false",AudioPlayerType="0",AVPlayerType="0",ifShiftMove="true",_playAuto="true";var a="interfaceHttp="+interfaceHttp+"&AudioPlayerType="+AudioPlayerType+"&AVPlayerType="+AVPlayerType+"&authUrl="+authUrl+"&AddressSeparator="+AddressSeparator+"&ifShowLogo="+ifShowLogo+"&ifShiftMove="+ifShiftMove+"&ifAuthCDN_WS="+ifAuthCDN_WS+"&PlayVideoAspect="+PlayVideoAspect+"&ifShowTime="+ifShowTime+"&ifShowPoopBtn="+ifShowPoopBtn+"&ifShowImageBtn="+ifShowImageBtn+"&ifShowSetBtn="+ifShowSetBtn+"&playAuto="+_playAuto+"&ifShowStreamBtn="+ifShowStream+"&bufferLongTime="+bufferLongTime+"&streamType="+streamType+"&function_lamp_method="+function_lamp_method+"&small_video_window="+small_video_window+"&interfaceType="+interfaceType+"&function_stop_method="+function_stop_method+"&ifForbitSeek="+ifForbitSeek+"&shareStatu="+shareStatu+"&shareSwfUrl="+shareSwfUrl+"&shareHtmlUrl="+shareHtmlUrl+"&ifShowMenuItem="+ifShowMenuItem;var d='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="100%" height="100%" id="'+playerName+'" align="middle">				<param name="movie" value="'+swfUrl+'" />				<param name="quality" value="high" />				<param name="bgcolor" value="#000000" />				<param name="devicefont" value="false" />				<param name="wmode" value="opaque" />				<param name="allowScriptAccess" value="always" />				<param name="allowFullscreen" value="true" />				<param name="allownetworking" value="all" />				<param name="salign" value="lt" />				<param name="flashvars" value="'+a+'"  />					<a href="http://www.adobe.com/go/getflash">						<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="获得 Adobe Flash Player" />					</a>			</object>';if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){d='<embed   src="'+swfUrl+'" id="'+playerName+'" name="'+playerName+'" type="application/x-shockwave-flash" data="'+swfUrl+'"  quality="high" allowScriptAccess="always" redirectUrl="http://www.adobe.com/shockwave/download/download.cgi?" swLiveConnect="true" menu="false" allowFullScreen="true" salign="lt"  width="100%" height="100%" flashvars="'+a+'">				</embed>'}var b="flash";document.getElementById(b).innerHTML=d}function errorfunction(){window.location.href="http://"+h5Base+"/pc/error.html"}function loginHtml(){var a=$("input[name=roomId]").val();window.location.href="http://"+h5Base+"/pc/login.html?roomId="+a}function loginHtmlError(){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"你放弃了登录、无法进行操作"})}function selectAdvertising(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectAdvertising.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(e){if(e.code==1){var d=e.data;var b=d.startType;if(b==1){console.log("开启");var c=d.content;$(".marqueeBox").removeClass("hide").text(c);$(".marqueeBox").marquee({duration:10000})}else{console.log("关闭");$(".marqueeBox").addClass("hide")}}else{console.log("获取滚动消息失败："+e.message)}}})}var gallerySwiper,def_Manual;function selectDocument(c,b,d,a){def_Manual=a;if(c==-1){checkslide();if(b==0){$(".download span").css("display","none")}else{$(".download span").css("display","inline-block")}gallerySwiper.slideTo(d-1,1000,false)}else{$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/document/getByd.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{docId:c},success:function(f){if(f.code==1){var e=f.data;documentPictures=e.list;var g="";g+='<div class="swiper-container" id="gallery">';g+='  <div class="swiper-wrapper">';g+="  </div></div>";g+='<div class="pagintatioin"><div class="prevAll"><i class="iconfont icon-prevall"></i></div><div class="prev"><i class="iconfont icon-prev"></i></div><div class="swiper-pagination document-pagination"></div><div class="next"><i class="iconfont icon-next"></i></div><div class="nextAll"><i class="iconfont icon-nextall"></i></div><div  class="inputText"><input type="text" value="1"></div><div class="documentBtn"><button>确定</button></div><div class="download"><span onclick="selectDocumentList('+c+')" ></span></div></div>';g+="";$(".document").html(g);wendangJS(documentPictures,d-1);if(b==0){$(".download span").css("display","none")}else{$(".download span").css("display","inline-block")}}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"data.message"})}}})}}function selectDocumentList(a){alert("开发中")}var firstImg;var num;var imgW;var timer;function wendangJS(a,b){gallerySwiper=new Swiper("#gallery",{initialSlide:b||0,noSwiping:true,observer:true,observeParents:true,width:$("#gallery").width(),pagination:{el:".document-pagination",type:"fraction"},virtual:{slides:(function(){var e=[];for(var d=0;d<a.length;d++){var c=a[d].url;e.push('<div class="swiper-slide"><img data-src="'+c+'"  class="swiper-lazy"><div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div></div>')}return e}())},lazy:{loadPrevNext:true,loadPrevNextAmount:2}});gallerySwiper.slideTo(b,1000,false);checkslide()}function checkslide(a){if(!def_Manual){gallerySwiper.$wrapperEl.addClass("swiper-no-swiping");$(".pagintatioin").hide()}else{$(".pagintatioin .prevAll").click(function(){gallerySwiper.slideTo(0,1000,false)});$(".pagintatioin .prev").click(function(){gallerySwiper.slidePrev()});$(".pagintatioin .next").click(function(){gallerySwiper.slideNext()});$(".pagintatioin .nextAll").click(function(){var b=$(".swiper-pagination-total").text();gallerySwiper.slideTo(b-1,1000,false)});$(".pagintatioin .documentBtn").click(function(){var b=$(".inputText").find("input").val();gallerySwiper.slideTo(b-1,1000,false)});gallerySwiper.$wrapperEl.removeClass("swiper-no-swiping");$(".pagintatioin").show()}}function openDocument(){var a=$(".play-video");var c=$(".document");var d=a.clone();var b=c.clone();c.html(d.children());a.html(b.children());wendangJS(documentPictures,gallerySwiper.realIndex)}function downloadFile(a){window.location.href=a}function downloadAll(){$("#fileTbody tr").each(function(b,c){if($(c).find("input").is(":checked")){var a=$(c).find("input").attr("url");window.location.href=a}})}function selectAll(){if($("#checkboxAll").is(":checked")){$("#fileTbody tr").each(function(a,b){$(b).find("input").prop("checked",true)})}else{$("#fileTbody").each(function(a,b){$(b).find("input").prop("checked",false)})}}function loadJsCss(a,b){if(b=="js"){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a)}else{if(b=="css"){var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a)}}if(typeof c!="undefined"){document.getElementsByTagName("head")[0].appendChild(c)}}var hbflag=false;function hongbao(){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isRedPacket.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(c){var b=c.code;if(b==1){openhongbao(c.packet.command);hbflag=true}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"data.message"})}}})}function openhongbao(i){customModal();if(hbflag){return false}var j=i.split("");var a=$("#popuphongbao")[0];var h=a.getContext("2d");var b=$("#imghongbao")[0];var g=new Image();var f=[];var e=[];$.each(j,function(l,k){if(l<=9){f.push(k)}else{e.push(k)}});var d=f.join("  ");var c=e.join("  ");g.src="images/hongbao.png";g.onload=function(){h.drawImage(g,0,0);h.textBaseline="middle";h.textAlign="center";var l=a.width/2;var k=a.height/2+92;h.fillStyle="#000";if(c.length>0){h.font="16px Microsoft YaHei";h.fillText(d,l,k-10);h.fillText(c,l,k+12)}else{h.font="24px Microsoft YaHei";h.fillText(d,l,k)}b.src=a.toDataURL("image/jpg")}}function qiandao(){GetSignId(function(a){$("#actionContent").html(qiandaoHTML(a))})}function GetSignId(b){var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isSign.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(c){b(c.signId);if(c.code==1){b(c.signId)}}})}function validate(c,a){var b=c.value;if(b!=null&&b!=""){if(!isPoneAvailable(b.trim())){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"请输入正确的手机号"});return false}$.ajax({type:"POST",url:"http://"+tomcatBase+"/ilive/prize/siginPhone.jspx?userPhone="+b+"&signId="+a,dataType:"jsonp",jsonp:"callback",async:false,cache:false,success:function(e){var d=e.status;if(d==1){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"您已签到"});$(".QiandaoBtn").attr("disabled","true").addClass("disableBtn");return false}else{$(".QiandaoBtn").removeAttr("disabled").removeClass("disableBtn")}}})}}function saveQiandao(g,a){var e=$("input[name=roomId]").val();var f=$(g).parent();var d=f.find($("input[name=phoneNumber]")).val();var b=f.find($("input[name=vPassword]")).val();var h=f.find($("input[name=username]")).val();if(d==undefined||d.replace("s+","")==""){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"请输入手机号"});return false}if(b==undefined||b.replace("s+","")==""){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"验证码不能为空"});return false}if(h==undefined||h.replace("s+","")==""){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"昵称不能为空"});return false}var c="http://"+tomcatBase+"/ilive/prize/userSign.jspx";$.ajax({type:"POST",url:c,dataType:"jsonp",jsonp:"callback",cache:false,data:{userphone:d,username:encodeURIComponent(h),vPassword:b,roomId:e,signId:a},success:function(i){if(i.status=="0"){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:i.msg});return false}if(i.status==1000){$("#actionBar").modal("hide");$.DialogBySHF.Alert({Width:350,Height:200,Title:"签到成功",Content:i.msg});return false}if(i.status==1001){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:i.msg});return false}if(i.status==1002){$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:i.msg});return false}}})}function qiandaoHTML(a){if(a){html='<div class="main-qiandao"><div class="form-group"><input type="text" class="form-control" placeholder="手机号"   maxlength="11" name="phoneNumber" id="phoneNumber" onblur="validate(this,'+a+')"/><i class="iconfont icon-shouji"></i></div><div class="form-group"><input type="text" class="form-control vPassword" placeholder="动态密码"  maxlength="6" name="vPassword"/><i class="iconfont icon-yanzhengma"></i><span class="yzmBtn1" data-type="reg" onclick="getAuthenticode(this)" id="spenTimer">获取动态密码</span></div><div class="form-group"><input type="text" class="form-control" style="padding: 10px" placeholder="昵称 建议使用您的真实姓名签到，2-10个字" minlength="2" maxlength="10" name="username"/></div><button type="button" class="btn  QiandaoBtn tyBtn btn-lg btn-block"  disabled onclick="saveQiandao(this,'+a+')">点击立即签到</button></div>'}else{html="活动已结束"}return html}var $body=$(document.body);var $backdrop=null;function customModal(){$backdrop=$(document.createElement("div")).addClass("modal-backdrop fade in").appendTo($body);$body.addClass("modal-open");$(".Popup").show()}function removeModal(a){$body.removeClass("modal-open");$backdrop.remove();$backdrop=null;$(a).parent().hide()}$("#actionBar").on("show.bs.modal",function(e){var b=$(e.relatedTarget);var a=b.data("title");var c=b.data("type");var d=$(this);d.find(".modal-title").text(a);switch(c){case"qiandao":qiandao();break;case"choujiang":inPrize();break;case"hongbao":hongbao();case"toupiao":selectTouPiao()}});$("#actionBar").on("hide.bs.modal",function(a){$("#actionContent").children().remove()});function selectActions(){console.log("回去抽奖、投票是否开启");var a=$("input[name=roomId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/prize/isStartPrizr.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{terminalType:"h5",roomId:a},success:function(f){var e=f.code;if(e==1){var c=f.data.isPlayRewards;var h=f.data.isStartPrizr;var g=f.data.isStartRedPacket;var b=f.data.isStartSign;var d=f.data.isStartVote;if(b){setTimeout(function(){$("#qiandao").removeClass("hide")},100)}else{setTimeout(function(){$("#qiandao").addClass("hide")},100)}if(c){setTimeout(function(){$("#dashang").removeClass("hide")},100)}else{setTimeout(function(){$("#dashang").addClass("hide")},100)}if(h){setTimeout(function(){$("#choujiang").removeClass("hide")},100)}else{setTimeout(function(){$("#choujiang").addClass("hide")},100)}if(g){setTimeout(function(){$("#hongbao").removeClass("hide")},100)}else{setTimeout(function(){$("#hongbao").addClass("hide")},100)}if(d){setTimeout(function(){$("#toupiao").removeClass("hide")},100)}else{setTimeout(function(){$("#toupiao").addClass("hide")},100)}}else{console.log(f.message)}}})}function isPoneAvailable(a){var b=/^[1][3,4,5,7,8,9][0-9]{9}$/;if(!b.test(a)){return false}else{return true}}function selectPageDecorate(a,b){$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/selectPageDecorate.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:a},success:function(d){var c=d.code;if(c==1){b(d)}}})};