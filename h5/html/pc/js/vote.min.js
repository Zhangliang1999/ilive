var vote_num=0;var problemAnswers="";var voteId=0;var isOpen=0;var evTimeStamp=0;var Arr_Answer=[];var flat;function checklg(g){var h=$(g);var f=h.parents(".MainUl");var e=f.data("maxvotenum");var c=new Date();if(c.getTime()-evTimeStamp<100){return}evTimeStamp=c;var d=f.find($("input[type='checkbox']:checked")).length;if(d>e){h.prop("checked",false);$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:"选择项大于最大限制数"})}var a=h.attr("problem_Answer");if(h.prop("checked")){Arr_Answer.push(a)}else{var b=Arr_Answer.indexOf(a);if(b>-1){Arr_Answer.splice(b,1)}}console.log(Arr_Answer)}function checkVote(){$("#QuestonBox").find(".MainUl").each(function(a,d){flat=true;var b=0;$(d).find($("input[type='checkbox']")).each(function(){if($(this).prop("checked")){b++}});if(b<=0){var c="Q"+(a+1)+"问题未选择";$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:c});flat=false;return false}})}function next(){checkVote();if(flat){problemAnswers=Arr_Answer.join(",");var a=$("input[name=userId]").val();$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/addVote.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{userId:a,problemAnswers:problemAnswers,voteId:voteId},success:function(b){if(b.code==1){successVode("投票提交已完成","感谢您的参与")}else{layerOpen(b.message);return false}}})}return}function selectTouPiao(){vote_num=0;problemAnswers="";var a=$("input[name=userId]").val();var b=$("input[name=roomId]").val();if(a==0){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+b}$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getVote.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{roomId:b,userId:a},success:function(h){console.log(h);if(h.code==401){window.location.href="http://"+h5Base+"/pc/login.html?roomId="+b}else{if(h.code==402){saveMessagerPhoneNumber()}else{if(h.code==403){}else{if(h.code==1){var l=h.data;voteId=l.id;isOpen=l.isOpen;if(h.voteStatus==0){var g='	<div class="voteMain">';g+='		<div id="QuestonBox">';var n=l.list;vote_num=n.length-1;problemAnswers="";for(var k=0;k<vote_num+1;k++){var c=n[k];var o=c.maxVoteNum;g+='<div class="voteList" >';g+='   <div class="voteQuestion">Q'+[k+1]+": "+c.problemName+"(多选题 ， 最大"+o+"项)</div>";g+='   <div class="MainUl"  data-maxVoteNum = '+o+" data-question="+k+" >";var m=c.listOption;for(var f=0;f<m.length;f++){var e=m[f];g+="   <div class='checkbox'>";g+="       <label>";g+='       <input  onclick=\'checklg(this)\' type="checkbox" problem_Answer="'+c.id+"_"+e.id+'"  name="problem_'+c.id+'" class="agreement-checkbox choose-way">';g+="       <div class='choseText'>";g+="       <span class='Text'>"+e.content+"</span>";if(c.style==2){g+='       <span class=\'Img\'><img class="wayImg" src="'+e.contentImg+'" alt=""/></span>'}g+="       </div>";g+="       </label>";g+="</div>"}g+="					</div>";g+="				</div>"}g+="</div></div>";g+='	<div class="modal-footer">';g+='		<button type="button" class="btn tyBtn" onclick="next()">提交</button>';g+="	</div>";$("#actionContent").html(g);$(".voteMain").slimScroll({height:"350px"})}else{if(h.voteStatus==1){var d=h.data.startTime;endVode(d)}else{if(h.voteStatus==2){endVode()}else{if(h.voteStatus==3){successVode("你已参与过投票","感谢您的参与")}}}}}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:h.message})}}}}}})}function endVode(a){var b='<div class="voteMain">';b+='	<div class="NostartPic">';if(a){b+='	<div class="voteText"> <span>投票将于<time>'+a+"</time>开始</span></div>"}else{b+='	<div class="voteText">投票活动已结束</div>'}b+="	</div>";b+='	<div class="modal-footer">';b+='		<button type="button" class="btn tyBtn" data-dismiss="modal">关闭</button>';b+="	</div>";b+="</div>";$("#actionContent").html(b)}function successVode(b,a){var c='<div class="voteMain">';c+='	<div class="endPic">';c+='		<div class="voteText"><span>'+b+"</span><span>"+a+"</span></div>";c+="	</div>";c+='	<div class="modal-footer">';if(isOpen==1){c+='		<button type="button" class="btn tyBtn" onclick="vodeContent()">投票结果</button>'}else{c+='		<button type="button" class="btn tyBtn" data-dismiss="modal">关闭</button>'}c+="</div>";c+="</div>";$("#actionContent").html(c)}function vodeContent(){if(voteId==0){$.DialogBySHF.Alert({Width:350,Height:200,Title:"提示",Content:"投票活动标示未获得"})}else{$.ajax({type:"GET",url:"http://"+tomcatBase+"/ilive/vote/getResult.jspx",dataType:"jsonp",jsonp:"callback",cache:false,data:{voteId:voteId},success:function(d){console.log(d);if(d.code==1){console.log("投票结果");var g=d.data;var k=g.list;var b='<div class="voteMain">';b+='		<div id="QuestonBox">';for(var e=0;e<k.length;e++){var a=k[e];b+='	<div class="voteList">';b+='   <div class="voteQuestion">Q'+[e+1]+": "+a.problemName+"</div>";var h=a.listOption;for(var c=0;c<h.length;c++){var f=h[c];b+='			<div class="voteListCon">';b+='				<div class="voteListName">'+f.content+"</div>";b+="				<div class='bar'>";b+='				    <div class="progress">';b+='					    <div class="progress-bar" role="progressbar" aria-valuenow=" '+f.percen+' " aria-valuemin="0" aria-valuemax="'+f.percen+'" style="width:'+f.percen+'%;"></div>';b+="				    </div>";b+='				    <div class="progressNum">'+f.percen+"%</div>";b+="				</div>";b+="			</div>"}b+="	</div>"}b+="	</div>";b+="</div>";$("#actionContent").html(b);$(".voteMain").slimScroll({height:"350px"})}else{$.DialogBySHF.Alert({Width:350,Height:200,Title:"警告",Content:d.message})}}})}};