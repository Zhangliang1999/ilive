<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>天翼直播平台</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.bootcss.com/normalize/8.0.0/normalize.min.css"/>
    <link rel="stylesheet" href="css/style.min.css?version=2.0.3">
    <link rel="stylesheet" type="text/css" href="css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/dcswiper.css"/>
    <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_872913_5ogh0ten02x.css"/>
    <link rel="stylesheet" href="css/dialog.css"/>
    <link rel="stylesheet" href="css/draw.css">
    <link rel="stylesheet" href="css/NewStyle.css">
    <script src="js/base.js"></script>
    <script>
        var info = ''
        var inf = GetQueryString("inf")
        if (inf){
            info = '&inf='+inf
        }
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = decodeURI(window.location.search.substr(1)).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
        if (GetQueryString("roomId") != null || GetQueryString("roomId") != undefined) {
            if (/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
                window.location.href = "http://" + h5Base + "/phone/live.html?roomId=" + GetQueryString("roomId") + info;//H5
            }
        }
    </script>
</head>
<body>
<div class="alert tips alert-danger alert-dismissible fade in" role="alert" style="display: none">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div class="wrap">建议使用谷歌(google)浏览器打开</div>
</div>

<div class="header">
    <div class="wrap">
        <div class="playlogo">
            <div class="z-logo">
                <img src="images/Nlogo.png"/>
            </div>
            <!--已关注加上class名：active-->
            <div class="attention">
                <div>
                    <button id="guanzhu" class="btn follow" style="display: none;">
                        <i class="iconfont icon-jia"></i>&nbsp;关注
                    </button>
                    <button id="yiguanzhu" class="btn follow active" style="display: none;">
                        <i></i>已关注
                    </button>
                </div>
                <div>
                    <a class="btn follow" id="fenxiang">
                        <i class="iconfont icon-qiandao"></i>&nbsp;分享
                    </a>
                    <div id="popover_content_wrapper" style="display: none">
                        <div id="zbewmbox"></div>
                        <img id="qrcodeImg" src="">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="playcontent livepage">
        <div class="playinfo">
            <div class="pull-left player">
                <div class="play-video">
                    <div class="mainplayer">
                        <div id="flash" style="display: none;"></div>
                        <div id="videoImage" style="display: none;"></div>
                        <div id="oPlayer"></div>
                    </div>
                    <div class="marqueeBox hide"></div>
                    <!--直播状态显示-->
                    <div class="status text-center" id="videoStartDiv">
                        <!--直播未开始-->
                        <div class="statusinfo" style="display: none;" id="startLive">
                            <div id="startLiveTime"></div>
                            <div class="commonbtn">
                                <button class="btn" onclick="saveAppointment()" id="saveAppointment">预约本场直播</button>
                            </div>
                            <!-- <button class="btn ordered">已预约本场直播</button> -->
                        </div>
                        <!--直播暂停-->
                        <div class="statusinfo" style="display: none;" id="stopLive">
                            当前暂无直播画面
                        </div>
                        <!--直播已结束-->
                        <div class="statusinfo" style="display: none;" id="endLive">
                            直播已结束
                        </div>
                    </div>
                </div>
                <div class="play-titie">
                    <div id="roomName"></div>
                    <div class="actionlist">
                        <div class="action-bar pull-left">
                            <div class="roomNumber">
                                <i class="iconfont icon-mi"></i>
                                <span id="roomNumber">0</span>
                            </div>
                            <div class="startTime">
                                <i>开播日期:</i>
                                <span id="startTime">0</span>
                            </div>
                        </div>
                        <div class="action-bar pull-right">
                            <div class="pull-right qiandao hide" id="qiandao" data-toggle="modal" data-type="qiandao"
                                 data-title="签到"
                                 data-target="#actionBar">
                                <i class="iconfont icon-qiandao"></i>
                                <span>签到</span>
                            </div>

                            <div class="pull-right thumpup" id="dianZanSpan" onclick="saveDianZan()">
                                <i class="iconfont icon-dianzan"></i>
                                <span>点赞</span>
                            </div>

                            <div class="pull-right choujiang hide" id="choujiang" data-toggle="modal"
                                 data-type="choujiang"
                                 data-title="抽奖"
                                 data-target="#actionBar">
                                <i class="iconfont icon-choujiang"></i>
                                <span>抽奖</span>
                            </div>

                            <div class="pull-right toupiao hide" id="toupiao" data-toggle="modal" data-type="toupiao"
                                 data-title="投票"
                                 data-target="#actionBar">
                                <i class="iconfont icon-toupiao"></i>
                                <span>投票</span>
                            </div>
 							<div class="pull-right toupiao hide" id="wenjuan" data-toggle="modal" data-type="wenjuan"
                                 data-title="wenjuan"
                                 data-target="#actionBar" onclick="showWenjuan()">
                                <i class="iconfont icon-toupiao"></i>
                                <span>问卷</span>
                            </div>
                            <div class="pull-right dashang hide" id="dsshang" data-toggle="modal" data-type="dashang"
                                 data-title="打赏"
                                 data-target="#actionBar">
                                <i class="iconfont icon-dashang"></i>
                                <span>打赏</span>
                            </div>

                            <div class="pull-right hongbao hide" onclick="hongbao()" id="hongbao">
                                <i class="iconfont icon-ziyuan2"></i>
                                <span>红包</span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="pull-right interaction">
                <div class="documentLiveDIV2" style="display: none">
                    <div class="document"></div>
                    <div class="tabSel" onclick="openDocument()">
                        <i class="iconfont icon-qihuang" onclick="openDocument()"></i>切换播放窗口
                    </div>
                </div>

                <ul id="myTab" class="nav nav-tabs">
                    <li id="openMessageType2" class="active" onclick="selectLiveMsgType(2)" style="display: none;">
                        <a href="#chat" data-toggle="tab">聊天</a></li>
                    <li id="openMessageType1" class="pull-right" onclick="selectLiveMsgType(1)" style="display: none;">
                        <a href="#topic" data-toggle="tab">话题</a></li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade in active " id="chat">
                        <div class="chatBox">
                            <div id="topChatMessageDiv">
                            </div>
                            <div id="chatMessageDiv">
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="inputBox">
                                <span id="questionSpan" class="questionBox" onclick="questionSpan()">问</span>
                                <input type="text" name="content" maxlength="40"/>
                                <button class="sendBtn" onclick="sendMessageBtn()">发送</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade text-white " id="topic">
                        <div class="topoicBox">
                            <div id="topTopicDiv">
                            </div>
                            <div id="topicDiv">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="playfooter wrap livefooter">
    <div class="review-more" id="recallingDiv"></div>
    <div class="introduct">
        <div class="introductTil">直播简介</div>
        <div class="introductText" id="liveDesc_enterpriseId"></div>
    </div>
</div>

<div class="swiper-container" id="origin-img">
    <div class="swiper-wrapper"></div>
    <div class="swiper-pagination"></div>
    <div class="upload"></div>
</div>

<!--手机绑定-->
<div class="modal fade in" id="myModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="loginpage" style="height: 430px;">
        <form class="form">
            <div class="form-group">
                <input type="text" class="form-control phonenum" placeholder="手机号" maxlength="11"
                       name="phoneNumber">
            </div>
            <div class="form-group">
                <input type="text" class="form-control vcode" placeholder="请输入验证码" name="passwordCode">
                <button class="commonbtn send-sms" onclick="getAuthenticode(this)" id="spenTimer"><span>获取验证码</span>
                </button>
            </div>
            <button type="button" class="btn commonbtn loginbtn" onclick="savePhone(this)">绑定</button>
        </form>
    </div>
</div>

<!-- 下载模态框（Modal） -->
<div class="modal fade in" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header text-center">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title" style="font-size: 16px;font-weight: bold;">直播预约提示</h3>
            </div>
            <div class="modal-body" style="overflow: hidden;">
                <div class="modalLeft">
                    <div class="erweimaBox" id="erweimaBoxImage">
                    </div>
                </div>
                <div class="modalRight">
                    <div class="modal_Text" style="margin-top: 30px;">
                        您已预约成功，直播开始前，您将收到直播观看的提醒短信。打开天翼直播APP，将获得更多更优质的服务哦！
                    </div>
                    <div class="modal_Text" style="margin-top: 60px;">
                        扫一扫二维码，下载天翼直播客户端
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 支付模态框（Modal） -->
<div class="modal fade" id="payModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     data-backdrop="static"
     aria-hidden="true" style="top: 180px;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style="overflow: hidden;">
                <div class="payTit" id="welcomeMsg1">欢迎语，欢迎观看直播</div>
                <div class="payMoney"></div>
                <div class="code" style="display: none;" id="ewmCode" onclick="openJhm()">使用激活码</div>
                <div class="payBox">
                    <button class="payButton" id="payButtonClick">确认支付</button>
                </div>
                <div class="checkCon">
                    <input id="checkbox-1-1" checked="checked" class="regular-checkbox" type="checkbox"/><label
                        for="checkbox-1-1" onclick="selectCK()"></label>同意 <a id="ewmPayAgreement">《天翼直播观看支付协议》</a>
                </div>
            </div>
        </div>
    </div><!-- /.modal -->
</div>
<!-- 二维码模态框（Modal） -->
<div class="modal fade" id="ewmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     data-backdrop="static"
     aria-hidden="true" style="top: 180px;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style="overflow: hidden;">
                <div class="payTit">扫码支付</div>
                <div class="ewmBox" id="ewmImage">
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 激活码模态框（Modal） -->
<div class="modal fade" id="codeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     data-backdrop="static"
     aria-hidden="true" style="top: 180px;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style="overflow: hidden;">
                <div class="payTit" id="welcomeMsg2">欢迎语，欢迎观看直播</div>
                <div class="ewmMoney"><input type="text" class="ewmInput" name="codeEwm" placeholder="激活码"/></div>
                <div class="payBox">
                    <button class="payButton" onclick="openRoomActivationCode()">进入直播</button>
                </div>
                <div class="tishi">(无需激活码,现在去<span class="color-blue" onclick="openPay()">付费观看</span>)</div>

            </div>
        </div>
    </div>
</div>
<!-- 下载文档模态框（Modal） -->
<div class="modal fade" id="wdModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;
                </button>
                <h4 class="modal-title" id="myModalLabel">文档下载</h4>
            </div>
            <div class="modal-body">
                <div class="wdTable">
                    <table class="table">
                        <thead>
                        <tr>
                            <th><input type="checkbox" style="vertical-align: middle;" onclick="selectAll()"
                                       id="checkboxAll"/>全选
                            </th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="fileTbody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <!-- <button type="button" class="btn btn-primary" onclick="downloadAll()">批量下载</button> -->
            </div>
        </div>
    </div>
</div>
<!-- 互动 -->
<div class="modal  fade in customModal " id="actionBar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close iconfont icon-close1" data-dismiss="modal"
                        aria-hidden="true">
                </button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <div id="actionContent"></div>
            </div>
        </div>
    </div>
</div>
<!--红包-->
<div class="Popup">
    <canvas width="376" height="399" id="popuphongbao" style="display: none"></canvas>
    <img src="" id="imghongbao">
    <a href="javascript:;" class="iconfont icon-close" onclick="removeModal(this)"></a>
</div>
<input type="hidden" id="roomId" name="roomId" value="0">
<input type="hidden" id="userId" name="userId" value="0">
<input type="hidden" id="liveEventId" name="liveEventId" value="0">
<input type="hidden" id="liveMsgType" name="liveMsgType" value="2">
<script src="js/jquery.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/layer/layer.js"></script>
<script type="text/javascript" src="js/Fun.js?version=2.0.4"></script>
<script type="text/javascript">


    var liveStart = 0;
    var countdown = 60;
    $(function () {

        if (GetQueryString("roomId") != null || GetQueryString("roomId") != undefined) {
            $("input[name=roomId]").val(GetQueryString("roomId"));
            var roomId = GetQueryString("roomId");

            if (GetQueryString("userId") != null || GetQueryString("userId") != undefined) {
                $("input[name=userId]").val(GetQueryString("userId"));
            }
            // var roomId = $("input[name=roomId]").val();
            if (roomId == 0) {
                // $.DialogBySHF.Alert({
                //     Width: 350,
                //     Height: 200,
                //     Title: "提示",
                //     Content: "直播间错误",
                //     ConfirmFun: errorfunction
                // });
                layerAlert("直播间错误")
                return;
            }
            //焦点获取事件
            $("input[name=content]").focus(function () {
                var userId = $("input[name=userId]").val();//用户ID
                if (userId == 0) {
                    // $.DialogBySHF.Confirm({
                    //     Width: 350,
                    //     Height: 200,
                    //     Title: "确认登录",
                    //     Content: "是否进入登录？",
                    //     ConfirmFun: loginHtml,
                    //     CancelFun: loginHtmlError
                    // });
                    loginHtml()
                    $("input[name=content]").blur();
                    $(".emojiBox").attr("display", "none");
                    return false;
                }
            });
            $('[data-toggle="popover"]').popover()


            $(".chatBox").slimScroll({
                height: '425px'
            });
            $(".topoicBox").slimScroll({
                height: '425px'
            });


            var isChrome = (window.navigator.userAgent.indexOf("Chrome") !== -1 || window.navigator.userAgent.indexOf("WindowsWechat") > 0);
            if (!isChrome) {
                $(".tips").show();
            }
            $('#erweimaBoxImage').qrcode({
                render: "canvas", // 渲染方式有table方式和canvas方式
                width: 160, //默认宽度
                height: 160, //默认高度
                text: "http://apizb.tv189.com/version/wap/download/ios", //二维码内容
                typeNumber: -1, //计算模式一般默认为-1
                correctLevel: 2, //二维码纠错级别
                background: "#ffffff", //背景颜色
                foreground: "#000000" //二维码颜色
            });
            // $('#qrcode').qrcode({
            //     render: "canvas", // 渲染方式有table方式和canvas方式
            //     width: 120, //默认宽度
            //     height: 120, //默认高度
            //     text: "http://" + h5Base + "/phone/live.html?roomId=" + roomId, //二维码内容
            //     typeNumber: -1, //计算模式一般默认为-1
            //     correctLevel: 2, //二维码纠错级别
            //     background: "#ffffff", //背景颜色
            //     foreground: "#000000" //二维码颜色
            // })
            $('#fenxiang').popover({
                html: true,
                trigger: "manual",
                container: 'body',
                content: function () {
                    return $('#popover_content_wrapper').html();
                }
            }).on("mouseenter",
                function () {
                    var _this = this;
                    $(this).popover("show");
                    $(".popover").on("mouseleave",
                        function () {
                            $(_this).popover('hide');
                        });
                }).on("mouseleave",
                function () {
                    var _this = this;
                    setTimeout(function () {
                            if (!$(".popover:hover").length) {
                                $(_this).popover("hide");
                            }
                        },
                        100);
                });
            var qrcode = $('#zbewmbox').qrcode({
                render: "canvas", //也可以替换为table
                width: 120,
                height: 120,
                text: "http://" + h5Base + "/phone/live.html?roomId=" + roomId + info/*可以通过ajax请求动态设置*/
            });
            //将生成的二维码转换成图片格式
            var canvas = qrcode.find('canvas').get(0);
            $('#qrcodeImg').attr('src', canvas.toDataURL('image/jpg'));
            //=====================建立连接================
            $.ajax({
                type: "GET",//请求方式 get/post
                url: "http://" + tomcatBase + "/ilive/app/room/checkRoomLogin.jspx",
                dataType: "jsonp",
                jsonp: "callback",
                cache: false,
                data: {
                    roomId: roomId
                },
                success: function (data) {
                    var status = data.code;
                    if (status == 404) {
                        window.location.href = "http://" + h5Base + "/pc/end.html";
                    } else if (status == 402) {
                        var userInfo = JSON.parse(data.data).userInfo;
                        if (userInfo != undefined || userInfo != null) {
                            var userId = userInfo.userId;
                            if (userId != undefined || userId != null) {
                                $("input[name=userId]").val(userId);
                            }
                            window.location.href = "http://" + h5Base + "/pc/phoneNumber.html?roomId=" + roomId + "&userId=" + userId;
                        } else {
                            // $.DialogBySHF.Alert({
                            //     Width: 350,
                            //     Height: 200,
                            //     Title: "提示",
                            //     Content: "绑定手机号，获取用户失败",
                            //     ConfirmFun: errorfunction
                            // });
                            layerAlert("绑定手机号，获取用户失败")
                        }
                    } else if (status == 1) {
                        var datas = JSON.parse(data.data);
                        //var repeateGuide = datas.repeateGuide;
                        /* if(repeateGuide==0){
                        var openGuideSwitch = datas.openGuideSwitch;
                        if(openGuideSwitch==1){
                            //引导页
                            window.location.href=datas.guideAddr;
                            return;
                        }
                    } */
                        var roomNeedLogin = datas.roomNeedLogin;
                        if (roomNeedLogin == 1) {
                            window.location.href = "http://" + h5Base + "/pc/login.html?roomId=" + roomId;
                            return;
                        } else if (roomNeedLogin == 2) {
                            var userInfo = datas.userInfo;
                            if (userInfo != undefined || userInfo != null) {
                                var userId = userInfo.userId;
                                if (userId != undefined || userId != null) {
                                    $("input[name=userId]").val(userId);
                                }
                            }
                            $.ajax({
                                type: "GET",//请求方式 get/post
                                url: "http://" + tomcatBase + "/ilive/app/room/getRoomInfo.jspx",
                                dataType: "jsonp",
                                jsonp: "callback",
                                cache: false,
                                data: {
                                    roomId: roomId
                                },
                                success: function (data) {
                                    var status = data.code;
                                    if (status == 1) {
                                        var liveEvent = data.data.liveEvent;
                                        if (liveEvent == null || liveEvent == undefined) {
                                            // $.DialogBySHF.Alert({
                                            //     Width: 350,
                                            //     Height: 200,
                                            //     Title: "提示",
                                            //     Content: "直播间信息错误",
                                            //     ConfirmFun: errorfunction
                                            // });
                                            layerAlert("直播间信息错误")
                                            return;
                                        }
                                        var liveStatus = liveEvent.liveStatus;
                                        var playBgAddr = liveEvent.playBgAddr; //播放器封面
                                        var converAddr = liveEvent.converAddr //直播封面
                                        var openSignupSwitch = liveEvent.openSignupSwitch;//是否进入报名页
                                        var viewAuthorized = liveEvent.viewAuthorized; //观看权限
                                        if (openSignupSwitch == 1) {
                                            //var diyformAddr = liveEvent.diyformAddr;
                                            window.location.href = "http://" + h5Base + "/pc/form.html?roomId=" + roomId;
                                            return false;
                                        }

                                        if (viewAuthorized == 2) {
                                            window.location.href = "http://" + h5Base + "/pc/password.html?roomId=" + roomId;
                                            return false;
                                        }
                                        if (viewAuthorized == 6) {
                                            window.location.href = "http://" + h5Base + "/pc/FCode.html?roomId=" + roomId;
                                            return false;
                                        }
                                        if (viewAuthorized == 3) {
                                            //付费观看
                                            var viewMoney = liveEvent.viewMoney;
                                            if (viewMoney == undefined || viewMoney == "" || viewMoney == null) {
                                                viewMoney = 0.01;
                                            }
                                            var totalAmount = parseFloat(viewMoney) * 100;
                                            var id = $("input[name=userId]").val();
                                            var liveTitle = liveEvent.liveTitle;
                                            if (liveTitle == undefined) {
                                                liveTitle = "";
                                            }
                                            var welcomeMsg = liveEvent.welcomeMsg;
                                            if (welcomeMsg == "" || welcomeMsg == null) {
                                                welcomeMsg = "欢迎观看直播"
                                            }
                                            $(".payMoney").text("￥" + viewMoney);
                                            $("#welcomeMsg1").text(welcomeMsg);
                                            $("#welcomeMsg2").text(welcomeMsg);
                                            $("#payButtonClick").attr("onclick", "wechatSweepUnifyTheOrder(3,'" + liveTitle + "'," + totalAmount + ",0)");
                                            $("#checkbox-1-1").attr("wechatSweepUnifyTheOrder", "wechatSweepUnifyTheOrder(3,'" + liveTitle + "'," + totalAmount + ",0)");
                                            $("#ewmPayAgreement").attr("href", "http://" + h5Base + "/pc/agreePc.html?roomId=" + roomId + "&userId=" + id);
                                            var openFCodeSwitch = liveEvent.openFCodeSwitch;
                                            if (openFCodeSwitch == 1) {
                                                $("#ewmCode").attr("display", "block")
                                            } else {
                                                $("#ewmCode").attr("display", "none")
                                            }
                                            $('#payModal').modal({backdrop: 'static', keyboard: false});
                                        }
                                        selectHTML(roomId); //roomenter
                                        selectRoomNumber(); //获取直播间人数
                                        selectcommentsList(roomId); //获取话题评论
                                        selectRoomLogo(); //获取直播间信息
                                        selectAdvertising(); //滚屏消息
                                        // selectRoom(roomId, function (data) {
                                        //     if (data.code == 1) {
                                        //
                                        //         var iLiveLiveRoom = JSON.parse(data.iLiveLiveRoom);
                                        //         var liveEvent = iLiveLiveRoom.liveEvent;
                                        //         var liveTitle = liveEvent.liveTitle;
                                        //         var live_bg = iLiveLiveRoom.bgdImg
                                        //         var live_logo = iLiveLiveRoom.logoImg
                                        //         if (live_logo) {
                                        //             $('.z-logo img').attr('src', live_logo)
                                        //         }
                                        //         if (live_bg) {
                                        //             $('.header').css('background-image', 'url(' + live_bg + ')')
                                        //         }
                                        //         // console.log(live_bg)
                                        //         if (liveTitle == undefined) {
                                        //             liveTitle = "天翼直播平台";
                                        //         }
                                        //         $("title").text(liveTitle);
                                        //         $("#roomName").text(liveTitle);
                                        //     } else {
                                        //         $.DialogBySHF.Alert({
                                        //             Width: 350,
                                        //             Height: 200,
                                        //             Title: "提示",
                                        //             Content: data.message
                                        //         });
                                        //         return false
                                        //     }
                                        // })
                                        selectPageDecorate(roomId, function (data) {
                                            var pageDecorates = JSON.parse(data.pageDecorates);
                                            for (var i = 0; i < pageDecorates.length; i++) {
                                                var pageDecorate = pageDecorates[i];
                                                var liveMsgType = pageDecorate.menuType;
                                                var menuName = pageDecorate.menuName;
                                                if (liveMsgType == 1) {
                                                    $("#openMessageType1").css("display", "block");
                                                    $("#openMessageType1 a").text(menuName);
                                                } else if (liveMsgType == 2) {
                                                    $("#openMessageType2").css("display", "block");
                                                    $("#openMessageType2 a").text(menuName);
                                                } else if (liveMsgType == 6) {
                                                    $(".documentLiveDIV2").css("display", "block");
                                                    $("#myTabContent").height(175)
                                                    $(".chatBox").slimScroll({
                                                        height: '165px'
                                                    });
                                                    $(".topoicBox").slimScroll({
                                                        height: '165px'
                                                    });
                                                    $(".wdTable").slimScroll({
                                                        height: '330px'
                                                    });
                                                }
                                            }

                                        })
                                        selectActions();//互动板块
                                        $(".videoLiveDIV2 img").attr("src", playBgAddr);
                                        var liveStartTime = liveEvent.liveStartTime;
                                        $("#startTime").text(liveStartTime); //开播时间
                                        if (liveStatus == 0) {
                                            liveStart = 0;
                                            //开始直播
                                            console.log("直播未开始");
                                            var openCountdownSwitch = liveEvent.openCountdownSwitch;
                                            if (openCountdownSwitch == 1) {
                                                var tempStrs = liveStartTime.split(" ");  //截取时间
                                                // 解析日期部分
                                                var dateStrs = tempStrs[0].split("-");
                                                var start_year = parseInt(dateStrs[0], 10);
                                                var start_month = parseInt(dateStrs[1], 10) - 1;
                                                var start_day = parseInt(dateStrs[2], 10);
                                                // 解析时间部分
                                                var timeStrs = tempStrs[1].split(":");
                                                var start_hour = parseInt(timeStrs [0], 10);
                                                var start_minute = parseInt(timeStrs[1], 10);
                                                var start_second = parseInt(timeStrs[2], 10);
                                                var date = new Date(start_year, start_month, start_day, start_hour, start_minute, start_second);
                                                var newDate = new Date();   // 获取当前时间
                                                var dateTime = date.getTime() - newDate.getTime();   //时间差的毫秒数
                                                //计算出相差天数
                                                var days = Math.floor(dateTime / (24 * 3600 * 1000))
                                                //计算出小时数
                                                var leave1 = dateTime % (24 * 3600 * 1000);   //计算天数后剩余的毫秒数
                                                var hours = Math.floor(leave1 / (3600 * 1000));
                                                //计算相差分钟数
                                                var leave2 = leave1 % (3600 * 1000);      //计算小时数后剩余的毫秒数
                                                var minutes = Math.floor(leave2 / (60 * 1000));
                                                //计算相差秒数
                                                var leave3 = leave2 % (60 * 1000);      //计算分钟数后剩余的毫秒数
                                                var seconds = Math.round(leave3 / 1000);
                                                var dataTime = days + " 天 " + hours + " 小时 " + minutes + " 分钟 " + seconds + " 秒";
                                                console.log(dataTime);
                                                $("#startLiveTime").html("距离直播开始：<i>" + days + "</i>天<i>" + hours + "</i>小时<i>" + minutes + "</i>分<i>" + seconds + "</i>秒")
                                                //倒计时事件
                                                selectTimer(liveStartTime);
                                            } else {
                                                $("#startLiveTime").html('本场直播尚未开始')
                                            }
                                            $("#videoImage").css({
                                                'display': 'block',
                                                'background-image': 'url(' + converAddr + ')'
                                            })
                                            $("#flash").css("display", "none");
                                            $("#startLive").css("display", "block"); //未开始
                                            $("#stopLive").css("display", "none"); //暂停
                                            $("#endLive").css("display", "none"); // //结束
                                        } else if (liveStatus == 1) {
                                            liveStart = 1;
                                            console.log("直播开始");
                                            //直播中
                                            $("#flash").css("display", "block");
                                            $("#videoImage").css("display", "none");
                                            $("#videoStartDiv").css("display", "none");
                                            $("#startLive").css("display", "none");
                                            $("#stopLive").css("display", "none");
                                            $("#endLive").css("display", "none");
                                            $('.marqueeBox').css('bottom', '30px')
                                        } else if (liveStatus == 2) {
                                            liveStart = 0;
                                            //暂停
                                            console.log("直播暂停");
                                            $("#flash").css("display", "none");
                                            $("#videoImage").css({
                                                'display': 'block',
                                                'background-image': 'url(' + playBgAddr + ')'
                                            })
                                            $("#startLive").css("display", "none");
                                            $("#stopLive").css("display", "block");
                                            $("#endLive").css("display", "none");
                                        } else if (liveStatus == 3) {
                                            liveStart = 0;
                                            //直播结束
                                            console.log("直播结束");
                                            $("#flash").css("display", "none");
                                            $("#videoImage").css({
                                                'display': 'block',
                                                'background-image': 'url(' + converAddr + ')'
                                            })
                                            $("#startLive").css("display", "none");
                                            $("#stopLive").css("display", "none");
                                            $("#endLive").css("display", "block");
                                        } else {
                                            liveStart = 0;
                                            console.log("直播状态：" + liveStatus);
                                            $("#videoImage").css({
                                                'display': 'block',
                                                'background-image': 'url(' + converAddr + ')'
                                            })
                                            $("#flash").css("display", "none");

                                        }
                                        //var id = $("input[name=userId]").val()
                                        var enterprise = data.data.enterprise;
                                        if (enterprise != null || enterprise != undefined) {
                                            var concernStatus = enterprise.concernStatus;//是否关注
                                            var certStatus = enterprise.certStatus;
                                            var enterpriseId = enterprise.enterpriseId;
                                            $("#guanzhu").attr("onclick", "updateConcernStatus(" + enterpriseId + ",1)");
                                            $("#yiguanzhu").attr("onclick", "updateConcernStatus(" + enterpriseId + ",0)");
                                            if (certStatus == 4) {
                                                if (concernStatus == 0) {
                                                    //关注
                                                    $("#yiguanzhu").css("display", "none");
                                                    $("#guanzhu").css("display", "block");

                                                } else {
                                                    //已关注
                                                    $("#yiguanzhu").css("display", "block");
                                                    $("#guanzhu").css("display", "none");
                                                }
                                            }
                                        }
                                        var liveDesc = liveEvent.liveDesc;
                                        $("#liveDesc_enterpriseId").html(liveDesc);

                                        var liveEventId = liveEvent.liveEventId;
                                        $("input[name=liveEventId]").val(liveEventId);



                                        selectAppointment();
                                        var documentId = liveEvent.documentId;
                                        if (documentId != 0) {
                                            var documentDownload = liveEvent.documentDownload;
                                            var documentPageNO = liveEvent.documentPageNO;
                                            var documentManual = liveEvent.documentManual;
                                            selectDocument(documentId, documentDownload, documentPageNO, documentManual);
                                            var enterpriseId = enterprise.enterpriseId;
                                            //selectDocumentList(enterpriseId);
                                        }
                                        //回看
                                        $.ajax({
                                            type: "GET",//请求方式 get/post
                                            url: "http://" + tomcatBase + "/ilive/app/room/getrecordlist.jspx",
                                            dataType: "jsonp",
                                            jsonp: "callback",
                                            cache: false,
                                            data: {
                                                roomId: roomId
                                            },
                                            success: function (data) {
                                                if (data.code == 1) {
                                                    var list = data.data;
                                                    if (list.length < 1) return
                                                    var recallingDiv = "";
                                                    recallingDiv +=
                                                        '<div class="introductTil">回看视频</div>' +
                                                        '<div class="swiper-container recallingDiv"><div class="swiper-wrapper" >'
                                                    for (var i = 0; i < list.length; i++) {
                                                        var mediaFile = list[i];
                                                        recallingDiv += "<div class=\"swiper-slide\" id=\"fileId_" + mediaFile.fileId + "\" onclick=\"selectMediaFile(" + mediaFile.fileId + ")\">"
                                                        recallingDiv += "<div class=\"reviewlist\">";
                                                        recallingDiv += " <img src=\"" + mediaFile.fileImg + "\" /> <span>" + mediaFile.fileDuration + "</span>";
                                                        recallingDiv += "</div>";
                                                        recallingDiv += "<div class=\"reviewinfo text-dullgray\">";
                                                        recallingDiv += "<p style='color: inherit'>";
                                                        recallingDiv += mediaFile.fileName;
                                                        recallingDiv += "</p>";
                                                        recallingDiv += "</div>";
                                                        recallingDiv += "</div>";
                                                    }
                                                    recallingDiv += '</div>' +
                                                        '<div  class="paginationReview"><div class="swiper-button-prev iconfont icon-zuojiantou"></div><div class="swiper-pagination pagination-bullet"></div>' +
                                                        '<div class="swiper-button-next iconfont icon-youjiantou"></div></div>' +
                                                        '</div>';
                                                    $("#recallingDiv").prepend(recallingDiv);
                                                    new Swiper('.recallingDiv', {
                                                        slidesPerView: 5,
                                                        spaceBetween: 20,
                                                        slidesPerGroup: 5,
                                                        pagination: {
                                                            el: '.swiper-pagination',
                                                        },
                                                        navigation: {
                                                            nextEl: '.swiper-button-next',
                                                            prevEl: '.swiper-button-prev',
                                                        },
                                                    })
                                                } else {
                                                    // $.DialogBySHF.Alert({
                                                    //     Width: 350,
                                                    //     Height: 200,
                                                    //     Title: "提示",
                                                    //     Content: data.message
                                                    // });
                                                    layerAlert(data.message)
                                                }
                                            }
                                        });
                                    } else {
                                        // $.DialogBySHF.Alert({
                                        //     Width: 350,
                                        //     Height: 200,
                                        //     Title: "提示",
                                        //     Content: data.message,
                                        //     ConfirmFun: errorfunction
                                        // });
                                        layerAlert(data.message)
                                    }
                                }
                            });
                        } else {
                            // $.DialogBySHF.Alert({
                            //     Width: 350,
                            //     Height: 200,
                            //     Title: "提示",
                            //     Content: data.message,
                            //     ConfirmFun: errorfunction
                            // });
                            layerAlert(data.message)
                        }
                    } else {
                        // $.DialogBySHF.Alert({
                        //     Width: 350,
                        //     Height: 200,
                        //     Title: "提示",
                        //     Content: data.message,
                        //     ConfirmFun: errorfunction
                        // });
                        layerAlert(data.message)
                        return false
                    }
                }
            });
            var swiper = new Swiper('#origin-img', {
                zoom: true,
                width: window.innerWidth,
                virtual: true,
                spaceBetween: 20,
                pagination: {
                    el: '.swiper-pagination',
                    type: 'fraction',
                },
                on: {
                    click: function () {
                        $('#origin-img').fadeOut('fast');
                        this.virtual.slides.length = 0;
                        this.virtual.cache = [];
                        swiperStatus = false;

                    },
                },

            });
            $(document).delegate(".toBig", "click", function () {
                clickIndex = $(this).index();
                var imglist = $(this).parent().find("img");
                $(imglist).each(function (i, v) {
                    var imgs = $(v).attr("src")
                    swiper.virtual.appendSlide("<div class=\"swiper-zoom-container\"><img src=\"" + imgs + "\" /></div>");
                })
                swiper.slideTo(clickIndex);
                $('#origin-img').fadeIn('fast');
                swiperStatus = true;

            })

            //切换图状态禁止页面缩放
            document.addEventListener('touchstart', function (event) {
                if (event.touches.length > 1 && swiperStatus) {
                    event.preventDefault();
                }
            })
            var lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                var now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false)

            document.addEventListener('touchmove', function (e) {
                if (swiperStatus) {
                    e.preventDefault();
                }
            });
        } else {
            // $.DialogBySHF.Alert({
            //     Width: 350,
            //     Height: 200,
            //     Title: "提示",
            //     Content: "直播错误 Wrong Id",
            //     ConfirmFun: errorfunction
            // });
            layerAlert("直播ID错误")
        }

        // $('#zbewmbox').qrcode({
        //     render: "canvas", // 渲染方式有table方式和canvas方式
        //     width: 120, //默认宽度
        //     height: 120, //默认高度
        //     text: "http://" + h5Base + "/phone/live.html?roomId=" + roomId, //二维码内容
        //     typeNumber: -1, //计算模式一般默认为-1
        //     correctLevel: 2, //二维码纠错级别
        //     background: "#ffffff", //背景颜色
        //     foreground: "#000000" //二维码颜色
        // });

    });

    $(document).delegate(".toVideo", "click", function () {
        clickIndex = $(this).index();
        var imglist = $(this).parent().find("img");
        var video = imglist.attr("video");
    })


    window.onload = function () {
        if (ws) {
            ws.onclose();
        }
    }
    window.onbeforeunload = function () {
        if (ws) {
            ws.onclose();
        }
    }
</script>
<script type="text/javascript" src="js/jquery.slimscroll.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/jQuery.Marquee/1.5.0/jquery.marquee.js"></script>
<script type="text/javascript" src="js/swiper.min.js" charset="utf-8"></script>
<script type="text/javascript" src="../phone/js/basetemp.js"></script>
<script type="text/javascript" src="js/jquery.qrcode.min.js"></script>
<script type="text/javascript" src="js/dialog.js"></script>
<script type="text/javascript" src="js/giftPlay.js"></script>
<script type="text/javascript" src="js/draw.js"></script>
<script type="text/javascript" src="js/vote.js"></script>
<script type="text/javascript" src="js/questionnaire.js"></script>
<script type="text/javascript" src="js/JWZT_Player.js?t=20120609"></script>
<script type="text/javascript" src="http://sdk.bst.tv189.com/dc/bstdcins_100033v3.js"></script>
<script type="text/javascript" src="../phone/js/goTele.js"></script>
</body>
</html>
